<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using the Target System (Provisioning) Workflows :: Documentation</title>
    <link rel="canonical" href="https://docs.dirx.solutions/dirx-identity-docs/latest/appl-dev-guide/ch7_targetWFs.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.dirx.solutions">
        <div class="navbar-item logo"></div>
        Documentation
      </a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="./">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">DirX Access</a>
            <a class="navbar-item" href="#">DirX Audit</a>
            <a class="navbar-item" href="../../../dirx-directory-docs/latest/index.html">DirX Directory</a>
            <a class="navbar-item" href="../index.html">DirX Identity</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="dirx-identity-docs" data-version="9.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">DirX Identity</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">General</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">About this Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="pdf-src/appl-dev-guide.html">Application Development Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../copyright.html#_copyright">Copyright</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="preface.html#_preface">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ch1_applsref.html#_understanding_the_default_application_workflow_technology">Understanding the Default Application Workflow Technology</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch1_applsref.html#_understanding_request_workflows">Understanding Request Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch1_applsref.html#_understanding_java_based_workflows">Understanding Java-based Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch1_applsref.html#_understanding_tcl_based_workflows">Understanding Tcl-based Workflows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ch2_reqWFs.html#_using_request_workflows">Using Request Workflows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#_understanding_creation_workflows">Understanding Creation Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#_understanding_modification_workflows">Understanding Modification Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#_understanding_assignment_workflows">Understanding Assignment Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#_understanding_deletion_workflows">Understanding Deletion Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#_understanding_certification_workflows">Understanding Certification Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#_understanding_service_management_workflows">Understanding Service Management Workflows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ch3_configScen.html#_configuring_custom_scenarios">Configuring Custom Scenarios</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch3_configScen.html#_creating_the_new_scenario">Creating the New Scenario</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch3_configScen.html#_refining_the_scenario">Refining the Scenario</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch3_configScen.html#_creating_the_identity_creation_workflows">Creating the Identity Creation Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch3_configScen.html#_creating_cluster_target_systems">Creating Cluster Target Systems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ch4_defappls.html#_using_the_default_connectivity_applications">Using the Default Connectivity Applications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch4_defappls.html#_working_with_default_connectivity_application_objects">Working with Default Connectivity Application Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch4_defappls.html#_working_with_default_connectivity_scenario">Working with the Default Connectivity Scenario</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ch5_sourceWFs.html#_using_the_source_workflows">Using the Source Workflows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch5_sourceWFs.html#_understanding_the_java_based_source_workflows">Understanding the Java-based Source Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch5_sourceWFs.html#_understanding-the-tcl-based-source-workflows">Understanding the Tcl-based Source Workflows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ch6_maintWFs.html#_using_the_maintenance_workflows">Using the Maintenance Workflows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch6_maintWFs.html#_understanding_java_based_maintenance_workflows">Understanding the Java-based Maintenance Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch6_maintWFs.html#_understanding_tcl_based_maintenance_workflows">Understanding the Tcl-based Maintenance Workflows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#_using_the_target_system_provisioning_workflows">Using the Target System (Provisioning) Workflows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_understanding_java_based_target_system_workflows">Understanding Java-based Target System Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_understanding_tcl_based_target_system_workflows">Understanding Tcl-based Target System Workflows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="appa_depr.html#_deprecated_features">Deprecated Features</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_ads_provisioning_workflows">ADS Provisioning Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_dashboard_workflow">Dashboard Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_dirx_access_workflows">DirX Access Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_jdbc_provisioning_workflows">JDBC Provisioning Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_ldap_provisioning_workflows">LDAP Provisioning Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_ldap_xxl_provisioning_workflows">LDAP XXL Provisioning Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_lotus_notes_provisioning_workflows">Lotus Notes Provisioning Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_unix_pam_provisioning_workflows">UNIX PAM Provisioning Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appa_depr.html#_unix_pam_workflows">UNIX PAM Workflows</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">DirX Identity</span>
    <span class="version">9.0.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../dirx-directory-docs/latest/index.html">DirX Directory</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dirx-directory-docs/latest/index.html">9.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">DirX Identity</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">9.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">DirX Identity</a></li>
    <li><a href="pdf-src/appl-dev-guide.html">Application Development Guide</a></li>
    <li><a href="#_using_the_target_system_provisioning_workflows">Using the Target System (Provisioning) Workflows</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Using the Target System (Provisioning) Workflows</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>DirX Identity target system (Provisioning) workflows synchronize information from connected systems with the Identity Store.</p>
</div>
<div class="paragraph">
<p>The DirX Identity target system workflows provided with the default Connectivity scenario include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initial load/validation workflows - workflows that perform an initial load or a validation from the connected system.In <strong>initial load</strong> mode, existing accounts and groups can be loaded from the connected system into the Identity Store.In <strong>validation</strong> mode, the workflow compares accounts and group information from the connected system with the current content of the Identity Store and updates the objects in DirX Identity or marks the differences for later reconciliation.</p>
</li>
<li>
<p>Synchronization workflows - workflows that synchronize accounts and groups from the Identity Store to the corresponding connected system.This type of workflow runs in full, delta or event-triggered mode to provision the changed information as quickly as possible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter provides detailed information about target system workflow configuration, special features and user hooks.The sections in this chapter include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extending the Schema for Target System Workflows - describes the procedure for extending the DirX Identity Store schema with target system-specific information required by most (but not all) of the Java-based and Tcl-based target system workflows.</p>
</li>
<li>
<p>Understanding Java-based Target System Workflows - describes the Java-based target system workflows.</p>
</li>
<li>
<p>Understanding Tcl-based Target System Workflows - describes the Tcl-based target system workflows.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extending_the_schema_for_target_system_workflows"><a class="anchor" href="#extending_the_schema_for_target_system_workflows"></a>Extending the Schema for the Target System Workflows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the target system provisioning workflows require you to extend the schema for the DirX Identity Store so that it can store target system-specific information. Setting up the Identity Store schema depending on the type of target systems you&#8217;d like to provision is a task that you should plan thoroughly. You should only set up the required object classes and attributes to guarantee high performance and easy handling.</p>
</div>
<div class="paragraph">
<p>If you selected to install the Sample Domain when you installed and configured DirX Identity, the configuration procedure has automatically extended the Identity Store schema with a minimal set of attributes and object classes for most of the supported target systems. You should check these schema extensions to make sure they meet your provisioning requirements. If you do not install the Sample Domain, no automatic schema extensions are performed. As a result, if you have not installed the Sample Domain or you want to use additional target system-specific attributes that are not present in the Identity Store schema, you need to extend the schema manually by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Customizing the target system-specific schema LDIF files provided with DirX Identity to your requirements.</p>
</li>
<li>
<p>Running the agent schema tool to install your schema customizations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next sections describe how to perform these tasks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We strongly recommend that you back up your directory before you run any scripts. You cannot reverse schema extensions in a directory.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customizing_the_ldif_schema_files"><a class="anchor" href="#_customizing_the_ldif_schema_files"></a>Customizing the LDIF Schema Files</h3>
<div class="paragraph">
<p>DirX Identity provides several complete sets of attribute and object class extensions for each supported target system type, delivered as LDIF files. The first step in extending the schema is to update these schema definitions according to your requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the directory <em>install_path</em>*/schema/tools*.</p>
</li>
<li>
<p>Open the subdirectory that corresponds to your directory installation: <strong>dirx-ee</strong> for a DirX Directory installation.</p>
</li>
<li>
<p>Copy the entire <strong>Customer</strong> <strong>Domain</strong> subdirectory and name it <strong>Customer Domain.orig</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can update the schema definitions in the <strong>Customer</strong> <strong>Domain</strong> subdirectory according to your requirements.</p>
</div>
<div class="paragraph">
<p>For a DirX Directory installation (dirx-ee is DirX Directory V8.3 or newer):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong>ldif</strong> subdirectory, select the LDIF file that corresponds to your DirX Identity Connectivity package. For example, <strong>dirx.nt.ldif</strong>.</p>
</li>
<li>
<p>Remove the attributes you don&#8217;t want to use by removing their corresponding <strong>MODIFY</strong> records that refer to <strong>attributeTypes</strong> creations.</p>
</li>
<li>
<p>Remove these attributes from the object class definitions by removing their corresponding LDAP attribute names from the <strong>MODIFY</strong> records that refer to <strong>objectClasses</strong> creations.</p>
</li>
<li>
<p>If indexes have been defined for these attributes, remove the attribute types from the <strong>dbconfig_opt</strong> statements in the <strong>dirxadm</strong> script of your DirX Identity Connectivity package. For example, <strong>DirXmetahub-schema.Nt.adm</strong> for Windows NT.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can use the agent schema tool to install your schema extensions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_ldif_schema_extensions"><a class="anchor" href="#_installing_the_ldif_schema_extensions"></a>Installing the LDIF Schema Extensions</h3>
<div class="paragraph">
<p>To install your schema extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Under <em>install_path</em>/<strong>schema/tools</strong>, run the script <strong>agent-schema.bat</strong> (on Windows) or <strong>agent-schema.sh</strong> (on UNIX).</p>
</li>
<li>
<p>Type the password of the DirX Identity administrator <strong>admin</strong>.</p>
</li>
<li>
<p>Select the appropriate DirX Identity Connectivity package to install this part of the schema extension. If you have multiple Connectivity packages to extend, you must select each Connectivity package separately.</p>
</li>
<li>
<p>Select whether or not to create the attribute indexes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The schema extensions are now installed. Check the <strong>trace.txt</strong> file for errors (the exit codes at the end should be <strong>0</strong>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_java_based_target_system_workflows"><a class="anchor" href="#_understanding_java_based_target_system_workflows"></a>Understanding the Java-based Target System Workflows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides configuration hints and details about the Java-based target system (provisioning) workflows, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ADS workflows (Microsoft) - default workflows that provision the Microsoft Active Directory including the Exchange Server and the Skype for Business Server (formerly the Lync Server).</p>
</li>
<li>
<p>Citrix ShareFile workflows - default workflows that provision a Citrix ShareFile system.</p>
</li>
<li>
<p>DirX Access workflows - there exist two methods to connect DirX Access with DirX Identity.</p>
</li>
<li>
<p>Evidian Single Sign-on (ESSO) workflows - workflows that provision an Evidian ESSO system.</p>
</li>
<li>
<p>Google Apps workflows - default workflows that provision a target system of type <strong>Google</strong> <strong>Apps</strong> in the Identity Store and the corresponding connected Google Apps endpoint.</p>
</li>
<li>
<p>Imprivata workflows - default workflows that synchronize data between a target system of type <strong>SPMLv1</strong> in the Identity Store and the corresponding connected Imprivata OneSign system.</p>
</li>
<li>
<p>JDBC workflows - default workflows that provision three predefined tables in any relational database that provides a JDBC connection.</p>
</li>
<li>
<p>LDAP workflows - default workflows that provision any LDAP directory.</p>
</li>
<li>
<p>IBM Notes workflows (IBM) - workflows that provision IBM Notes.</p>
</li>
<li>
<p>Medico workflows (Siemens) - workflows that provision the Siemens healthcare medico//s system.</p>
</li>
<li>
<p>Office 365 workflows - workflows that provision a target system of type <strong>Office365</strong> in the Identity Store and the corresponding connected Office 365 endpoint.</p>
</li>
<li>
<p>OpenICF Windows Local Accounts workflows - workflows that synchronize data between a target system of type <strong>OpenICF</strong> in the Identity Store and the corresponding connected Windows local accounts and groups system accessible through a .Net OpenICF connector server.</p>
</li>
<li>
<p>RACF workflows - default workflows that provision RACF systems via the IBM Tivoli Directory Server (LDAP).</p>
</li>
<li>
<p>Salesforce workflows - workflows that provision a target system of type <strong>Salesforce</strong> in the Identity Store and the corresponding connected Salesforce system.</p>
</li>
<li>
<p>SAP ECC (R/3) UM workflows - workflows that synchronize data between a target system of type SAPR3UM in the Identity Store and the corresponding connected SAP R/3 system.</p>
</li>
<li>
<p>Service Management workflows - workflows that allow for manual provisioning of offline (not connected) target systems.</p>
</li>
<li>
<p>SharePoint workflows (Microsoft) - workflows that provision Microsoft SharePoint server sites in conjunction with the ADS workflows.</p>
</li>
<li>
<p>Unify Office workflows - workflows that provision a target system of type <strong>Unify Office</strong> in the Identity Store and the corresponding connected Unify Office (RingCentral) endpoint.</p>
</li>
<li>
<p>UNIX-OpenICF workflows - workflows that provision a target system of type <strong>OpenICF</strong> in the Identity Store and the corresponding connected OpenICF connector server.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_general_information"><a class="anchor" href="#_general_information"></a>General Information</h3>
<div class="paragraph">
<p>This section covers features that are common for all or a subset of the Java Provisioning Workflows, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How the workflows automatically create superior folders</p>
</li>
<li>
<p>How to configure the workflows that support a central proxy server configuration</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_superior_folder_creation"><a class="anchor" href="#_superior_folder_creation"></a>Superior Folder Creation</h4>
<div class="paragraph">
<p>This section describes how the workflows automatically create superior folders in connected systems and in the Identity Store.</p>
</div>
<div class="sect4">
<h5 id="_in_the_connected_system"><a class="anchor" href="#_in_the_connected_system"></a>In the Connected System</h5>
<div class="paragraph">
<p>When the creation of new objects fails due to missing superior nodes, the realtime workflows automatically try to create them. But there is one limitation: the same structure is required in both in the Identity Store and in the connected system and therefore the individual nodes are mapped one-to-one.</p>
</div>
<div class="paragraph">
<p>When creating the missing entry in the connected system, the workflows use the following attributes from the appropriate entry in the Identity Store:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dxrOCLinTS: defines the object classes in the connected system</p>
</li>
<li>
<p>dxrOptions: defines default values for other mandatory attributes</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>DN in Identity Store: cn=Miller,ou=sales,o=My-Company,cn=Accounts,cn=My-TS,cn=TargetSystems,cn=My-Company</p>
</div>
<div class="paragraph">
<p>DN in connected system: cn=Miller Peter,ou=sales,o=My-Company,c=de</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Assume that "c=de" exists, but nothing else. Then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For creation of "o=My-Company,c=de", the workflows use the attributes "dxrOCLinTS" and "dxrOptions" of the entry "o=My-Company,cn=Accounts,cn=My-TS,cn=TargetSystems,cn=My-Company".</p>
</li>
<li>
<p>For creation of "ou=sales,o=My-Company,c=de", the workflows use the attributes "dxrOCLinTS" and "dxrOptions" of the entry "ou=sales,o=My-Company,cn=Accounts,cn=My-TS,cn=TargetSystems,cn=My-Company".</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_in_the_identity_store"><a class="anchor" href="#_in_the_identity_store"></a>In the Identity Store</h5>
<div class="paragraph">
<p>The realtime workflows will create the missing superiors as far as possible.</p>
</div>
<div class="paragraph">
<p>A) If a superior node doesn&#8217;t exist in the connected system, they create the relevant entry in the Identity Store with a default attribute list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dxrType=dxrTSAccountGroupContainer</p>
</li>
<li>
<p>objectClass=dxrTSContainer</p>
</li>
<li>
<p>objectClass=dxrContainer</p>
</li>
<li>
<p>objectClass=top</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>B) If the superior node exists in the connected system, the workflows use the following attributes from the appropriate entry in the connected system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The attributes "c", "o", "ou", "l", "dc" are stored in the same attribute types .</p>
</li>
<li>
<p>The attribute "objectClass" is mapped to "dxrOCLinTS".</p>
</li>
<li>
<p>The naming attribute value in the Connected System is mapped to "dxrRDNinTS".</p>
</li>
<li>
<p>The attributes "dxrType" and "objectClass" are mapped in the same way as the previous step.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>DN in connected system: cn=Miller Peter,ou=sales germany,o=My-Company,c=de</p>
</div>
<div class="paragraph">
<p>DN in Identity Store: cn=Miller,ou=sales germany,ou=sales europe,o=My-Company,,cn=Accounts,cn=My-TS,cn=TargetSystems,cn=My-Company [defined by Identifier mapping]</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The entry "o=My-Company,cn=Accounts,cn=My-TS,cn=TargetSystems,cn=My-Company" is created with information as defined in B.</p>
</li>
<li>
<p>The entry "ou=sales europe,o=My-Company,cn=Accounts,cn=My-TS,cn=TargetSystems,cn=My-Company" (which has no appropriate entry in the connected system) is created with information as defined in A.</p>
</li>
<li>
<p>The entry "ou=sales germany,ou=sales europe,o=My-Company,cn=Accounts,cn=My-TS,cn=TargetSystems,cn=My-Company" is created with information as defined in B.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_http_proxy_server_configuration"><a class="anchor" href="#_http_proxy_server_configuration"></a>HTTP Proxy Server Configuration</h4>
<div class="paragraph">
<p>Some of the target system workflows - such as the Google Apps, Office 365 and Salesforce workflows - support a central proxy server configuration. If your organization requires the use of an HTTP proxy server for Web access, configure the host and port of the HTTP proxy server represented by a connected directory within the Identity Store folder for your Provisioning domain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the Expert View and then create a new proxy server entry as a copy of an existing template from Connectivity Configuration Data &#8594; Connected Directories &#8594; Default &#8594; Identity Store &#8594; Proxy Server if necessary.</p>
</li>
<li>
<p>On the HTTP/HTTPS Proxy Server tab for each connected directory that supports a central proxy server configuration, set a link to the proxy server entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Do not use an authenticated proxy server. Configure and deploy a local transparent HTTP proxy server that can handle authentication and can forward requests to the corporate HTTP proxy server if necessary. Configure this local proxy server as the one used with DirX Identity.</p>
</div>
<div class="paragraph">
<p>If you have direct access to the HTTP/HTTPS servers needed to run the relevant workflows, remove any links to proxy servers from the HTTP/HTTPS Proxy Server tab of the relevant connected directories.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_active_directory_ads_workflows"><a class="anchor" href="#_active_directory_ads_workflows"></a>Active Directory (ADS) Workflows</h3>
<div class="paragraph">
<p>The Active Directory (ADS) Provisioning workflows operate between a target system of type "ADS" in the Identity Store and the corresponding Active Directory connected system.</p>
</div>
<div class="paragraph">
<p>The ADS connector used in the workflows communicates with the ADS server (AD LDAP provider) across the native LDAP protocol, as illustrated in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image1.png" alt="Active Directory Workflow Architecture">
</div>
<div class="title">Figure 1. Active Directory Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The workflows allow you to synchronize Identity account and group objects with ADS standard users, mail- or mailbox-enabled users, groups or distribution lists depending on the attributes set.</p>
</div>
<div class="sect3">
<h4 id="_ads_workflow_prerequisites_and_limitations"><a class="anchor" href="#_ads_workflow_prerequisites_and_limitations"></a>ADS Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The ADS Provisioning workflows have the following prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before you can use the workflows, you must extend the DirX Identity Store schema with ADS target system-specific attributes and object classes so that the workflows can store Active Directory-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows".</p>
</li>
<li>
<p>If you plan to create mailbox-enabled users and groups or other mailbox-enabled object types like shared, room or equipment mailboxes in Active Directory, you must install an Exchange Server in the Active Directory Domain, which extends the Active Directory schema with mail-enabling attributes.</p>
</li>
<li>
<p>If you plan to create lync-enabled users in Active Directory, you must install a Skype for Business Server, formerly Lync Server, in your environment, which extends the Active Directory schema with lync-enabling attributes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_active_directory"><a class="anchor" href="#_connecting_to_active_directory"></a>Connecting to Active Directory</h4>
<div class="paragraph">
<p>This section provides information about ADS workflow configuration on the Connectivity side.</p>
</div>
<div class="paragraph">
<p><strong>Connection to the target system:</strong></p>
</div>
<div class="paragraph">
<p>Specify the IP address and the data port at the ADS service object (ADS CD &#8594; Service). The IP address may contain the server name - full qualified or not - or a TCP/IP address.</p>
</div>
<div class="paragraph">
<p>In the Bind Profile (ADS CD &#8594; Bind Profile) specify a user in DN format. This user must have administrative rights in Active Directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to enable/disable SSL for one of the workflows, don&#8217;t use the SSL flag in the Bind Profile, which is kept there for compatibility reasons with the Tcl-based workflows. Use the SSL flag in the TS port of the join activity of the selected workflow instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_ads_target_system"><a class="anchor" href="#_configuring_the_ads_target_system"></a>Configuring the ADS Target System</h4>
<div class="paragraph">
<p>This section provides information about ADS target system configuration on the Provisioning side.</p>
</div>
<div class="sect4">
<h5 id="_setting_match_properties"><a class="anchor" href="#_setting_match_properties"></a>Setting Match Properties</h5>
<div class="paragraph">
<p>In the <strong>Advanced</strong> tab of the target system object, the properties <strong>Type</strong>, <strong>Forest</strong> and <strong>Domain</strong> must be set correctly according to your connected system. The event-based workflows on the Connectivity side assigned to this target system must hold the same values in their <strong>Is applicable for</strong> section. If a Windows Password Listener is also active in the related Active Directory domain, the property <strong>Forest</strong> must be specified in the full qualified form, for example “<strong>dc=your-company,dc=net</strong>” and the property <strong>Domain</strong> must contain just the name of the domain, like “<em>your-company</em>” to correctly receive the password change requests - keeping this information in their topics- sent by the Password Listener.</p>
</div>
</div>
<div class="sect4">
<h5 id="_special_attributes"><a class="anchor" href="#_special_attributes"></a>Special Attributes</h5>
<div class="paragraph">
<p>dxrPrimaryKey</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of accounts and groups contains the objects' connected system DN. It is also used as the member attribute of groups. On account creation, it is generated by the <strong>tsaccount.xml</strong> object description using the target system-specific attributes <strong>Account Root in TS</strong> and <strong>Group Root in TS</strong> in the <strong>Options</strong> tab.</p>
</div>
<div class="paragraph">
<p>dxrName</p>
</div>
<div class="paragraph">
<p>The <strong>dxrName</strong> attribute of accounts and groups contains the target system-unique attribute <strong>samAccountName</strong>. It is generated with the Java script <strong>dxrNameForAccounts</strong> if the account or group is created in DirX Identity. It is used for joining in the Identity direction.</p>
</div>
</div>
<div class="sect4">
<h5 id="_setting_account_and_group_root_in_ts"><a class="anchor" href="#_setting_account_and_group_root_in_ts"></a>Setting Account- and Group Root in TS</h5>
<div class="paragraph">
<p>In the <strong>Options</strong> tab of the target system object, the DN values for the <strong>Account Root in TS</strong> and <strong>Group Root in TS</strong> properties must be set correctly. They are used to generate the <strong>dxrPrimaryKey</strong> attribute on creation or modification of an account or group in DirX Identity. The <strong>dxrPrimaryKey</strong> attribute holds the DN of the object in the connected system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_setting_exchange_base_properties"><a class="anchor" href="#_setting_exchange_base_properties"></a>Setting Exchange Base Properties</h5>
<div class="paragraph">
<p>If an Exchange system is to be provisioned, some basic Exchange attributes must be configured in the <strong>Options</strong> tab of the target system object. They are used as base values for generating mailbox-specific attributes for an account when the "dxr mailbox users", "dxr shared mailbox creation", "dxr room mailbox creation" or "dxr equipment mailbox creation" groups are assigned to the related user.</p>
</div>
</div>
<div class="sect4">
<h5 id="_enabling_user_mailboxes"><a class="anchor" href="#_enabling_user_mailboxes"></a>Enabling User Mailboxes</h5>
<div class="paragraph">
<p>To enable an account in DirX Identity for Exchange mailbox functionality, assign the "dxr mailbox users" group to the related user. To make this assignment, you usually create a corresponding role assigned to this group or you assign this group directly. On assignment, the obligations linked to this group set all of the mailbox-enabling attributes that are required to create a mailbox-enabled user in Active Directory. On revocation, these attributes are cleared or set according to revocation.</p>
</div>
<div class="paragraph">
<p>There are two levels of obligations assigned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The base obligations common to all mailbox types (user, shared, room, equipment mailboxes) held in the obligation object <strong>Configuration</strong> &#8594; <strong>Obligations</strong> &#8594; <strong>Mailbox-enabling</strong> to which each mailbox-enabling group links.</p>
</li>
<li>
<p>The obligations specified directly in the Obligations tab of each mailbox-enabling group specific to the mailbox type.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_creating_shared_room_and_equipment_mailboxes"><a class="anchor" href="#_creating_shared_room_and_equipment_mailboxes"></a>Creating Shared, Room and Equipment Mailboxes</h5>
<div class="paragraph">
<p>To create a shared, a room or an equipment mailbox in Exchange 2013 or newer, assign the “dxr shared mailbox creation”, “dxr room mailbox creation” or “dxr equipment mailbox creation” group to a user representing this mailbox object in Active Directory. On assignment, the obligation rules for this group calculate and set all attributes required for the relevant mailbox type. On revocation, these attributes are cleared or set to the appropriate value.</p>
</div>
</div>
<div class="sect4">
<h5 id="_enabling_share_room_and_equipment_mailboxes"><a class="anchor" href="#_enabling_share_room_and_equipment_mailboxes"></a>Enabling Share, Room and Equipment Mailboxes</h5>
<div class="paragraph">
<p>To grant permissions to a user in DirX Identity to access a specific shared, room or equipment mailbox in Exchange, create a related rights assigning group in DirX Identity by copying the existing “dxr shared mailbox team1” group and adapt its obligation rules.</p>
</div>
<div class="paragraph">
<p>The “dxr shared mailbox team1” group is a sample for giving an account the right to share the specific mailbox named SharedMailbox_team1, which must exist already in Exchange. For every shared, room or equipment mailbox in your Exchange system that you want to share, you need to create a shared-mailbox-enabling group - for example, by copying and renaming the sample “dxr shared mailbox team1” group - and adapt the name of the mailbox to be shared in the OnAssignment rule of the Obligations tab, which sets the mailbox name to be shared to the dxmADsExtensionAttribute2. This attribute is then mapped in the ADS synchronization workflow account channel to the target virtual (not in the schema) attribute ps_script_param1 and passed as the first parameter to the specified PowerShell script. The PowerShell script name is set in the OnAssignment rule to the dxmADsExtensionAttribute1 attribute, which is mapped to the target non-schema attribute ps_script_name. The dxmADsExtensionAttribute3 attribute is filled with the cn of the assigned user, which is mapped to the target attribute ps_script_param2 and passed as the second parameter to the PowerShell script <strong>AddSharedMailboxPermission.ps1</strong> (running the <strong>Add-MailboxPermission</strong> cmdlet). The script is executed after the account has been created or updated in the connected system and assigns the rights to access the shared mailbox to the account.</p>
</div>
<div class="paragraph">
<p>On unassigning these rights, the script <strong>RemoveSharedMailboxPermission.ps1</strong> (running the Remove-MailboxPermission cmdlet) is called. This is specified in the OnRevocation rules of the obligations.</p>
</div>
<div class="paragraph">
<p>The PowerShell scripts <strong>AddSharedMailboxPermission.ps1</strong> and <strong>RemoveSharedMailboxPermission.ps1</strong> are installed under <em>install_path</em><strong>\samples\ADS\scripts\</strong> and must be copied into the Java-based Server&#8217;s <strong>repository\scripts</strong> folder.</p>
</div>
<div class="paragraph">
<p>For assigning and unassigning rights for room and equipment mailboxes, you perform the analogous actions and create a rights-assigning group for each Exchange room or equipment mailbox to be shared. The same PowerShell scripts for any mailbox types used for sharing (shared, room or equipment mailbox types) can be used for rights assignment and unassignment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only mailbox-enabled accounts can get permissions on other mailboxes. Standard Active Directory accounts with no mailbox-enabling attributes set cannot be given permissions on other shared mailboxes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_setting_lync_base_properties"><a class="anchor" href="#_setting_lync_base_properties"></a>Setting Lync Base Properties</h5>
<div class="paragraph">
<p>If an Active Directory system hosting a Skype for Business Server (formerly Lync Server) is to be provisioned, some basic lync-enabling attributes must be configured in the Options tab of the target system object. They are used as base values for generating lync-enabling attributes for an account when the "dxr lync users" group is assigned to that account.</p>
</div>
</div>
<div class="sect4">
<h5 id="_lync_enabling"><a class="anchor" href="#_lync_enabling"></a>Lync Enabling</h5>
<div class="paragraph">
<p>To enable an account in DirX Identity for Skype (formerly Lync) functionality, assign the "dxr lync users" group to this account. To make this assignment, you usually create a corresponding role assigned to this group or you assign this group directly. On assignment, the obligations linked to this group set all of the lync-enabling attributes that are required to create a lync-enabled user in Active Directory. On revocation, these attributes are cleared.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ads_workflows_and_activities"><a class="anchor" href="#_ads_workflows_and_activities"></a>ADS Workflows and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the ADS workflow&#8217;s join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image2.png" alt="ADS Workflow Channels and Objects">
</div>
<div class="title">Figure 2. ADS Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>As the figure shows, there is a pair of channels between accounts, groups and members on each side. The members are linked to the groups on both sides.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ads_workflow_ports"><a class="anchor" href="#_ads_workflow_ports"></a>ADS Workflow Ports</h4>
<div class="paragraph">
<p>This section provides information about ADS workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
The configured Crypt Filter is used to send the password attribute unicodePwd decrypted to the ADS server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ads_workflow_channels"><a class="anchor" href="#_ads_workflow_channels"></a>ADS Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about ADS workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_account_and_group_channels"><a class="anchor" href="#_account_and_group_channels"></a>Account and Group Channels</h5>
<div class="paragraph">
<p>Both Directions</p>
</div>
<div class="paragraph">
<p>a. Master attributes</p>
</div>
<div class="paragraph">
<p>You can master attributes by setting the <strong>OnAddOnly</strong> flag in the according mapping direction. For example, if you want Identity to master a certain attribute, you set this flag in the mapping direction to Identity to let the connected system only set the attribute on an add operation in Identity and vice versa.</p>
</div>
<div class="paragraph">
<p>If the mapping is more complex, mastering can also be implemented in a Java mapping, as done for the Identifier mapping. The Identifier is mastered by DirX Identity in the default real-time synchronization workflow. In the target system direction, it is set by Identity with the <strong>dxrPrimaryKey</strong> attribute value and results in moving the object in the target system if <strong>dxrPrimaryKey</strong> changes. In the Identity direction, the Identifier is calculated only on an add operation, otherwise the joined object&#8217;s Identifier is taken.</p>
</div>
<div class="paragraph">
<p><strong>Special caution is necessary for the attribute proxyAddresses:</strong></p>
</div>
<div class="paragraph">
<p>The <strong>proxyAddresses</strong> multi-value attribute is handled as case-sensitive in Active Directory because a value starting with the uppercase letters "SMTP:" is considered to be the primary e-mail address of a user in contrast to possible further values starting with the lowercase letters "smtp:". In DirX Identity, the corresponding attribute <strong>dxmEX2kProxyAddresses</strong> is not defined to be case-sensitive but is case-insensitive in the schema; this definition should not be changed in DirX Identity for compatibility reasons. Provisioning it can cause the primary address of a user, which possibly might have been changed by an administrator in Active Directory, to be overwritten with the wrong value of lowercase letters on the next synchronization run to Active Directory, regardless of whether or not a validation has been previously performed.</p>
</div>
<div class="paragraph">
<p>To solve this problem, the <strong>OnAddOnly</strong> flag can be set in the mapping direction to Active Directory for the <strong>proxyAddresses</strong> attribute. This setting can be made because the attribute does not belong to the mailbox-enabling attributes, which must be able to be assigned and unassigned at any time during the lifetime of the user.</p>
</div>
<div class="paragraph">
<p>If you want to set <strong>proxyAddresses</strong> on both an add and a modify operation, you can uncheck the flag <strong>checkModification</strong>. In this case, the join engine does not compare the values of the joined entry in Active Directory with the mapped values but just replaces the values as they are in the mapped entry. Then uppercase and lowercase letters are preserved and must just be provided correctly on synchronization to Active Directory.</p>
</div>
<div class="paragraph">
<p>b. Moving objects</p>
</div>
<div class="paragraph">
<p>The default ADS real-time synchronization workflow can perform a rename/move in AD as follows:</p>
</div>
<div class="paragraph">
<p>If the <strong>dxrPrimaryKey</strong> attribute of the account is changed in Identity (as a result of a user resolution and new calculation of the account attributes, which can have <strong>dependsOn</strong> or <strong>masteredBy</strong> settings in the accounts object description), the workflow performs the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Takes this as the new DN in AD.</p>
</li>
<li>
<p>Tries to find (join) the account with the configured join attributes (trying one after the other).</p>
</li>
<li>
<p>Takes the <strong>samAccountName</strong> attribute as the default, which is unique in the whole AD domain (that&#8217;s why it shouldn&#8217;t change on user resolution in Identity, otherwise another unique attribute must be taken for joining).</p>
</li>
<li>
<p>When the account has been found in AD, takes that DN as the old DN and renames/moves the account from this old DN to the new DN.</p>
</li>
<li>
<p>Puts the current AD DN into the <strong>dxrPrimaryKey</strong> and <strong>dxrPrimaryKeyOld</strong> attributes in Identity on the way back.</p>
</li>
<li>
<p>The dxrPrimaryKeyOld attribute is not taken for synchronization to the connected system but only for other purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Identity &#8594; Connected System</p>
</div>
<div class="paragraph">
<p>a. PostMapping</p>
</div>
<div class="paragraph">
<p>A PostMapping exists only for the group channel in the target system direction. It is used for changing the request type to <strong>DELETE</strong> if the <strong>dxrState</strong> attribute in Identity contains the value <strong>DELETED</strong>. This results in deleting the object in the target system.</p>
</div>
<div class="paragraph">
<p>For accounts, the deletion of objects in the connected system is handled in the userAccountControl Java mapping.</p>
</div>
</div>
<div class="sect4">
<h5 id="_password_channel"><a class="anchor" href="#_password_channel"></a>Password Channel</h5>
<div class="paragraph">
<p>The password channel updates the Active Directory account passwords.</p>
</div>
<div class="paragraph">
<p>The associated SetPassword workflow is started by either the User or the Account Password Event Manager workflow listening for Web Center or Password Listener requests. The Active Directory attributes <strong>unicodePwd</strong> and <strong>pwdLastSet</strong> are mapped from the pseudo source attributes <strong>dxmPassword</strong> and <strong>dxmPasswordExpired</strong>, which are contained only in the password change request and not read from an LDAP attribute.</p>
</div>
<div class="paragraph">
<p>The ADS Set Password workflow also resets the <strong>lockoutTime</strong> attribute to zero (<strong>0</strong>) to finish the user&#8217;s lockout period immediately and to enable him to log in again after his password has been updated.</p>
</div>
<div class="paragraph">
<p>A password channel can also be configured backwards from the connected system to Identity to be able to update some attributes in Identity after a password change or a reset has taken place in the connected system. The join engine then synchronizes the attributes specified in the corresponding password channel mapping to Identity after the account with its password relevant attributes was updated in the connected system.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_ads_workflows"><a class="anchor" href="#_customizing_the_ads_workflows"></a>Customizing the ADS Workflows</h4>
<div class="paragraph">
<p>This section provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A description about delta workflows.</p>
</li>
<li>
<p>Hints and guidelines on how to configure selected versions of Microsoft Exchange.</p>
</li>
<li>
<p>A description of how to run PowerShell scripts.</p>
</li>
<li>
<p>A description of how to manage remote folders with external tools that can execute remote commands.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_ads_delta_workflows"><a class="anchor" href="#_ads_delta_workflows"></a>ADS Delta Workflows</h5>
<div class="paragraph">
<p>For a general explanation of the delta workflows, see the sections under "Java-based Workflow Architecture" in "Understanding the Default Application Workflows" in this guide.</p>
</div>
<div class="paragraph">
<p>The default delta workflow for Active Directory <strong>ADS_Ident_Realtime_Delta</strong> is configured with the delta type <strong>SearchAttributes</strong> in the account and group channels. With this setting and the default search attributes <strong>uSNchanged</strong> and <strong>uSNcreated</strong>, the export search filter is extended by searching only for those objects whose <strong>uSNchanged</strong> or <strong>uSNcreated</strong> attribute values are greater than or equal to the highest value of the last delta run stored in the Identity domain for each channel.</p>
</div>
<div class="paragraph">
<p>If you also want to export the objects that were deleted after the last delta run - in addition to the ones that were changed - you must change the delta type to <strong>Expert Operational Attributes</strong>. This action generates and shows the operational attributes section for the attribute <strong>dxm.delta</strong> and the placeholder value <strong>${LastDeltaValue}</strong>. At runtime, the join engine replaces the placeholder with the last delta state value stored in the Identity domain as a base64-encoded binary value (cookie). It reflects the last value that was returned by Active Directory at the end of the previous delta search.</p>
</div>
<div class="paragraph">
<p>If operational attributes are used for delta searches, several adaptations must be made at the workflow configuration:</p>
</div>
<div class="paragraph">
<p>Search Base Adaptations</p>
</div>
<div class="paragraph">
<p>The ADS connector uses the DirSync LDAP control for doing delta searches. This has the restriction that only root searches are allowed. As a result, the specified search base must be a domain or subdomain; for example, <strong>dc=domain1,dc=munich,dc=my-company,dc=net</strong>. In the default delta workflow configuration, the search base configured at the ADS Connected Directory channels is beneath an organizational unit.</p>
</div>
<div class="paragraph">
<p>To restrict the search result to a certain set of objects, any filter can be specified.</p>
</div>
<div class="paragraph">
<p>Filter Adaptations</p>
</div>
<div class="paragraph">
<p>In the default workflow, the filter <strong>(&amp;(objectClass=user)(objectCategory=person))</strong> is specified. Since deleted objects lose the objectCategory <strong>person</strong>, eliminate that part of the filter.</p>
</div>
<div class="paragraph">
<p>Mapping Adaptations</p>
</div>
<div class="paragraph">
<p>Extend the mapping to Active Directory with the <strong>isDeleted</strong> attribute by inserting a direct mapping <strong>null&#8594;isDeleted</strong> with the attribute flags <strong>readOnly</strong> and <strong>retrievable</strong> set. The mapping function for the <strong>dxrTSState</strong> attribute in Identity evaluates the flag and sets the value <strong>DELETED</strong> for the deleted objects.</p>
</div>
<div class="paragraph">
<p>Mapping Flags Adaptations</p>
</div>
<div class="paragraph">
<p>Since the DirSync LDAP control returns only changed attributes for an object, you must remove the flag <strong>checkModification</strong> for every attribute in the mapping to Identity; otherwise, the attributes are deleted in Identity if they have not been changed in Active Directory and hence do not exist in the list of exported attributes.</p>
</div>
<div class="paragraph">
<p>Hints for Deciding which Delta Type to Use</p>
</div>
<div class="paragraph">
<p>Technical conditions:</p>
</div>
<div class="paragraph">
<p>If you want to integrate the delta workflow into an existing target system with real-time workflows configured to synchronize accounts and groups beneath an organizational unit (like the default ADS real-time workflows do), you must use the default settings of the delta workflow (filter extension type) for this target system, because the search base is configured at the channels and used by all workflows of the target system.</p>
</div>
<div class="paragraph">
<p>Consequently, a delta workflow using operational attributes is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Appropriate primarily for a target system provisioning a complete Active Directory domain,</p>
</li>
<li>
<p>Possible also for a target system with at least the search base specified as the domain root and the search filter specified to get only a subset of objects. Remember that users and groups in Active Directory usually do not have the attribute <strong>ou</strong> configured holding their organizational unit, which would make it possible to set the search filter appropriately and get only objects beneath a certain organizational unit. You can either configure this behavior or use other filters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Scenario considerations:</p>
</div>
<div class="paragraph">
<p>The validation workflow can also recognize changes and deletions made in Active Directory by calculating the differences of the complete set of objects on both sides. It does not evaluate the delta settings resulting in delta exports like the delta workflow does. As a result, there are different possibilities for which workflows and configurations to use depending on your scenario.</p>
</div>
<div class="paragraph">
<p>If you have a scenario with a validation workflow scheduled to run very infrequently - for example, because it takes a long time due to a high number of users and groups to synchronize - and you want to react to changes - especially deletions - made in Active Directory more often, you should choose the delta type of operational attributes.</p>
</div>
<div class="paragraph">
<p>If you have the same scenario without the need to react quickly to deleted and moved objects but with the need to react quickly to changed objects, you can use the default delta type of filter extensions.</p>
</div>
<div class="paragraph">
<p>Moreover, if you have a scenario with a fairly limited set of users, you could schedule a validation workflow more often to recognize the deleted objects and leave the delta workflow with the default settings to recognize the changed objects.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_exchange"><a class="anchor" href="#_configuring_exchange"></a>Configuring Exchange</h5>
<div class="paragraph">
<p>The default Java-based synchronization workflow mapping is configured to provision an Exchange 2016/2019 connected system. The configuration in Provisioning regarding object descriptions and obligation rules for the mailbox-enabling groups is also set up for an Exchange 2016/2019 connected system. This does not affect your existing ADS target systems and workflows.</p>
</div>
<div class="paragraph">
<p>If you create a new ADS target system with the target system wizard (the type in DirX Identity is still called Windows 2000), the base properties of your specific Exchange system have been set - or can be set afterwards - in the Options tab of the new target system.</p>
</div>
<div class="paragraph">
<p>The following section describes other issues related to customizations.</p>
</div>
<div class="paragraph">
<p>Common aspects for all versions greater than or equal to Exchange 2007</p>
</div>
<div class="paragraph">
<p>The ADS connector and the ADS agent (which is used in the Tcl-based workflows) both generate the mandatory attributes msExchMailboxSecurityDescriptor and msExchMailboxGuid automatically when a user is to be mailbox-enabled. The connecto and the agent determine whether or not a user is to be mailbox-enabled by checking whether the attribute msExchRecipientTypeDetails is contained in the list of attributes to be set, which is true only if a mailbox-enabling group was assigned. All other attributes mandatory for creating a fully-functioning Exchange mailbox are created through the standard obligation rules used as source attributes in the mapping to the AD attributes. For a user update in Active Directory, the ADS connector uses the LDAP interface and the ADS Agent uses the ADSI Interface.</p>
</div>
<div class="paragraph">
<p>If you want to synchronize additional Exchange attributes, you have the following choices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you just want to see the content of some more Exchange attributes on the Identity side, you don&#8217;t have to deal with obligation rules at all. You only need to map them towards Identity either to related Identity attributes if they exist in the Identity schema or to some of the various extension attributes (dxmADsExtensionAttribute1-15 and dxmEX2013ExtensionAttribute16-20). You can also adapt the <strong>tsaccount.xml</strong> object description to make them visible in the Active Directory tab of the account.</p>
</li>
<li>
<p>If you want to provision more Exchange attributes towards Active Directory and their related attributes exist in the DirX Identity schema, you can just add obligation rules to fill them and then use them in the mapping in both directions.</p>
</li>
<li>
<p>If their related attributes don&#8217;t exist in the schema on Identity side, you can either extend the Identity schema or just use the various extension attributes by setting them through obligation rules and then mapping them to the desired AD attributes.</p>
</li>
<li>
<p>If you only need to set constant values for some attributes and the related attributes don&#8217;t exist in the schema on the Identity side, be aware that if you just set those values in the mapping towards the connected system, these attributes are then always contained in the requests towards the connected system for "non mailbox- enabled" users provisioned with the same workflow, which can cause problems on user modification. To avoid this situation, you can set the attributes in a Postmapping depending on whether a specific Exchange attribute, for example msExchRecipientTypeDetails, is set, which is only true if a mail-enabling group was assigned. The easiest and recommended way, however, is to fill some extension attributes in obligation rules and map them to AD attributes instead of defining a Postmapping.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Customizing Exchange 2016/2019</p>
</div>
<div class="paragraph">
<p>If you want to provision an Exchange 2016/2019 connected system and you created a new target system with the target system wizard of the current version, you must apply the following customizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Obligations tab of all mailbox-enabling groups you intend to use (dxr mailbox users, dxr shared mailbox creation, dxr room mailbox creation and dxr equipment mailbox creation), adapt the OnAssignment rule generating the multi-value attribute dxmEX2kShowInAddressBook to the values appropriate to your specific Exchange system (DNs of the default Exchange address books).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: Since multi-values can now be directly assigned in obligation rules, the former method of assigning the values in the updateAddressbook.js java script is no longer needed.</p>
</div>
<div class="paragraph">
<p>Customizing Exchange 2013</p>
</div>
<div class="paragraph">
<p>If you want to provision an Exchange 2013 connected system and you created a new target system with the target system wizard of the current version, you must apply the following customizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Obligations tab of all mailbox-enabling groups you intend to use, adapt the OnAssignment rule generating the multi-value attribute dxmEX2kShowInAddressBook to the values appropriate to your specific Exchange system (DNs of the default Exchange address books).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Customizing Exchange 2010</p>
</div>
<div class="paragraph">
<p>If you want to provision an Exchange 2010 connected system and you created a new target system with the target system wizard of the current version, you must apply the following customizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the attribute <strong>homeMTA</strong> to the mapping of both directions and to the obligation rules of the dxr mailbox users group. From Exchange 2013 on, the attribute must not be provisioned because the Transport Server Role can no longer reside on a different server than the Database Server Role.</p>
</li>
<li>
<p>Set the attribute <strong>msExchVersion</strong> in the obligation <strong>onAssignment</strong> rule of the dxr mailbox users group to the value <strong>44220983382016</strong>.</p>
</li>
<li>
<p>Adapt the Java script <strong>updateAddressbook.js</strong> in <strong>Domain</strong> <strong>Configuration</strong> &#8594; <strong>TargetSystems</strong> &#8594; <strong>Windows</strong> <strong>2000</strong> &#8594; <strong>JavaScripts</strong> with the DNs of the default Exchange address books of your Exchange system.</p>
</li>
<li>
<p>In the Obligations tab of all mailbox-enabling groups you intend to use, adapt the OnAssignment rule generating the multi-value attribute dxmEX2kShowInAddressBook to the values appropriate to your specific Exchange system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Customizing Exchange 2007 or Exchange 2003</p>
</div>
<div class="paragraph">
<p>If you want to provision an Exchange 2007 or Exchange 2003 connected system and you created a new target system with the target system wizard of the current version, you must apply the following customizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the attribute <strong>homeMTA</strong> to the mapping of both directions and to the obligation rules of the dxr mailbox users group.</p>
</li>
<li>
<p>Delete the attribute <strong>msExchRecipientTypeDetails</strong> from the mapping and the obligation rules.</p>
</li>
<li>
<p>Delete the attribute <strong>msExchVersion</strong> from the mapping and the obligation rules.</p>
</li>
<li>
<p>Adapt the Java script <strong>updateAddressbook.js</strong> in <strong>Domain Configuration</strong> &#8594; <strong>TargetSystems</strong> &#8594; <strong>Windows 2000</strong> &#8594; <strong>JavaScripts</strong> with the DNs of the default Exchange address books of your Exchange system.</p>
</li>
<li>
<p>In the Obligations tab of all mailbox-enabling groups you intend to use, adapt the OnAssignment rule generating the multi-value attribute dxmEX2kShowInAddressBook to the values appropriate to your specific Exchange system.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_running_powershell_scripts"><a class="anchor" href="#_running_powershell_scripts"></a>Running PowerShell Scripts</h5>
<div class="paragraph">
<p>DirX Identity provides a general user hook class UserHookRunExecutable, which allows running any executable configured in a realtime workflow channel object. For the preUpdate and the postUpdate methods of the user hook, an executable with a command line can be configured in the specific attributes pre_executable and/or post_executable of the channel. The corresponding command lines are specified in pre_cmdline and/or post_cmdline. In the postUpdate case, the executable is only called if the update (add or modify) of the object was successful.</p>
</div>
<div class="paragraph">
<p>The UserHookRunExecutable class starts <strong>powershell.exe</strong> - as a specific executable - only if a PowerShell script name is passed to it as a parameter; otherwise it just logs that nothing needs to be done. This configuration allows always specifying the UserHookRunExecutable class in the General tab of the Accounts channel (and of course any other channel), because the PowerShell script name is now only set with a non-empty value in the standard mapping if a permission-granting mailbox group is assigned to the associated user. In all other cases, the script name is not populated and hence <strong>powershell.exe</strong> is not started.</p>
</div>
<div class="paragraph">
<p>This behavior, along with setting the script name depending on whether or not other (rights-representing) attributes are set, is also useful for modeling other customer-specific requirements.</p>
</div>
<div class="paragraph">
<p>Common Architecture for Running Executables</p>
</div>
<div class="paragraph">
<p>The common architecture and features for running executables from a user hook are described in "Running Executables from a User Hook" in "Understanding the Default Application Workflow Technology".</p>
</div>
<div class="paragraph">
<p>PowerShell Prerequisites</p>
</div>
<div class="paragraph">
<p>A PowerShell script can use the cmdlets that are part of the locally-installed PowerShell instance and it can also use and remotely run cmdlets that are only part of the remotely-installed PowerShell instance. You can even call PowerShell 64-bit cmdlets from clients running a PowerShell 32-bit version.</p>
</div>
<div class="paragraph">
<p>You need to have the Windows Management Framework installed to use PowerShell cmdlets that reside only on the remote server and not on the client machine&#8217;s locally installed PowerShell instance. An example is to administer Exchange using the remote Exchange management cmdlets without having them installed locally.</p>
</div>
<div class="paragraph">
<p>Windows Management Framework includes Windows PowerShell V2 and Windows Remote Management (WinRM) 2.0, which is the Microsoft implementation of the SOAP-based WS (=Web Services)-Management Protocol.</p>
</div>
<div class="paragraph">
<p>For Windows 7 or Windows Server 2008 R2 and newer, the correct version of the Windows Management Framework is already installed.</p>
</div>
<div class="paragraph">
<p>Required PowerShell Settings</p>
</div>
<div class="paragraph">
<p>Apply the following settings to enable the remote server to execute PowerShell commands. For Windows versions greater than or equal to Windows Server 2012, this is usually already enabled by default and so none of the following settings need to be explicitly applied.</p>
</div>
<div class="paragraph">
<p>Server-side settings:</p>
</div>
<div class="paragraph">
<p>Call the command <strong>enable-psremoting</strong> in the Administrator PowerShell of the remote server. It creates a listener for HTTP connections and sets firewall exceptions for Http port 80 and Https port 443.</p>
</div>
<div class="paragraph">
<p>Client-side settings:</p>
</div>
<div class="paragraph">
<p>Call the command <strong>set-executionpolicy remotesigned</strong> in the Administrator PowerShell of the client to enable it to run scripts.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_powershell_script_names_in_the_standard_ads_workflows"><a class="anchor" href="#_specifying_powershell_script_names_in_the_standard_ads_workflows"></a>Specifying PowerShell Script Names in the Standard ADS Workflows</h5>
<div class="paragraph">
<p>The standard ADS real-time workflow account channel is pre-configured to run any PowerShell script - after the account is updated in the connected system - that is passed as a parameter in the source attribute dxmADsExtensionAttribute1 mapped to the target attribute ps_script_name. The script parameters are set in additional extension attributes depending on the groups that are assigned to the accounts’ associated user. Script name and parameters are then passed to the post_cmdline specific attribute, which is taken as input for running <strong>powershell.exe</strong> specified as the executable in post_executable. The extension attributes are cleared in the mapping back to Identity to prevent the PowerShell script from being started again on the next synchronization run.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User Hook name:<br>
The user hook class name com.siemens.dxm.join.userhook.common.UserHookRunExecutable is specified by default in the General tab of the account channel in the ADS direction. If no PowerShell script name is passed in the dxmADsExtensionAttribute1 source attribute in the mapping - which is the case for "normal" accounts with no special mailbox rights assigned or for those accounts that the script has already run once - the UserHookRunExecutable class does not start <strong>powershell.exe</strong> unnecessarily.</p>
</li>
<li>
<p>Specific attribute post_executable:<br>
The PowerShell executable <strong>powershell.exe</strong> is already specified in the specific attribute post_executable. Nothing must be changed here.<br>
<br>
Specific attribute post_cmdline:<br>
The name of the script to run is set through the mapping and passed to post_cmdline as the first parameter. The "$\{env.scripts}" placeholder resolves to the scripts subfolder of the Java-based Server’s repository folder. Consequently, you must:</p>
</li>
<li>
<p>Copy the scripts to run from <em>install_path</em>*\samples\ADS\scripts\* or from your own folder with possibly your own scripts to the scripts subfolder of the Java-based Server’s repository folder if you want to leave the setting, or</p>
</li>
<li>
<p>Specify an absolute path where your scripts reside, or</p>
</li>
<li>
<p>Copy the scripts to a folder contained in the Path variable; for example, into the <strong>bin</strong> subfolder of the associated Java-based Server.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the script path contains a blank, PowerShell expects a <strong>"&amp;"</strong> before the script name and the script name to be enclosed in double quotes and parameters containing blanks to be enclosed in triple double quotes if the script is called from the command line, like this:</p>
</div>
<div class="paragraph">
<p><code><strong>powershell "&amp; ""C:\Documents and Settings\myscript.ps1""" """param 1""" """param 2"""</strong></code></p>
</div>
<div class="paragraph">
<p>If the script is called from within the PowerShell, it is done as follows:</p>
</div>
<div class="paragraph">
<p><code><strong>&amp; "C:\Documents and Settings\script1.ps1" "param 1" "param 2"</strong></code></p>
</div>
<div class="paragraph">
<p>The delivered batch script <strong>runPSS.bat</strong> to start and test PowerShell scripts standalone (not started by the Java-based Server) handles this correctly.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Adaptation of the delivered PowerShell sample scripts to run:<br>
Adapt the variables $server, $binduser and $pwd to your environment. Note that you must generate the encrypted password file yourself, for example <strong>cred.txt</strong>, by running the delivered sample PowerShell script <strong>CreatePasswordFile.ps1</strong> installed under <em>install_path</em><strong>\samples\ADS\scripts\</strong> in the Administrator PowerShell.<br>
<br>
If you do not want to use the PowerShell encrypting password feature, you can also extend the parameter list of the script and pass username and password from the ADS bind profile by adapting the UserHookRunExecutable class, as described in "Running Executables from a User Hook" in "Understanding the Default Application Workflow Technology".</p>
</li>
<li>
<p>Java Server service account:<br>
If your PowerShell script - like the delivered script <strong>AddSharedMailboxPermission.ps1</strong>- reads a password from a file (for example, from <strong>cred.txt</strong> as previously described), that was encrypted by PowerShell running under a specific account, the Java-based Server must also run under this account.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Running an Exchange cmdlet in the Java-based Server</p>
</div>
<div class="paragraph">
<p>In addition to the PowerShell scripts <strong>AddSharedMailboxPermission.ps1</strong> and <strong>RemoveSharedMailboxPermission.ps1</strong>, which are used in the standard ADS realtime synchronization workflow for assigning mailbox rights, DirX Identity delivers sample scripts that contain Exchange cmdlets. These scripts are installed under <em>install_path</em>*\samples\ads\scripts*.</p>
</div>
<div class="paragraph">
<p>The <strong>DisableMailbox.ps1</strong> sample script expects two parameters: one for identifying the mailbox (user principal name) and one for identifying whether or not the mailbox shall be disabled. This parameter can also be set independently from the msExchHideFromAddressLists attribute. It is taken here as one reasonable way for specifying enabling or disabling a mailbox, because a disabled mailbox should also not appear in the global address lists.</p>
</div>
<div class="paragraph">
<p>The <strong>DisableMailbox.ps1</strong> script uses the Disable-Mailbox cmdlet. In addition to removing all mailbox-enabling attributes from the Active Directory user, the Disable-Mailbox cmdlet also performs a cleanup task on the mailbox, disconnecting the mailbox immediately from the user so that you don&#8217;t need to wait for a nightly maintenance complete mailbox database cleanup task.</p>
</div>
<div class="paragraph">
<p>The <strong>ConnectMailbox.ps1</strong> script uses the Connect-Mailbox cmdlet, which reconnects a disconnected mailbox to an Active Directory user.</p>
</div>
<div class="paragraph">
<p>If you want to create a new mailbox for an existing Active Directory user, the Enable-Mailbox cmdlet must be used. You can easily create a new PowerShell script for this task simply by copying the <strong>ConnectMailbox.ps1</strong> script to a new script - for example, <strong>EnableMailbox.ps1</strong> - and then exchanging the Connect-Mailbox cmdlet with Enable-Mailbox, which expects the same parameters as Connect-Mailbox.</p>
</div>
<div class="paragraph">
<p>Note: If you want to mailbox-enable a user by running an Exchange cmdlet (for example, Enable-Mailbox for an existing user or New-Mailbox for a new user) instead of setting the mailbox-enabling attributes with the standard ADS synchronization workflow, adapt the workflow mapping and the obligation rules of the dxr mailbox users group appropriately depending on the attributes you want to pass to the cmdlet as parameters. Cmdlets usually offer a lot of variation on which parameters can be passed and which are set with default values. Read the Microsoft documentation about the complete functionality of each cmdlet you want to use.</p>
</div>
<div class="paragraph">
<p>Running a Lync cmdlet in the Java-based Server</p>
</div>
<div class="paragraph">
<p>You can also extend the standard ADS real-time workflow to run a PowerShell script containing Lync cmdlets to be executed on the remote Skype for Business Server (formerly Lync Server). For an explanation about how to pass parameters to the script, how to provide credentials and where to place the script, see the instructions given in "Running an Exchange cmdlet in the Java-based Server".</p>
</div>
<div class="paragraph">
<p>The sample script <strong>LyncEnableUser.ps1</strong> is installed under <em>install_path</em>*\samples\ads\scripts*. Running it is an alternative way to lync-enable a user instead of doing it by mapping all lync-enabling attributes produced by the obligation rules of the dxr lync enabling group as done in the default ADS real-time workflow.</p>
</div>
<div class="paragraph">
<p>The <strong>LyncEnableUser.ps1</strong> script uses the Enable-CsUser cmdlet for lync-enabling a user. The Disable-CsUser cmdlet is also described in this script as well as other lync-handling cmdlet samples.</p>
</div>
<div class="paragraph">
<p>In order to be allowed to remotely execute the cmdlets, a secure connection to the Lync Server over https is required. As a prerequisite for such a secure connection, the root CA certificate that issued the lync-related certificates must be imported into the Trusted Root Store of the workstation running the script.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A user in Active Directory with administrative rights can only be lync-enabled by using either the AdsConnector to set the lync-enabling attributes or by running the Enable-CsUser PowerShell cmdlet. It cannot be lync-enabled by using the Skype for Business (formerly Lync Server) "Control Panel" admin tool.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_remote_folder_management"><a class="anchor" href="#_remote_folder_management"></a>Remote Folder Management</h5>
<div class="paragraph">
<p>Remote Folder Management can be performed using the related PowerShell cmdlets, but you can also use this older tool described here.</p>
</div>
<div class="paragraph">
<p>The functionality described here allows the management of folders and shares on a remote computer running the Windows 2003 Server operating system or newer. You can use it in a user hook or in the attribute mapping code of a Java-based workflow. It can create and delete folders on a remote computer and copy/move folders between remote computers.</p>
</div>
<div class="paragraph">
<p>Architecture</p>
</div>
<div class="paragraph">
<p>The remote execution works over $ADMIN and $IPC shares on the remote computer. The external CLI utility accesses the $ADMIN share to set up the remote listener service and then passes remote commands via $IPC share. Results and outputs from these commands are returned to the Java code. The following figure illustrates this control flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image3.png" alt="Remote Folder Management Architecture">
</div>
<div class="title">Figure 3. Remote Folder Management Architecture</div>
</div>
<div class="paragraph">
<p>With the exception of <strong>ssh</strong>, all of the tools use $IPC and $ADMIN shares. The remote management functionality that has been used and tested in customer projects includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create folder</p>
</li>
<li>
<p>delete folder</p>
</li>
<li>
<p>move/copy folder</p>
<div class="ulist">
<ul>
<li>
<p>inside partition</p>
</li>
<li>
<p>over partition</p>
</li>
<li>
<p>over machines</p>
</li>
</ul>
</div>
</li>
<li>
<p>check if folder exists</p>
</li>
<li>
<p>set folder file system permissions</p>
<div class="ulist">
<ul>
<li>
<p>account name/SID support</p>
</li>
</ul>
</div>
</li>
<li>
<p>create share</p>
</li>
<li>
<p>set share permissions</p>
<div class="ulist">
<ul>
<li>
<p>account name/SID support</p>
</li>
</ul>
</div>
</li>
<li>
<p>delete share</p>
</li>
<li>
<p>convert share name to local path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CLI Tools</p>
</div>
<div class="paragraph">
<p>To enable remote management, you need to select a toolkit. The following list evaluates tools that can be used to execute commands remotely. <strong>xCmd</strong> is the preferred tool.</p>
</div>
<div class="paragraph">
<p><strong>xCmd</strong></p>
</div>
<div class="paragraph">
<p>+ freeware<br>
+ nothing required on target machine (service is copied automatically)<br>
+ sources are available<br>
- works only between Windows machines</p>
</div>
<div class="paragraph">
<p>For more information and for download, visit: <a href="http://www.codeguru.com/Cpp/I-N/network/remoteinvocation/article.php/c5433" class="bare">http://www.codeguru.com/Cpp/I-N/network/remoteinvocation/article.php/c5433</a></p>
</div>
<div class="paragraph">
<p><strong>PsExec</strong></p>
</div>
<div class="paragraph">
<p>+ nothing required on target machine (service is copied automatically)<br>
- works only on Windows machines</p>
</div>
<div class="paragraph">
<p>For more information and for download, visit: <a href="http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx" class="bare">http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx</a></p>
</div>
<div class="paragraph">
<p><strong>winexe</strong></p>
</div>
<div class="paragraph">
<p>+ freeware<br>
+ sources available<br>
+ nothing required on target machine<br>
- works only from UNIX to Windows machines</p>
</div>
<div class="paragraph">
<p>For more information and for download, visit: <a href="http://sourceforge.net/projects/winexe" class="bare">http://sourceforge.net/projects/winexe</a>.</p>
</div>
<div class="paragraph">
<p><strong>ssh</strong></p>
</div>
<div class="paragraph">
<p>+ freeware<br>
+ sources available<br>
+ reliable<br>
+ works from any of the supported platforms to any other<br>
- needs ssh-keygen to prepare ssh keys so that it doesn&#8217;t prompt for a password.<br>
- manual sshd installation on remote machine required</p>
</div>
<div class="paragraph">
<p>Support Utilities</p>
</div>
<div class="paragraph">
<p>The following set of utilities provides useful functions on a remote machine.</p>
</div>
<div class="paragraph">
<p>Part of standard Windows installation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mkdir</p>
</li>
<li>
<p>rmdir</p>
</li>
<li>
<p>dir</p>
</li>
<li>
<p>xcopy</p>
</li>
<li>
<p>move</p>
</li>
<li>
<p>cacls</p>
</li>
<li>
<p>net share</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>External utilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>setacl 2.x (supports SID identifiers in place of account names, <a href="http://setacl.sourceforge.net/" class="bare">http://setacl.sourceforge.net/</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Requirements</p>
</div>
<div class="paragraph">
<p>To set up and use folder management based on the xCmd utilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reference the dxmJoin.jar package, which contains the necessary classes, in com.siemens.dxm.join.userhook.ads.</p>
</li>
<li>
<p>The xCmd utility must be available in the executable path of the IdS-J server.</p>
</li>
<li>
<p>The account that will be used to access a remote computer must have admin privileges on the remote computer. The account is not to be specified in DN format.</p>
</li>
<li>
<p>The IdS-J server must run under an account with set password to be able to connect to the network. The default LocalSystem account is therefore not suitable.</p>
</li>
<li>
<p>When setting the account permission to a folder or share, note that the account must be visible on the remote computer unless you are using the account SID and the correct domain prefix must be specified if necessary.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Deployment</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the xCmd utility to the path where the IdS-J server can find it.</p>
</li>
<li>
<p>If necessary, copy the setacls utility to all target machines that will be managed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Usage Sample</p>
</div>
<div class="paragraph">
<p>This functionality can be used, for example, to implement the creation of user home and profile folders with appropriate shares on a given user home server within Active Directory target system provisioning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create account</p>
</li>
<li>
<p>change account attributes</p>
</li>
<li>
<p>delete account</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some permanent configuration information is stored as target system environment variables (root of home folders, default permissions to be set). Account credentials to connect remotely to the home server are extracted from the target system connection obtained from the environment (same account used).</p>
</div>
<div class="paragraph">
<p>The user hook is bound to the account channel of the target system. The channel mapping manages the <strong>homeFolder</strong> and <strong>profilePath</strong> attributes of Active Directory. When creating the folders after a new account is created, permissions are not set within the given user account name, but within the user SID, because the home server does not know about the new account immediately.</p>
</div>
<div class="paragraph">
<p>The user hook handles the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add request: the source entry is searched for the home folder attribute and when found, folder and share are created.</p>
</li>
<li>
<p>Modify request: the account state modification is checked first. If it is presented, it is evaluated first (see below). If not, the request is searched for the home folder modification and when found and it differs from the source entry value, folders are moved and shares are recreated in a new location.</p>
</li>
<li>
<p>If the account state changes to DISABLED: no action is performed.</p>
</li>
<li>
<p>If the account state changes to ENABLED: folder and share are checked for existence and created if necessary.</p>
</li>
<li>
<p>Delete request: the source entry is searched for the home folder attribute and when found, folders and shares are deleted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional Information</p>
</div>
<div class="paragraph">
<p>For additional information, search for the FolderManager.java class under the Additions\RealtimeWorkflows folder of the DirX Identity delivery media. It contains a channel user hook template for creation of the account home folder and share.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_citrix_sharefile_workflows"><a class="anchor" href="#_citrix_sharefile_workflows"></a>Citrix ShareFile Workflows</h3>
<div class="paragraph">
<p>The Citrix ShareFile Provisioning workflows operate between a target system of type <strong>LDAP</strong> in the Identity Store and the corresponding connected Citrix ShareFile application.</p>
</div>
<div class="paragraph">
<p>The workflows use the Citrix ShareFile connector for provisioning. This connector communicates with the Citrix ShareFile across the HTTP protocol.</p>
</div>
<div class="paragraph">
<p>The workflows handle the following objects:</p>
</div>
<div class="paragraph">
<p><strong>Users</strong> - the Citrix ShareFile users and contacts.</p>
</div>
<div class="paragraph">
<p><strong>Groups</strong> - the Citrix ShareFile groups.</p>
</div>
<div class="paragraph">
<p>The delivered workflows are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_Citrix ShareFile_Realtime</strong> - the synchronization workflow that exports detected changes for account and group objects from Identity Store to the Citrix ShareFile cloud and then validates the processed changes in the Citrix ShareFile to the Identity Store.</p>
</li>
<li>
<p><strong>Validate_Citrix ShareFile_Realtime</strong> - the validation workflow that imports existing Citrix ShareFile users and groups with group assignments from the Citrix ShareFile cloud to the Identity Store.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_citrix_sharefile_prerequisites_and_limitations"><a class="anchor" href="#_citrix_sharefile_prerequisites_and_limitations"></a>Citrix ShareFile Prerequisites and Limitations</h4>
<div class="paragraph">
<p>Depending on the type of Citrix subscription, the maximum number of employees that can be managed by DirX Identity may be limited.</p>
</div>
<div class="paragraph">
<p>It is not possible to change a group&#8217;s name using the GUI in the DirX Identity Manager.</p>
</div>
<div class="paragraph">
<p>The delivered workflows do not configure password synchronization.</p>
</div>
<div class="paragraph">
<p>Because of a constraint in DirX Identity when handling membership for a user without an existing account in Citrix, the e-mail address is used to identify the user inside an SPML modify request. (The same condition applies to an add request.) If there is already an account for the user in Citrix, the Citrix id is used to identify the user inside an SPML modify request.</p>
</div>
<div class="paragraph">
<p>The Citrix ShareFile API does not allow you to create a user with the same e-mail address as an existing user. Such an attempt fails. The Citrix ShareFile connector returns the ID of the user with this e-mail address in the SPML response.</p>
</div>
<div class="paragraph">
<p>The Citrix ShareFile API does allow you to create a group with the same name as an existing group. However, the Citrix ShareFile connector does not forward such a request to Citrix and returns an error.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_citrix_sharefile"><a class="anchor" href="#_connecting_to_citrix_sharefile"></a>Connecting to Citrix ShareFile</h4>
<div class="paragraph">
<p>To configure the connection to Citrix ShareFile:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the name of the Citrix ShareFile server.</p>
</li>
<li>
<p>Set up the bind credentials of the connected directory representing Citrix ShareFile. Use a ShareFile account with sufficient rights.</p>
</li>
<li>
<p>Specify the HTTP proxy in the bind profile if necessary.</p>
</li>
<li>
<p>Check the provisioning settings used by the connected Citrix ShareFile system. Specify them according to real values for your provisioned Citrix ShareFile target system.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_citrix_sharefile_target_system"><a class="anchor" href="#_configuring_the_citrix_sharefile_target_system"></a>Configuring the Citrix ShareFile Target System</h4>
<div class="paragraph">
<p>The Citrix ShareFile target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - all accounts are located in a subfolder <strong>Accounts</strong>.</p>
</li>
<li>
<p><strong>Groups</strong> - all groups are located in a subfolder <strong>Groups</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The attribute <strong>dxrPrimaryKey</strong> of accounts and groups contains the identifier of these objects in the connected system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_citrix_sharefile_workflow_and_activities"><a class="anchor" href="#_citrix_sharefile_workflow_and_activities"></a>Citrix ShareFile Workflow and Activities</h4>
<div class="paragraph">
<p>The Citrix ShareFile users and group (and membership) are synchronized via a pair of channels (one channel per direction). The membership in Identity is stored on accounts. See the default Citrix ShareFile workflow for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_citrix_sharefile_ports"><a class="anchor" href="#_citrix_sharefile_ports"></a>Citrix ShareFile Ports</h4>
<div class="paragraph">
<p>This section describes the Citrix ShareFile ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
A Citrix ShareFile filter is configured implicitly. It is used to send the decrypted password attribute <strong>userPassword</strong> to the Citrix ShareFile cloud.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dirx_access_workflows"><a class="anchor" href="#_dirx_access_workflows"></a>DirX Access Workflows</h3>
<div class="paragraph">
<p>There are two methods to connect DirX Access with DirX Identity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DirX Access can directly make use of the DirX Identity target system.</p>
</li>
<li>
<p>DirX Identity can provision DirX Access via standard LDAP workflows.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first method is easy to set up and handle, is always up to date and avoids any synchronization effort.</p>
</div>
<div class="paragraph">
<p>The second method should be used if the combined load coming from DirX Access and DirX Identity is too high for the directory server.</p>
</div>
<div class="sect3">
<h4 id="_using_the_target_system"><a class="anchor" href="#_using_the_target_system"></a>Using the Target System</h4>
<div class="paragraph">
<p>This variant assumes that DirX Access uses directly the DirX Identity target system. Perform these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up a virtual target system in DirX Identity. State handling is not necessary for this type of target system.</p>
</li>
<li>
<p>Set up DirX Access to use the DirX Identity target system as user store. Read the corresponding DirX Access documentation.</p>
</li>
<li>
<p>Test the solution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All changes of accounts and group memberships in DirX Identity are immediately visible from DirX Access.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_ldap_connectivity"><a class="anchor" href="#_using_ldap_connectivity"></a>Using LDAP Connectivity</h4>
<div class="paragraph">
<p>In this model we assume two different directory server instances: one keeps the Identity Store, the other one acts as DirX Access repository.</p>
</div>
<div class="paragraph">
<p>To set up this solution, perform these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new target system of type LDAP in DirX Identity. The necessary synchronization and validation workflows will be automatically configured.</p>
</li>
<li>
<p>Adapt the mapping of the synchronization and validation workflows according to the requirements of DirX Access.</p>
</li>
<li>
<p>Test the solution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case provisioning changes (account and group changes) are propagated with real-time workflows to DirX Access. The delay is typically only a few seconds.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_evidian_esso_workflow"><a class="anchor" href="#_evidian_esso_workflow"></a>Evidian ESSO Workflow</h3>
<div class="paragraph">
<p>The Evidian ESSO system is an Active Directory (ADS) or LDAP target system in which every account can be enabled for single sign-on (SSO) to intranet- and extranet-based applications.</p>
</div>
<div class="paragraph">
<p>A target system associated with the application to be accessed via SSO from user accounts in the ADS/LDAP ESSO target system is configured in the Evidian ESSO workflow. This configuration allows a user who is logged into the ADS/LDAP ESSO connected system with the corresponding ADS/LDAP account to access the application-specific connected system - for example, a Salesforce system - without additional login.</p>
</div>
<div class="paragraph">
<p>The Evidian ESSO workflow operates between an Identity Store and an ADS/LDAP ESSO connected system. The workflow uses the LDAP connector on the Identity Store side and the ESSO connector on the Evidian ESSO side. The connector communicates via the Evidian User Access Web Service (labeled <strong>ESSO Web API</strong> in the next figure). The following figure shows this deployment:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image4.png" alt="Evidian ESSO Provisioning Workflow Architecture">
</div>
<div class="title">Figure 4. Evidian ESSO Provisioning Workflow Architecture</div>
</div>
<div class="paragraph">
<p>To provision the Evidian ESSO system, you create an Evidian ESSO connected directory and link it to the ADS/LDAP ESSO target system&#8217;s connected directory. The following figure illustrates the simplified data model in Connectivity/Provisioning:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image5.png" alt="Evidian ESSO Provisioning Workflow Data Flow">
</div>
<div class="title">Figure 5. Evidian ESSO Provisioning Workflow Data Flow</div>
</div>
<div class="sect3">
<h4 id="_evidian_esso_workflow_prerequisites_and_limitations"><a class="anchor" href="#_evidian_esso_workflow_prerequisites_and_limitations"></a>Evidian ESSO Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Evidian ESSO workflow has the following prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Evidian User Access Web Service must be reachable.</p>
</li>
<li>
<p>The Evidian certificate authority (CA) must be added to the <strong>cacerts</strong> file used by the Java-based Server (IdS-J).</p>
</li>
<li>
<p>The Evidian ESSO system must be configured as an Active Directory target system. The accounts must be available (at least in the state IMPORTED) and linked to a user.</p>
</li>
<li>
<p>To perform ESSO provisioning for the ADS ESSO target system, a connected directory of type ESSO (shown as <strong>ESSO</strong> in the previous figure) must be configured and linked with the ADS ESSO connected directory (shown as <strong>ADS/LDAP ESSO</strong> in the previous figure).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Evidian ESSO workflow assumes that a boolean flag <strong>dxrOptions(enablesso)</strong> is configured for the account. It&#8217;s up to you how to populate it. You can define a flag at the user that is mastered to the account or you can define rules that specify for which accounts ESSO should be enabled. Here is a target system instance-specific object description extension for the definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">...
&lt;!-- LDAP specific property pages --&gt;
&lt;propertysheet&gt;

  &lt;propertypage name="Esso"
      insertafter="AccountGeneral"
      class="siemens.dxr.manager.nodes.customizer.GenericPropertyPage"
      title="Esso Enabling"
      layout="dxrOptions(enableEsso)"
      helpcontext="mr_ts_group_tsspecific"/&gt;
  &lt;/propertysheet&gt;

&lt;!-- LDAP specific properties --&gt;
&lt;properties&gt;
  &lt;property name="dxrOptions(enableEsso)"
      type="java.lang.Boolean"
      label="Enable for SSO"
      readonly="false"
      multivalue="false"
  /&gt;
&lt;/properties&gt;
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_the_evidian_esso_workflow"><a class="anchor" href="#_setting_up_the_evidian_esso_workflow"></a>Setting up the Evidian ESSO Workflow</h4>
<div class="paragraph">
<p>To set up the Evidian ESSO workflow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the ADS or LDAP target system for the Evidian ESSO system.</p>
</li>
<li>
<p>Run the validation workflow to get the account data.</p>
</li>
<li>
<p>Link the accounts to the users.</p>
</li>
<li>
<p>Introduce the "enable SSO" flag into the target system associated with the application; for example, the Salesforce TS.</p>
</li>
<li>
<p>Create the Evidian ESSO connected directory and then link it to the ADS ESSO target system that you created in the first step.</p>
</li>
<li>
<p>Create the Evidian ESSO workflow and then link to the target system associated with the application.</p>
</li>
<li>
<p>Add the Evidian certificate authority (CA) to <strong>cacerts</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_evidian_esso"><a class="anchor" href="#_connecting_to_evidian_esso"></a>Connecting to Evidian ESSO</h4>
<div class="paragraph">
<p>In the Provisioning tab of the ESSO connected directory configuration object, specify the URL to the Evidian Web Service. In the Bind Profiles tab, specify a user and a password.</p>
</div>
</div>
<div class="sect3">
<h4 id="_evidian_esso_workflow_and_activities"><a class="anchor" href="#_evidian_esso_workflow_and_activities"></a>Evidian ESSO Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the Evidian ESSO workflow&#8217;s join activity objects at the Identity Store and connected system sides as well as the related ports and channels and their relationships.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image6.png" alt="Evidian ESSO Provisioning Workflow Join Activity" width="Channels and Objects">
</div>
<div class="title">Figure 6. Evidian ESSO Provisioning Workflow Join Activity, Channels and Objects</div>
</div>
</div>
<div class="sect3">
<h4 id="_esso_workflow"><a class="anchor" href="#_esso_workflow"></a>ESSO Workflow</h4>
<div class="paragraph">
<p>In <strong>General</strong> &#8594; <strong>Associated</strong> <strong>TS</strong> for the Evidian ESSO workflow configuration object, specify the target system that corresponds to the application you want to access via Evidian ESSO. The <strong>Is</strong> <strong>applicable for</strong> section for the workflow must match the <strong>Match</strong> properties defined in the associated target system. The workflow uses the SynchOneWay controller.</p>
</div>
</div>
<div class="sect3">
<h4 id="_evidian_esso_workflow_ports"><a class="anchor" href="#_evidian_esso_workflow_ports"></a>Evidian ESSO Workflow Ports</h4>
<div class="paragraph">
<p>This section provides information about the Evidian ESSO Provisioning workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
The standard crypt filter for password decryption.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_evidian_esso_workflow_channels"><a class="anchor" href="#_evidian_esso_workflow_channels"></a>Evidian ESSO Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about Evidian ESSO channels. Only accounts are supported. Since a SynchOneWay controller is used, the channel on the Identity side is only relevant for reading the necessary attributes.</p>
</div>
<div class="sect4">
<h5 id="_common_aspects"><a class="anchor" href="#_common_aspects"></a>Common Aspects</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; ESSO</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID is calculated using the environment variables <strong>essouser</strong> and <strong>essoapplication</strong>. The environment variable <strong>essoapplication</strong> is configured at the account channel in the Specific Attributes tab and is always <strong>DirXIdentity</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_user_hook"><a class="anchor" href="#_user_hook"></a>User Hook</h5>
<div class="paragraph">
<p>com.siemens.dxm.join.userhook.esso.UserHookAccountsTo</p>
</div>
<div class="paragraph">
<p>Implements the "Process Source Entry" procedure. It reads the user link of the source entry and tries to find the corresponding account in the ADS/LDAP ESSO target system. It provides the DN (in the connected system) of this account and the State attributes in the following environment properties: <strong>essouser</strong>, <strong>essouserstate</strong>, <strong>essousercsstate</strong>.</p>
</div>
<div class="paragraph">
<p>If the account cannot be found, it returns false and the entry will not be processed (you can&#8217;t manage Evidian ESSO accounts without an Active Directory account).</p>
</div>
</div>
<div class="sect4">
<h5 id="_exportjoin"><a class="anchor" href="#_exportjoin"></a>Export/Join</h5>
<div class="paragraph">
<p>A simple expression is used:</p>
</div>
<div class="exampleblock">
<div class="content">
${env.essouser} + ",application=" + ${env.essoapplication} + ",role=DirXIdentity"
</div>
</div>
<div class="paragraph">
<p>The user DN part of the identifier is taken from the environment property <strong>essouser</strong> which is populated by the processSourceEntry user hook. The application part is taken from the <strong>essoapplication</strong> environment property. The join expression is just a dummy as the connecter does not support filters. The whole Join criteria is given by the base DN, which identifies exactly one account in the ADS/LDAP ESSO connected system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_id_mapping"><a class="anchor" href="#_id_mapping"></a>ID Mapping</h5>
<div class="paragraph">
<p>ID mapping is a Java source mapping. It corresponds to the base object of the export (if no joined entry is found):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String adsUserDN = (String) env.get("essouser");
String application = (String) env.get("essoapplication");
targetIdStr = adsUserDN + ",application="+application+",role=DirXIdentity";</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_post_mapping"><a class="anchor" href="#_post_mapping"></a>Post Mapping</h5>
<div class="paragraph">
<p>Post mapping is a Java source mapping. The following attributes control the outcome:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The State attributes of the corresponding ADS/LDAP ESSO account (from environment)</p>
</li>
<li>
<p>The dxrState of the source entry (the account in the associated target system)</p>
</li>
<li>
<p>The flag that specifies whether ESSO should be enabled in the default <strong>dxrOption(enableesso)</strong> attribute of the source entry (the account in the associated target system)</p>
</li>
<li>
<p>The joined entry (whether it is available)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_application"><a class="anchor" href="#_application"></a>Application</h5>
<div class="paragraph">
<p>The application is defined as a Specific Attribute at the channel configuration object.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_evidian_esso_workflow"><a class="anchor" href="#_customizing_the_evidian_esso_workflow"></a>Customizing the Evidian ESSO Workflow</h4>
<div class="paragraph">
<p>This section describes how to customize the Evidian ESSO Provisioning workflow.</p>
</div>
<div class="sect4">
<h5 id="_using_a_different_enable_sso_flag"><a class="anchor" href="#_using_a_different_enable_sso_flag"></a>Using a Different Enable-SSO Flag</h5>
<div class="paragraph">
<p>If you want to use another attribute or another mechanism to define whether an account should be enabled for SSO:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit the postmapping to get the flag</p>
</li>
<li>
<p>Adapt the object description to manage this flag (optional)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_exporting_the_search_base_on_the_identity_side"><a class="anchor" href="#_exporting_the_search_base_on_the_identity_side"></a>Exporting the Search Base on the Identity Side</h5>
<div class="paragraph">
<p>By default, <strong>"cn=Accounts,"${env.assocts}"* is used as the search base. If your associated target system holds accounts and groups in the same folder, you need to change this to: *"cn=Accounts and Groups,"${env.assocts}"</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_google_apps_workflows"><a class="anchor" href="#_google_apps_workflows"></a>Google Apps Workflows</h3>
<div class="paragraph">
<p>The Google Apps Provisioning workflows operate between a target system of type LDAP in the Identity Store and the corresponding connected Google Apps endpoint.</p>
</div>
<div class="paragraph">
<p>The workflows use the Google Apps connector for provisioning. This connector communicates with the Google Apps endpoint across the HTTP protocol using a REST API provided by Google, called Admin Directory API.</p>
</div>
<div class="paragraph">
<p>The connector uses Google OAuth service for authentication and authorization purposes.</p>
</div>
<div class="paragraph">
<p>The workflows handle the following objects:</p>
</div>
<div class="paragraph">
<p><strong>Users</strong> - the Google Apps users.</p>
</div>
<div class="paragraph">
<p><strong>Groups</strong> - the Google Apps groups.</p>
</div>
<div class="paragraph">
<p>The delivered workflows are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_GoogleApps_Realtime</strong> - the synchronization workflow that exports detected changes for account and group objects from the Identity Store to the GoogleApps server and then validates the processed changes in Google Apps to the Identity Store. The workflow also generates a password if the object is created.</p>
</li>
<li>
<p><strong>Validate_GoogleApps_Realtime</strong> - the validation workflow that imports existing Google Apps users and groups along with group assignments from Google Apps to the Identity Store.</p>
</li>
<li>
<p><strong>SetPassword in Google Apps</strong> - the workflow that sets the password for the user object in GoogleApps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates the Google Apps Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image7.png" alt="Google Apps Workflow Architecture">
</div>
<div class="title">Figure 7. Google Apps Workflow Architecture</div>
</div>
<div class="sect3">
<h4 id="_google_apps_workflow_prerequisites_and_limitations"><a class="anchor" href="#_google_apps_workflow_prerequisites_and_limitations"></a>Google Apps Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Google Apps connector acts as a remote application to the Google Apps system. As a result, you need to create a Google Admin Account and then link it to a Google Service Account in order to be able to access the API using the OAuth 2.0. (For details, see <strong><a href="https://developers.google.com/accounts/docs/OAuth2Login" class="bare">https://developers.google.com/accounts/docs/OAuth2Login</a></strong>.)</p>
</div>
<div class="paragraph">
<p>To obtain Google Admin Directory API credentials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log in to the Google Developers Console with your admin user credentials at <strong><a href="https://console.developers.google.com" class="bare">https://console.developers.google.com</a></strong>.</p>
</li>
<li>
<p>Create a new project. You need only provide a name; for example, <strong>DirX-Interop</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> window, navigate to <strong>APIs &amp; auth</strong> &#8594; <strong>APIs</strong>.</p>
</li>
<li>
<p>Search for the <strong>Admin</strong> <strong>SDK</strong> <strong>API</strong> and enable it for this user.</p>
</li>
<li>
<p>Navigate to <strong>APIs</strong> <strong>&amp;</strong> <strong>auth</strong> &#8594; <strong>Credentials</strong> and then create a new Service Account:</p>
</li>
<li>
<p>In the <strong>OAuth</strong> section, click <strong>Create new Client ID</strong>.</p>
</li>
<li>
<p>From the pop-up window, select the <strong>Service</strong> account and then click <strong>Create</strong> <strong>Client</strong> <strong>ID</strong>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Your Client ID, Service Account Email and Private P12 Key have been generated (Please download your generated key as a P12 file. You will need it when setting up the Google Apps connected directory in DirX Identity).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the Google Admin Directory API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log in to the Google Admin Console with your admin user credentials at <strong><a href="https://admin.google.com" class="bare">https://admin.google.com</a></strong>.</p>
</li>
<li>
<p>Navigate to <strong>Security</strong> &#8594; <strong>Advanced</strong> <strong>settings</strong> &#8594; <strong>Manage</strong> <strong>OAuth</strong> <strong>Client</strong> <strong>access</strong>.</p>
</li>
<li>
<p>In <strong>Client</strong> <strong>Name</strong>, enter the client ID generated by Google in the Developers Console.</p>
</li>
<li>
<p>In <strong>One or more API Scopes</strong>, enter the Google API scope URLs, separated by commas (we only need to be able to modify users and groups: <strong><a href="https://www.googleapis.com/auth/admin.directory.group" class="bare">https://www.googleapis.com/auth/admin.directory.group</a>, <a href="https://www.googleapis.com/auth/admin.directory.user" class="bare">https://www.googleapis.com/auth/admin.directory.user</a></strong>).</p>
</li>
<li>
<p>Click <strong>Authorize</strong> and then check to see that your changes appear in the list below. Note that when you make these changes, it takes Google a little time to apply them on its side.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you are ready to use the Google Admin Directory API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_google_apps"><a class="anchor" href="#_connecting_to_google_apps"></a>Connecting to Google Apps</h4>
<div class="paragraph">
<p>To configure the connection to Google Apps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up the bind credentials of the connected directory that represents the Google Apps system. Use the correct credentials (with sufficient rights). These are the credentials used for administration of the Google Apps domain. The User must be a valid Google Apps user name or e-mail address.</p>
</li>
<li>
<p>Set up the following items in your Google Apps connected directory (in the Google API tab):</p>
</li>
<li>
<p>Private Key - use the P12 file generated by Google for your account.</p>
</li>
<li>
<p>Service Account Email - use the one generated by the Google developer console.</p>
</li>
<li>
<p>Application Name - you can use anything you like.</p>
</li>
<li>
<p>Domain Name - must contain the name of your company domain. (If the domain is not configured (default) it is deduced from the bind profile user id)</p>
</li>
<li>
<p>If necessary, specify the HTTP proxy server in the HTTP/HTTPS Proxy Server tab.</p>
</li>
<li>
<p>Check the provisioning settings used by the connected Google Apps system and set them to the values required by your provisioned Google Apps target system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To run the Google Apps workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign the resource family <strong>GoogleApps</strong> in the IdS-J server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_google_apps_target_system"><a class="anchor" href="#_configuring_the_google_apps_target_system"></a>Configuring the Google Apps Target System</h4>
<div class="paragraph">
<p>The Google Apps target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - all accounts (Google Apps users) are located in a subfolder <strong>Accounts</strong>.</p>
</li>
<li>
<p><strong>Groups</strong> - all groups are located in a subfolder <strong>Groups</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of accounts and groups contains the identifier of these objects in the connected system. This attribute is generated only by Google.</p>
</div>
<div class="paragraph">
<p>The group membership is stored at the account object and references the <strong>dxrPrimaryKey</strong> attribute of group objects.</p>
</div>
<div class="paragraph">
<p>Configure the <strong>Domain</strong> property at the target system at the Options tab. This value is used as a suffix for Google Apps <strong>User</strong> <strong>Email</strong> and <strong>Group</strong> <strong>Email</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_google_apps_workflow_and_activities"><a class="anchor" href="#_google_apps_workflow_and_activities"></a>Google Apps Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the Google Apps workflow join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image8.png" alt="Google Apps Workflow Channels and Objects">
</div>
<div class="title">Figure 8. Google Apps Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>The Google Apps users and groups (and memberships) are synchronized via a pair of channels (one channel per direction). The membership in the Identity Store is stored in accounts. See the default Google Apps workflow for details</p>
</div>
</div>
<div class="sect3">
<h4 id="_google_apps_ports"><a class="anchor" href="#_google_apps_ports"></a>Google Apps Ports</h4>
<div class="paragraph">
<p>This section describes the Google Apps ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
A Google Apps filter is configured implicitly. It is used to send the decrypted password attribute <strong>userPassword</strong> to the Google Apps endpoint.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_google_apps_account_channel_mapping"><a class="anchor" href="#_google_apps_account_channel_mapping"></a>Google Apps Account-Channel Mapping</h4>
<div class="paragraph">
<p>In the account channel mapping, many LDAP attribute are mapped to/from Google Apps attributes. The following attributes receive special handling:</p>
</div>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Google Apps</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID - dxrPrimaryKey</p>
</li>
<li>
<p>Join - $\{source.dxrPrimaryKey}</p>
</li>
<li>
<p>Password - remember that the account’s password is inherited from the user object in Identity Store when you assign a group to a user (and the account is then created implicitly). If no password is present at the user, the account’s password is initially set to the default password. Check to make sure that the passwords comply with the password policies in effect for the Google Apps system. (By default, Google needs a password with a minimum length of eight (8) characters).</p>
</li>
<li>
<p>userName - this attribute doesn’t need mapping because Google automatically generates the user name by concatenating the givenName and familyName</p>
</li>
<li>
<p>givenName - this attribute is set to "N/A" if the user doesn’t provide a givenName.</p>
</li>
<li>
<p>orgUnitPath - the root (<strong>/</strong>) is always mapped to this attribute because the connector doesn’t support the full functionality of the Google Apps organizational units.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Google Apps &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID - $\{joinedEntry.id} or "cn="${source.userName}","+${env.role_ts_account_base}</p>
</li>
<li>
<p>Join - ${target.dxrPrimaryKey} or ${target.id}.</p>
</li>
<li>
<p>givenName - ${joinedEntry.givenName} or ${source.givenName} because the Google Apps system may register the changes after the validate workflow is finished.</p>
</li>
<li>
<p>sn - ${joinedEntry.sn} or ${source.familyName} because the Google Apps system may register the changes after the validate workflow is finished.</p>
</li>
<li>
<p>dxrName - ${joinedEntry.dxrName} or ${source.userName} because the Google Apps system may register the changes after the validate workflow is finished.</p>
</li>
<li>
<p>c, l, postalCode, postalAddress, postOfficeBox, st, street - these attributes are all mapped from Google&#8217;s multi-valued <strong>addresses</strong> attribute only for the address flagged as <strong>primary</strong>.</p>
</li>
<li>
<p>secretary - Google permits multiple secretaries. Only the first entry is mapped to the Identity Store.</p>
</li>
<li>
<p>employeeNumber - mapped from Google&#8217;s multi-valued <strong>externalIds</strong> attribute only for the <strong>externalId</strong> of type <strong>organization</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_google_apps_group_channel_mapping"><a class="anchor" href="#_google_apps_group_channel_mapping"></a>Google Apps Group-Channel Mapping</h4>
<div class="paragraph">
<p>Mappings are defined for the Google Apps attributes <strong>Name</strong>, <strong>Description</strong> and <strong>Email</strong>.</p>
</div>
<div class="paragraph">
<p>Direction: Identity Store &#8594; GoogleApps</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID - dxrPrimaryKey</p>
</li>
<li>
<p>Join - ${source.dxrPrimaryKey}</p>
</li>
<li>
<p>Post-Mapping - if the <strong>dxrState</strong> attribute in the Identity Store is DELETED, the operation (as part of the mapped entry) is set to DELETE.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: GoogleApps &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID - ${joinedEntry.id} or "cn="${source.groupName}","+ env.role_ts_group_base}</p>
</li>
<li>
<p>Join - ${target.dxrPrimaryKey} or ${target.id}.</p>
</li>
<li>
<p>dxrTSState - the attribute used to detect the current state of the group in Google Apps. It is set to ENABLED for existing entries and to DELETED for non-existing entries.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_google_apps_member_channel_mapping"><a class="anchor" href="#_google_apps_member_channel_mapping"></a>Google Apps Member-Channel Mapping</h4>
<div class="paragraph">
<p>The member-channel configuration holds the mapping of the group members.</p>
</div>
</div>
<div class="sect3">
<h4 id="_google_apps_setpassword_channel_mapping"><a class="anchor" href="#_google_apps_setpassword_channel_mapping"></a>Google Apps SetPassword-Channel Mapping</h4>
<div class="paragraph">
<p>A password channel updates the Google Apps account passwords.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_imprivata_workflows"><a class="anchor" href="#_imprivata_workflows"></a>Imprivata Workflows</h3>
<div class="paragraph">
<p>The Imprivata OneSign Provisioning workflows are used to synchronize data between a target system of type SPMLv1 in the Identity Store and the corresponding connected Imprivata OneSign system. The Imprivata OneSign is provisioned via the SPMLv1 messages sent to an enabled Provisioning System Adaptor in the Imprivata OneSign appliance.</p>
</div>
<div class="paragraph">
<p>The workflows handle the following Imprivata OneSign objects:</p>
</div>
<div class="paragraph">
<p><strong>Subscriber</strong> - the subscriber represents the physical user. It holds the demographical data and can be used for accessing Imprivata OneSign.</p>
</div>
<div class="paragraph">
<p><strong>Account</strong> - each user can have one or more application accounts to log into an application managed via Imprivata OneSign. It stores the application credentials.</p>
</div>
<div class="paragraph">
<p>The delivered workflows are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_Imprivata_Realtime</strong> - the synchronization one-way workflow that exports detected changes for a subscriber object from Identity to the Imprivata OneSign and updates the state of the affected entry in Identity.</p>
</li>
<li>
<p><strong>SetPassword in Imprivata</strong> - the workflow that sets the password for the subscriber object in Imprivata OneSign.</p>
</li>
<li>
<p><strong>Ident_ImprivataExtranetPortal_Realtime</strong> - the synchronization one-way workflow that exports detected changes of application credentials for an application account object from Identity to Imprivata OneSign. The workflow does not update the state of the account entry in the Identity target system. This workflow is a sample that works by default from the Extranet Portal target system in the My-Company sample domain.</p>
</li>
<li>
<p><strong>SetPassword in ImprivataExtranetPortal</strong> - the workflow that sets the password for the application account object in Imprivata OneSign. This workflow is a sample that works by default from the Extranet Portal target system in the My-Company sample domain.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The subscriber object is directly mapped to the single account object of the corresponding Imprivata target system in the Provisioning configuration. The application account object is mapped to a real account of a target system in DirX Identity, which is configured in Imprivata OneSign as an application for single sign-on (SSO). The following figure illustrates this object mapping.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image9.png" alt="Imprivata Object Mapping">
</div>
<div class="title">Figure 9. Imprivata Object Mapping</div>
</div>
<div class="paragraph">
<p>As shown in the figure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Imprivata OneSign Domain is mapped to the DirX Identity target system</p>
</li>
<li>
<p>The Imprivata OneSign Subscriber is mapped to the DirX Identity account in the Imprivata target system</p>
</li>
<li>
<p>The Imprivata OneSign Application is mapped to any DirX Identity target system that allows setting passwords</p>
</li>
<li>
<p>The Imprivata OneSign Account is mapped to the DirX Identity account of any target system that permits passwords to be set</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At each event, the Imprivata application target systems real-time provisioning triggers two different workflows. One workflow synchronizes the entries for the real application (for example, actualizes an account in an LDAP connected directory) and the other workflow synchronizes the credentials of the user for the LDAP application configured in Imprivata OneSign for SSO. Both workflows handle the events with the same topic. The following figure illustrates these workflows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image10.png" alt="Imprivata Workflows">
</div>
<div class="title">Figure 10. Imprivata Workflows</div>
</div>
<div class="paragraph">
<p>The subscriber and account objects in an Imprivata OneSign target system and in a target system managed via Imprivata OneSign must be created, modified and deleted in the same time. It is necessary to build a privilege structure that supports the concurrent handling of the Imprivata OneSign subscriber and account objects (use permissions that are linked to the corresponding groups to accomplish this task).</p>
</div>
<div class="sect3">
<h4 id="_imprivata_workflow_prerequisites_and_limitations"><a class="anchor" href="#_imprivata_workflow_prerequisites_and_limitations"></a>Imprivata Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Imprivata Provisioning workflows support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Imprivata OneSign 4.1 SP1 or newer.</p>
</li>
<li>
<p>One-to-one relationship between a subscriber object and an application account object in an application. More accounts for a subscriber in an application are not supported.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Imprivata Provisioning workflows do not support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disable operation for subscriber objects. Only the delete operation is supported.</p>
</li>
<li>
<p>Reconciliation of the subscriber or account objects due to search operation limitations of the Imprivata OneSign Provisioning System Adaptor.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_imprivata"><a class="anchor" href="#_connecting_to_imprivata"></a>Connecting to Imprivata</h4>
<div class="paragraph">
<p>To configure the connection to Imprivata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <strong>IP Address</strong> of the Imprivata OneSign host. Imprivata OneSign is typically configured to accept SPMLv1 requests on the pre-configured secure port 443 and forces the use of the secured transport layer (HTTPS). Use the corresponding Imprivata service object which is the part of the connected directory that represents Imprivata OneSign.</p>
</li>
<li>
<p><strong>URL Path</strong> and <strong>Socket Timeout</strong> can be configured at the target system port of the appropriate workflow object. The <strong>URL Path</strong> of the Imprivata OneSign SPMLv1 provisioning service is pre-configured to the default value <strong>sso/provision/spmlrouter</strong>, Do not change this setting. Use <strong>Socket Timeout</strong> to increase the timeout value (in seconds) if necessary.</p>
</li>
<li>
<p>The Imprivata OneSign provisioning service does not use the bind credentials of the connected directory. Use the pre-configured values.</p>
</li>
<li>
<p>The HTTPS protocol requires the Imprivata OneSign certificate used for the secured connection to be trusted by the Java Runtime Environment for DirX Identity which is located in <em>dxi_java_home</em>. Perform trust store administration with Java <strong>keytool</strong> and import the Imprivata OneSign certificate. (See the chapter "Using OneSign Provisioning Features" in the Imprivata OneSign documentation for more details.)</p>
</li>
<li>
<p>Imprivata OneSign workflows use a specially implemented SPMLv1 based connector. Each SPMLv1 request sent to Imprivata OneSign must be identified by a <strong>External System Name</strong> which is part of the target system port of the appropriate workflow object. It is also pre-configured in the mapping for the channels that synchronize subscriber and account objects. This name is equivalent to the name of the configured Provisioning System Adaptor in the Imprivata OneSign appliance. Set these values in channel mappings and in the connector port according to the values configured in the Imprivata OneSign system.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_imprivata_target_system"><a class="anchor" href="#_configuring_the_imprivata_target_system"></a>Configuring the Imprivata Target System</h4>
<div class="paragraph">
<p>The Imprivata target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - one account object exists in the Identity target system for each Imprivata OneSign subscriber object in the connected system. All accounts are located in the subfolder Accounts.</p>
</li>
<li>
<p><strong>Groups</strong> - Imprivata OneSign does not use any type of group. Use a pre-configured "virtual" group for the creation of the Imprivata OneSign subscribers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute has a special meaning: it stores the generated Imprivata ID for subscriber objects. The <strong>dxrName</strong> attribute is a single copy of the <strong>employeeNumber</strong> attribute by default and is used as the username in Imprivata OneSign.</p>
</div>
<div class="paragraph">
<p>An application target system managed via Imprivata OneSign requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - one account object exists in Identity for every Imprivata OneSign account object in the connected system. All accounts can be located in an Accounts subfolder.</p>
</li>
<li>
<p><strong>Groups</strong> - Imprivata OneSign does not require any type of group from the application target system. To assign accounts, use existing groups of the managed application.</p>
</li>
<li>
<p><strong>Accounts and groups</strong> - an application can also work with the single common subtree containing both accounts and groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>dxmGUID</strong> attribute has a special meaning for Imprivata OneSign application accounts: it stores the generated Imprivata ID for account objects. The <strong>uid</strong> attribute is a single copy of the <strong>employeeNumber</strong> attribute by default. It must be generated in the same way as the <strong>dxrName</strong> attribute for the subscriber objects since it is used to identify the corresponding subscriber for the account object. The <strong>dxrName</strong> attribute for the application account objects is mapped to the application username. To keep the mapping from subscriber to account consistent, you may need to update the object descriptions for the target system accounts that are used as accounts for the Imprivata OneSign application (typically, you must define an additional configuration of the <strong>uid</strong> attribute).</p>
</div>
</div>
<div class="sect3">
<h4 id="_imprivata_workflow_and_activities"><a class="anchor" href="#_imprivata_workflow_and_activities"></a>Imprivata Workflow and Activities</h4>
<div class="paragraph">
<p>The following figures show the layout of the channels that are used by the join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image11.png" alt="Imprivata Workflow Channels for Imprivata OneSign Subscriber Objects">
</div>
<div class="title">Figure 11. Imprivata Workflow Channels for Imprivata OneSign Subscriber Objects</div>
</div>
<div class="paragraph">
<p>As this figure shows, the Imprivata OneSign subscriber objects are synchronized via a pair of channels. The group channels are only present to handle incoming events for groups. Such events are ignored.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image12.png" alt="Imprivata Workflow Channels for Imprivata OneSign Account Objects">
</div>
<div class="title">Figure 12. Imprivata Workflow Channels for Imprivata OneSign Account Objects</div>
</div>
<div class="paragraph">
<p>As this figure shows, the Imprivata OneSign account objects are also synchronized via a pair of channels. The group channels are only present to handle incoming events for groups and are also ignored.</p>
</div>
</div>
<div class="sect3">
<h4 id="_imprivata_ports"><a class="anchor" href="#_imprivata_ports"></a>Imprivata Ports</h4>
<div class="paragraph">
<p>This section provides information about the Imprivata workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Crypt Filter</strong><br>
An Imprivata Filter is configured implicitly. It is used to send the <strong>password</strong> and <strong>applicationPassword</strong> subscriber and account application password attributes in the SOAP request decrypted to Imprivata OneSign via SPMLv1. This filter is used only for the password synchronization workflow. The initial password is pre-configured (see the mapping for the channel <strong>account</strong> on the Identity side for both workflows).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_imprivata_channels"><a class="anchor" href="#_imprivata_channels"></a>Imprivata Channels</h4>
<div class="paragraph">
<p>This section provides information about Imprivata workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_common_aspects_2"><a class="anchor" href="#_common_aspects_2"></a>Common Aspects</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Imprivata OneSign</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>userDisabled</strong> - the attribute used for disabling of the subscriber object in Imprivata. The value is derived from <strong>dxrState</strong> attribute of the corresponding account object in DirX Identity. The subscriber cannot be disabled in the default configuration, but it can be deleted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Imprivata &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The workflow only uses the one-way synchronization controller, so updates can only be made via a user hook.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_subscriber"><a class="anchor" href="#_subscriber"></a>Subscriber</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Imprivata OneSign</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>dxrPrimaryKey</strong></p>
</li>
<li>
<p>Join: <strong>${target.externalSystemName}</strong>, <strong>${target.externalDomainName}</strong> and <strong>${target.username}</strong></p>
</li>
<li>
<p>Username: <strong>dxrName</strong></p>
</li>
<li>
<p>User hook stores the subscriber ID generated by Imprivata OneSign to the <strong>dxrPrimaryKey</strong> attribute. It also updates the state of the entry returned by the Imprivata OneSign.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_account"><a class="anchor" href="#_account"></a>Account</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Imprivata OneSign</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>dxmGUID</strong></p>
</li>
<li>
<p>Join: <strong>${target.externalSystemName}</strong>, <strong>${target.externalDomainName}</strong>, <strong>${target.externalApplicationName}</strong> and <strong>${target.username}</strong></p>
</li>
<li>
<p>Username: <strong>uid</strong></p>
</li>
<li>
<p>Application username: <strong>dxrName</strong></p>
</li>
<li>
<p>User hook stores the account ID generated by Imprivata OneSign to the <strong>dxmGUID</strong> attribute.</p>
</li>
<li>
<p>PostMapping script changes the type of the request to delete if necessary.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_group"><a class="anchor" href="#_group"></a>Group</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Imprivata OneSign</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User hook ignores all incoming event to update the group objects to Imprivata OneSign.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_password_channel_2"><a class="anchor" href="#_password_channel_2"></a>Password Channel</h5>
<div class="paragraph">
<p>A password channel updates the subscriber and account passwords.</p>
</div>
<div class="paragraph">
<p>A password channel can also be configured backwards from the connected system to the Identity Store to be able to update some attributes in Identity after a password change or reset has taken place in the connected system. The join engine then synchronizes the attributes specified in the corresponding password channel mapping to the Identity Store as usual after the account with its password-relevant attributes is updated in the connected system.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdbc_workflow"><a class="anchor" href="#_jdbc_workflow"></a>JDBC Workflow</h3>
<div class="paragraph">
<p>The JDBC Provisioning workflow synchronizes data between a JDBC target system within the Identity Store and a relational database. The following figure shows the deployment.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image13.png" alt="JDBC Provisioning Workflow Architecture">
</div>
<div class="title">Figure 13. JDBC Provisioning Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The workflow uses the LDAP connector on the Identity Store side and the JDBC connector on the database side. The connector communicates with JDBC drivers.</p>
</div>
<div class="paragraph">
<p>The default JDBC workflow is set up for three application-related database tables that hold accounts, groups and memberships. The membership table keeps the relationship between the accounts and the groups. Handling of other or more tables is a customization task.</p>
</div>
<div class="sect3">
<h4 id="_jdbc_workflow_prerequisites_and_limitations"><a class="anchor" href="#_jdbc_workflow_prerequisites_and_limitations"></a>JDBC Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>You must install the driver jar files that correspond to the JDBC drivers you intend to use. For each IdS-J Server installation, place the jar files in the server&#8217;s <strong>confdb\common\lib</strong> directory to enable the IdS-J Server to use the drivers.</p>
</div>
<div class="paragraph">
<p>The default for new JDBC target systems is now that memberships are held at the account objects, which enhances performance for the real-time workflows. Because the Tcl-based workflows assume memberships at group objects, you cannot use the Tcl-based JDBC provisioning workflows in parallel with the JDBC real-time workflows for the same target system instance.</p>
</div>
<div class="paragraph">
<p>The JDBC connector runs in lite mode as much as possible, which means that database meta information is read from the database and therefore must not be explicitly configured.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_jdbc"><a class="anchor" href="#_connecting_to_jdbc"></a>Connecting to JDBC</h4>
<div class="paragraph">
<p>To configure the connection to JDBC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the type in the Configuration Page of the JDBC Connected Directory and the corresponding Driver Type. Check the driver’s documentation to determine the URL that is required to connect.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_jdbc_target_system"><a class="anchor" href="#_configuring_the_jdbc_target_system"></a>Configuring the JDBC Target System</h4>
<div class="paragraph">
<p>Memberships are held at the account objects.</p>
</div>
<div class="paragraph">
<p>The default workflow configuration assumes that every provisioned table has an auto-generated primary key. This key cannot be calculated in DirX Identity. It is generated by the database. This key is used as dxrPrimarykey.</p>
</div>
<div class="sect4">
<h5 id="_attribute_correlation"><a class="anchor" href="#_attribute_correlation"></a>Attribute Correlation</h5>
<div class="paragraph">
<p>Attributes in the DirX Identity target system belong to the corresponding attributes in the JDBC target system.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 32%;">
<col style="width: 30%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>DirX Identity - Group</strong></th>
<th class="tableblock halign-left valign-top"><strong>JDBC - Group Table</strong></th>
<th class="tableblock halign-left valign-top"><strong>Remark</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrGroupName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique name in DirX Identity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey, dxrName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (DB key)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifiers</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 44%;">
<col style="width: 40%;">
<col style="width: 16%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>DirX Identity - Group</strong></th>
<th class="tableblock halign-left valign-top"><strong>JDBC - Memberships Table</strong></th>
<th class="tableblock halign-left valign-top"><strong>Remark</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey, dxrName of group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GroupID: DB key of group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifiers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DxrPrimaryKey, dxrName of referenced account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountID: DB key of account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifiers</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 32%;">
<col style="width: 32%;">
<col style="width: 36%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>DirX Identity - Account</strong></th>
<th class="tableblock halign-left valign-top"><strong>JDBC - Accounts Table</strong></th>
<th class="tableblock halign-left valign-top"><strong>Remark</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DxrAccountName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique name in DirX Identity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey, dxrName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (DB key)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifiers</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_jdbc_workflow_and_activities"><a class="anchor" href="#_jdbc_workflow_and_activities"></a>JDBC Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the JDBC workflow&#8217;s join activity objects at the Identity Store and connected system sides as well as the related ports and channels and their relationships.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image14.png" alt="JDBC Provisioning Workflow Join Activity" width="Channels and Objects">
</div>
<div class="title">Figure 14. JDBC Provisioning Workflow Join Activity, Channels and Objects</div>
</div>
<div class="paragraph">
<p>As shown in the figure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The "accounts" channel points to the "member" channel because the accounts keep the memberships.</p>
</li>
<li>
<p>The primary channel construct defines the memberships in the database.</p>
</li>
<li>
<p>The password synchronization workflow uses the password channel.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_jdbc_workflow_ports"><a class="anchor" href="#_jdbc_workflow_ports"></a>JDBC Workflow Ports</h4>
<div class="paragraph">
<p>This section provides information about the JDBC workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
The standard crypt filter for password decryption.</p>
</li>
<li>
<p><strong>JF - JDBC Filter</strong><br>
A JDBC Filter is configured. It is used to transform multi-value membership attributes in Identity to multiple records in the JDBC membership table. As the Filter is a general Filter for handling transformation of multi-value attributes to multiple records, its configuration is independent of the workflows environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration:</p>
</div>
<div class="paragraph">
<p>Request:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Member Attribute</strong> - the attribute that holds the target of the membership.<br>
Default: GroupID (because the Accounts table references the Groups table).</p>
</li>
<li>
<p><strong>Member Table</strong> - the table that holds memberships.<br>
Default: Memberships.</p>
</li>
<li>
<p><strong>Member Source Attribute</strong> - the attribute that holds the source of a membership.<br>
Default: AccountID as Accounts reference groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Search Response:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Match Type</strong> - the attribute used for matching records corresponding to the same identity object. Here it is accountID, as all memberships belonging to this account have the same accountID.</p>
</li>
<li>
<p><strong>Multivalue Attributes</strong> - the attribute that should be accumulated.<br>
Default: GroupID as all GroupIDs should be stored at the corresponding account.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_jdbc_workflow_channels"><a class="anchor" href="#_jdbc_workflow_channels"></a>JDBC Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about JDBC workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_common_aspects_3"><a class="anchor" href="#_common_aspects_3"></a>Common Aspects</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; JDBC</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID is calculated via <strong>calculateIdInJdbc</strong>. For details, see the Java documentation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: JDBC &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID is calculated via <strong>CommonProcsJDBC.calculateIdInIdentity</strong>. It assumes that the specific attributes "accountnameatt" and "groupnameatt" (at the JDBC connected directory) contains the attribute names holding the (unique) account name and (unique) group name attributes.</p>
</li>
<li>
<p><strong>dxrName</strong> is taken from the database ID column.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_membership"><a class="anchor" href="#_membership"></a>Membership</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; JDBC (TS Account-Group-Membership)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>"accountId="$\{source.dxrPrimaryKey}",Table=Memberships"</strong></p>
</li>
<li>
<p>Primary Channel account <strong>Join: Memberships.AccountID = ID</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_setpassword"><a class="anchor" href="#_setpassword"></a>SetPassword</h5>
<div class="ulist">
<ul>
<li>
<p>Maps the <strong>dxmPassword</strong> to the password column in your account table.</p>
</li>
<li>
<p>A password channel can also be configured backwards from the connected system to Identity to be able to update some attributes in Identity after a password change or reset has taken place in the connected system. The join engine then as usual synchronizes the attributes specified in the corresponding password channel mapping to Identity after the account with its password-relevant attributes has been updated in the connected system.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_jdbc_workflows"><a class="anchor" href="#_customizing_the_jdbc_workflows"></a>Customizing the JDBC Workflows</h4>
<div class="paragraph">
<p>You can customize the JDBC workflows in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adapt the database scheme in relationship to a different table layout</p>
</li>
<li>
<p>Call stored procedures</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_adapting_the_database_scheme"><a class="anchor" href="#_adapting_the_database_scheme"></a>Adapting the Database Scheme</h5>
<div class="paragraph">
<p>In most cases, your database table(s) will differ from the assumed default tables.</p>
</div>
<div class="paragraph">
<p>Table Names</p>
</div>
<div class="paragraph">
<p>In every mapping where the syntax Tablename.ColumnName is used, change the table name</p>
</div>
<div class="paragraph">
<p>IDMapping &#8594; JDBC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change <strong>calculateIdInJdbc</strong><br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">targetId = CommonProcsJdbc.calculateIdInJdbc(
        sourceEntry,
        joinedEntry,
        env,
        entry_type,
        "Groups",
        "groups-id");</code></pre>
</div>
</div>
</li>
<li>
<p>If your Group Table is named GRP, change to:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">targetId = CommonProcsJdbc.calculateIdInJdbc(
        sourceEntry,
        joinedEntry,
        env,
        entry_type,
        "GRP",
        "GRP-id");</code></pre>
</div>
</div>
</li>
<li>
<p>Change the Export Search base.</p>
</li>
<li>
<p>At the JDBC CD, set the SpecificAttribute membertable to your membertable.</p>
</li>
<li>
<p>At the JDBC filter, adjust the member table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Column Names</p>
</div>
<div class="paragraph">
<p>You can change the column names directly in every mapping line. If you want to select attribute names from a list, you must edit the JDBC CD attribute configuration.</p>
</div>
<div class="paragraph">
<p>If column names of the columns holding the unique identity attribute (by default, dxrGroupName, dxrAccountName) differs, adjust this in JDBC CD SpecificAttribute accountnameatt / groupnameatt</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If an ID attribute changes:</p>
</li>
<li>
<p>All mappings containing ID</p>
</li>
<li>
<p>Channels &#8594; Id: dxrName/dxrPrimaryKey/dxrPrimaryKeyOld: Javamapping sourceAttrName = "ID";</p>
</li>
<li>
<p>Account-group-membership channel: join condition Primary</p>
</li>
<li>
<p>If accountID/groupID changes in membership table:</p>
</li>
<li>
<p>JDBC filter configuration</p>
</li>
<li>
<p>Adjust Specific attribute memberatt/ membersourceatt at JDBC connected directory</p>
</li>
<li>
<p>ID Mapping &#8594; JDBC account-group-membership</p>
</li>
<li>
<p>Primary Channel join secondary account-group-membership</p>
</li>
<li>
<p>Join in account-group-membership channel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Primary Key is not an Auto Key</p>
</div>
<div class="paragraph">
<p>This is not possible in pure lite mode. Define instead the primary keys (in TS port):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;jdbc-connection always-follow-references="false"&gt;
    &lt;abbreviation name="account-id"&gt;Accounts.ID&lt;/abbreviation&gt;
    &lt;abbreviation name="group-id"&gt;Groups.ID&lt;/abbreviation&gt;
    &lt;abbreviation name="membership-id"&gt;Memberships.ID&lt;/abbreviation&gt;
    &lt;tables-and-views&gt;
        &lt;table primary-keys="account-id"&gt;
            &lt;name&gt;Accounts&lt;/name&gt;
        &lt;/table&gt;
        &lt;table primary-keys="group-id"&gt;
            &lt;name&gt;Groups&lt;/name&gt;
        &lt;/table&gt;
        &lt;table primary-keys="membership-id"&gt;
            &lt;name&gt;Memberships&lt;/name&gt;
        &lt;/table&gt;
    &lt;/tables-and-views&gt;
&lt;/jdbc-connection&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here a separate ID column in the membership table is assumed. It’s also possible account-id and group-id defines the key. In this case the definition of the membership table and the corresponding abbreviation is not needed.</p>
</div>
<div class="paragraph">
<p>Use the defined abbreviation for id column in ID mapping</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">targetId = CommonProcsJdbc.calculateIdInJdbc(
        sourceEntry,
        joinedEntry,
        env,
        entry_type,
        "Accounts",
        "account-id",false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use CommonProcsJdbc.calculateIdInJdbc with argument autogeneratedkey=false.</p>
</div>
<div class="paragraph">
<p>Use the defined abbreviation in members channel as the primary value in Primary Channel join condition.</p>
</div>
<div class="paragraph">
<p>Use the defined abbreviation in join condition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;join&gt;
    &lt;searchBasetype="urn:oasis:names:tc:SPML:1:0#DN"&gt;
        &lt;spml:id&gt;"accountid="+${source.dxrPrimaryKey}+",Table=Accounts"&lt;/spml:id&gt;
    &lt;/searchBase&gt;
&lt;/join&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the defined abbreviations in Primarykey(old) and DxrName Java mapping at Identity side.</p>
</div>
<div class="paragraph">
<p>Change the object description to generate a unique key for dxrPrimaryKey.</p>
</div>
<div class="paragraph">
<p>Use a Column to specify the Account State</p>
</div>
<div class="paragraph">
<p>To configure a column representing the account state in your account table insert a new line at the JDBC connected directory propertypage <strong>Specific Attributes</strong>. As name enter <strong>accountstateatt</strong>. Fill in the column name as value. The default <strong>dxrTSState</strong> Mapping for the account uses this column to set the <strong>dxrTSState</strong> if the configured column exists. Only the values <strong>ENABLED</strong> and <strong>DELETED</strong> are allowed. If your column contains other values, you must map your values to these allowed values. To do this edit the dxrTSState mapping at the account channel.</p>
</div>
</div>
<div class="sect4">
<h5 id="_calling_stored_procedures"><a class="anchor" href="#_calling_stored_procedures"></a>Calling Stored Procedures</h5>
<div class="paragraph">
<p>Under the default JDBC TS port, you will find an example for a stored procedure definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- a procedure with 2 in params returning an int --&gt;
&lt;function name="changePassword"&gt;
    &lt;return&gt;
        &lt;range exact="0" category="OK"/&gt;
    &lt;/return&gt;
    &lt;argument name="ID" in-out="IN" dataType="INTEGER" /&gt;
    &lt;argument name="pw" in-out="IN" dataType="VARCHAR" /&gt;
&lt;/function&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample represents a SQL server stored procedure returning 0 on success. It takes two parameters: the ID that identifies the record and the password that should be set.</p>
</div>
<div class="paragraph">
<p>To call this stored procedure, an extended request is necessary. This request may be called in the postmapping or in a user hook. Building the extended request in the postmapping means that it is called after a normal request.</p>
</div>
<div class="paragraph">
<p>Call via postmapping:</p>
</div>
<div class="paragraph">
<p>In the default setPassword channel, you will find an example (in comments):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">logger.debug("SP postmapping called");
HashMap&lt;String,DsmlAttr&gt; sourceAttrs = source.getAttrs();
if (sourceAttrs == null)
    return mappedEntry;

// the Stored Procedure +
String theSP = "changePassword";

ExtendedRequest extReq = new ExtendedRequest();
mappedEntry.addExtendedRequest(extReq); // append the SP call as extended request
extReq.setRequestID("SPCall");
OperationIdentifier opId = new OperationIdentifier();
opId.setOperationID(theSP); // name of SP +
opId.setOperationIDType(OperationIdentifierOperationIDTypeType.GENERICSTRING);
extReq.setOperationIdentifier(opId);
ProviderIdentifier provId = new ProviderIdentifier();
provId.setProviderID("SP"); // SP for Stored procedure
provId.setProviderIDType(ProviderIdentifierProviderIDTypeType.URN);
extReq.setProviderIdentifier(provId);

// assume two parameter, the ID the password pw +
// first ID from source ??later also from mappedEntry +
// only the first element of attArr is computed by the connector +
Attributes[] attArr = new Attributes[1];
DsmlAttr pkey =sourceAttrs.get("dxrprimarykey");
DsmlAttr id = new DsmlAttr();
id.setName("ID");
id.addDsmlValue(pkey.getDsmlValue(0));
Attributes atts = new Attributes();
atts.addAttr(id);
logger.debug("SP argument ID: "+pkey.getDsmlValue(0).toString());

// second Password from mapped pw attr
DsmlModification[] mod = mappedEntry.getModification("pw");
if (mod.length &gt; 0) {
    // take first
    DsmlAttr pw = new DsmlAttr();
    pw.setName("pw");
    pw.addDsmlValue(mod[0].getDsmlValue(0));
    atts.addAttr(pw);
    logger.debug("SP argument pw: "+pw.getDsmlValue(0).toString());
}
attArr[0] = atts;
extReq.setAttributes(attArr);
// only extended Request to be processed
mappedEntry.setRequestType(Request.Type.NONE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the first argument ID is taken from the source attribute dxrprimarykey.</p>
</div>
<div class="paragraph">
<p>The second argument is taken from the mapped entry. This example shows that you can do some complicated mapping and take the result as an argument. Keep in mind that for mapped attributes, modifications will be generated. If you do not want the password to be set twice (by generated modification an by stored procedure) you can use the attribute flag <strong>Readonly</strong> to prevent it. In this sample, the <strong>RequestType</strong> is set to <strong>NONE</strong> at the end, which means that only the stored procedure is called and other generated modifications are ignored. Normally you do not intend to do this, so all generated modifications are made (for example, the description has changed) and afterwards the stored procedure is called to set the password column.</p>
</div>
<div class="paragraph">
<p>In the <strong>com.siemens.dxm.join.userhook.jdbc.UserHookAccountsTo</strong> user hook, you will find an example of how to call a stored procedure in a user hook.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
* Call an SP via extended request
*
* Can also be done in postMapping or another user hook
* @see com.siemens.dxm.join.api.IUserHookExt#preUpdate(siemens.dxm.connector.DxmRequestor, siemens.dxm.connector.DxmRequestor, siemens.dxm.connector.spml.Identifier, java.util.HashMap, com.siemens.dxm.join.map.MappedEntry, siemens.dxm.connector.spml.Identifier, java.util.HashMap)
*/
public boolean preUpdate(DxmRequestor srcConn, DxmRequestor tgtConn, Identifier sourceId, HashMap&lt;String,DsmlAttr&gt; sourceAttrs, MappedEntry mappedEntry, Identifier joinedId, HashMap&lt;String,DsmlAttr&gt; joinedAttrs) {

// the Stored Procedure
String theSP = "changePassword";

ExtendedRequest extReq = new ExtendedRequest();
extReq.setRequestID("SPCall4SetPassword");
OperationIdentifier opId = new OperationIdentifier();
opId.setOperationID(theSP); // name of SP
opId.setOperationIDType(OperationIdentifierOperationIDTypeType.GENERICSTRING);
extReq.setOperationIdentifier(opId);
ProviderIdentifier provId = new ProviderIdentifier();
provId.setProviderID("SP"); // SP for Stored procedure
provId.setProviderIDType(ProviderIdentifierProviderIDTypeType.URN);
extReq.setProviderIdentifier(provId);

// we have two parameters, the ID and the password pw
// first take ID from source attributes
// only the first att is computed by the connector
Attributes[] attArr = new Attributes[1];
DsmlAttr pkey =sourceAttrs.get("dxrprimarykey");
DsmlAttr id = new DsmlAttr();
id.setName("ID");
id.addDsmlValue(pkey.getDsmlValue(0));
Attributes atts = new Attributes();
atts.addAttr(id);

logger.debug("SP argument ID: " + pkey.getDsmlValue(0).toString());

// second parameter Password from mapped pw attribute
DsmlModification[] mod = mappedEntry.getModification("pw");
if (mod.length &gt; 0) {
    // take first
    DsmlAttr pw = new DsmlAttr();
    pw.setName("pw");
    pw.addDsmlValue(mod[0].getDsmlValue(0));
    atts.addAttr(pw);

    logger.debug("SP argument pw: "+pw.getDsmlValue(0).toString());
}
attArr[0] = atts; // IN and IN_OUT parameters
extReq.setAttributes(attArr);

if (tgtConn instanceof DxmConnectorExtended) {
    // call extended Connector
    DxmConnectorExtended theConnector = (DxmConnectorExtended)tgtConn;
    try {
        ExtendedResponse rsp = theConnector.extendedRequest(extReq);
    } catch (DxmConnectorException e) {
        logger.error("SP Call failed: ",e);
    }
}
// process extended request only
// ignore other modifications to avoid a 2nd modification of the mapped pw
mappedEntry.setRequestType(Request.Type.NONE);

return true;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s the difference?</p>
</div>
<div class="paragraph">
<p>In a user hook, you must call the connector’s extendedRequest method explicitly. In postmapping, you just build the extendedRequest and add it to the mapped entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">mappedEntry.addExtendedRequest(extReq); // append th SP call as extended request</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>General Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always set "SP" as providerId</p>
</li>
<li>
<p>Attributes Array always has size 1. Every argument is an element of this one and is the only array element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Function or Procedure?</p>
</div>
<div class="paragraph">
<p>The definition of a stored procedure may depend on the database system. For the JDBC connector definition, a function is defined if it returns a value. If no value is returned, it is a procedure.</p>
</div>
<div class="paragraph">
<p>Here is a Microsoft SQL Server 2005 stored procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">ALTER PROCEDURE [dbo].[changePassword]
    -- parameters for the stored procedure
    @userId int,
    @pw varchar(50)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This stored procedure returns an int, which means you must configure this procedure as a function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;function name="changePassword"&gt;
    &lt;return&gt;
        &lt;range exact="0"/&gt;
    &lt;/return&gt;
    &lt;argument name="ID" in-out="IN" dataType="INTEGER" /&gt;
    &lt;argument name="pw" in-out="IN" dataType="VARCHAR" /&gt;
&lt;/function&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Oracle, a stored procedure does not return a value, which means you must configure a procedure. But for a procedure, you must specify the "return" argument because the connector needs an indicator for the outcome of the procedure. Therefore, you cannot use a procedure with the same arguments in Oracle. You must wrap the procedure to get an "out" argument for return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;procedure name="changePw"&gt;
    &lt;return name="dummy"&gt;
        &lt;range exact="0"/&gt;
    &lt;/return&gt;
    &lt;argument name="ID" in-out="IN" dataType="INTEGER" /&gt;
    &lt;argument name="pw" in-out="IN" dataType="VARCHAR" /&gt;
    &lt;argument name="dummy" in-out="OUT" dataType="INTEGER" /&gt;
&lt;/procedure&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_workflows"><a class="anchor" href="#_ldap_workflows"></a>LDAP Workflows</h3>
<div class="paragraph">
<p>The LDAP Provisioning workflows operate between a target system of type "LDAP" in the Identity Store and the corresponding connected LDAP Directory system.</p>
</div>
<div class="paragraph">
<p>The LDAP connector used in the workflows communicates with the LDAP server across the native LDAP protocol, as shown in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image15.png" alt="LDAP Workflow Architecture">
</div>
<div class="title">Figure 15. LDAP Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The workflows allow you to synchronize Identity account and group objects with LDAP Directory users and group objects.</p>
</div>
<div class="sect3">
<h4 id="_ldap_workflow_prerequisites_and_limitations"><a class="anchor" href="#_ldap_workflow_prerequisites_and_limitations"></a>LDAP Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The LDAP workflows currently have no prerequisites or limitations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_connection_to_ldap"><a class="anchor" href="#_configuring_the_connection_to_ldap"></a>Configuring the Connection to LDAP</h4>
<div class="paragraph">
<p>This section provides information about LDAP target system configuration.</p>
</div>
<div class="paragraph">
<p>Connection to the target system:</p>
</div>
<div class="paragraph">
<p>Specify the IP address, the data port, and the secure port at the LDAP service object (LDAP CD &#8594; Service). The IP address may contain the server name - fully-qualified or not - or a TCP/IP address.</p>
</div>
<div class="paragraph">
<p>In the Bind Profile (LDAP CD &#8594; Bind Profile), specify a user in DN format.</p>
</div>
<div class="paragraph">
<p>For SSL/TLS, fill the following fields:</p>
</div>
<div class="paragraph">
<p><strong>SSL Connection</strong> - check it for SSL connections, whether server or client authentication.</p>
</div>
<div class="paragraph">
<p><strong>Client Authentication</strong> - check if if you want to use client-side SSL.</p>
</div>
<div class="paragraph">
<p><strong>Path to Key Store File</strong> - the file name of the file-based keystore containing the certificate/private key pair and the relevant CA certificates for this client certificate.</p>
</div>
<div class="paragraph">
<p><strong>Key Store Password</strong> - the password for accessing the key store.</p>
</div>
<div class="paragraph">
<p><strong>Key Store Alias</strong> - the alias name of the keystore entry (optional).</p>
</div>
<div class="paragraph">
<p><strong>Path to Trust Store File</strong> - the file name of the file-based truststore containing the LDAP server CA certificate.</p>
</div>
<div class="paragraph">
<p><strong>Trust Store Password</strong> - the password for accessing the truststore.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_ldap_target_system"><a class="anchor" href="#_configuring_the_ldap_target_system"></a>Configuring the LDAP Target System</h4>
<div class="paragraph">
<p>Pay attention to the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The attribute <strong>dxrPrimaryKey</strong> of accounts and groups contains the object&#8217;s target system DN. It is also used as the member attribute of groups. On account creation, it is generated by the <strong>tsaccount.xml</strong> object description using the connected directory-specific attributes <strong>account base</strong> and <strong>group base</strong>.</p>
</li>
<li>
<p>The attribute <strong>dxrName</strong> of accounts and groups contain the <strong>dxrPrimaryKey</strong> value. It is used for joining in Identity direction.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_workflow_and_activities"><a class="anchor" href="#_ldap_workflow_and_activities"></a>LDAP Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image16.png" alt="LDAP Workflow Channels">
</div>
<div class="title">Figure 16. LDAP Workflow Channels</div>
</div>
<div class="paragraph">
<p>As the figure shows, there is a pair of channels between accounts, groups and members on each side. The members are linked to the groups on both sides.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_workflow_ports"><a class="anchor" href="#_ldap_workflow_ports"></a>LDAP Workflow Ports</h4>
<div class="paragraph">
<p>This section describes LDAP workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
The configured Crypt Filter is used to send the password attribute userPassword decrypted to the LDAP server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_workflow_channels"><a class="anchor" href="#_ldap_workflow_channels"></a>LDAP Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about LDAP workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_account_and_group_channels_in_both_directions"><a class="anchor" href="#_account_and_group_channels_in_both_directions"></a>Account and Group Channels in both Directions</h5>
<div class="paragraph">
<p>Master attributes:</p>
</div>
<div class="paragraph">
<p>Most attributes (except, for example, the dxrTSState attribute) are mastered by DirX Identity. Consequently, these attributes have the <strong>OnAddOnly</strong> flag in the mapping direction to Identity. This is particularly true for the Identifier, which is also mastered by DirX Identity in the default real-time synchronization workflow. In the target system direction, it is calculated by DirX Identity in the dxrPrimaryKey attribute and results in moving the object in the target system if dxrPrimaryKey changed. In the DirX Identity direction, the Identifier is calculated only on an add operation, otherwise the joined object&#8217;s Identifier is taken.</p>
</div>
<div class="paragraph">
<p>Moving account objects:</p>
</div>
<div class="paragraph">
<p>The default LDAP real-time synchronization workflow can perform a rename/move of accounts in the LDAP target system. It operates in the following way:</p>
</div>
<div class="paragraph">
<p>If the <strong>dxrPrimaryKey</strong> attribute of the account is changed in DirX Identity (as a result of a user resolution and new calculation of the account attributes, which can have <strong>dependsOn</strong> or <strong>masteredBy</strong> settings in the account&#8217;s object description), the workflow performs the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It takes this as the new DN in LDAP.</p>
</li>
<li>
<p>It tries to find (join) the account with the configured join attributes (trying one after the other).</p>
</li>
<li>
<p>One of the join attributes is the employeeNumber, which shouldn&#8217;t change on user resolution in Identity.</p>
</li>
<li>
<p>When it finds the account in LDAP, it takes this DN is as the old DN and renames/removes the account from this old DN to the new DN.</p>
</li>
<li>
<p>On the way back, it puts the actual LDAP DN into the dxrPrimaryKey and dxrPrimaryKeyOld attributes in DirX Identity.</p>
</li>
<li>
<p>The dxrPrimaryKeyOld (as described above) is not taken for sync to TS but for other purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changing the account state holding the attribute employeeType:</p>
</div>
<div class="paragraph">
<p>If you want to use another attribute for holding the account state than <strong>employeeType</strong> you must do the following mapping adaptions in the account channel:</p>
</div>
<div class="paragraph">
<p>Direction Identity &#8594; Connected System</p>
</div>
<div class="paragraph">
<p>Just change the java mapping line with <strong>employeeType</strong> on the right side by exchanging <strong>employeeType</strong> with another attribute name. The content of the Java coding on the left side has not to be changed because it references now the term <strong>tgtAttrname</strong> instead of hard coded <strong>employeeType</strong>. The Java class name is just changed to the new attribute name if the mapping is saved.</p>
</div>
<div class="paragraph">
<p>Direction Connected System &#8594; Identity</p>
</div>
<div class="paragraph">
<p>Adapt the Java mapping to the target attribute <strong>dxrTSState</strong> and exchange <strong>employeeType</strong> in the line<br>
<code><strong>CommonProcsLdap.setAccountStateAttr("employeeType");</strong></code><br>
by the new attribute name.</p>
</div>
<div class="paragraph">
<p>PostMapping:</p>
</div>
<div class="paragraph">
<p>A postMapping exists only for the group channel in the target system direction. It is used for changing the request type to <strong>DELETE</strong> if the dxrState attribute in Identity contains the value <strong>DELETED</strong>, which results in deleting the object in the target system.</p>
</div>
<div class="paragraph">
<p>For accounts deletion of objects in the target system is handled in the Java mapping to the account state holding attribute, which is by default <strong>employeeType</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_password_channel_3"><a class="anchor" href="#_password_channel_3"></a>Password Channel</h5>
<div class="paragraph">
<p>The target system&#8217;s password attribute <strong>userPassword</strong> is updated with the current password of the account in DirX Identity and the pwdReset attribute, which determines whether or not the password must be changed on the next login by the user, is set depending on the source attribute <strong>dxmPasswordExpired</strong>. This attribute was previously set by the User or Account Password Event Manager workflow listening for requests from Identity Web Center or Password Listener.</p>
</div>
</div>
<div class="sect4">
<h5 id="_case_sensitive_rename"><a class="anchor" href="#_case_sensitive_rename"></a>Case-Sensitive Rename</h5>
<div class="paragraph">
<p>If you want to enable case-sensitive renames like ou=RedFlag &#8594; ou=Redflag, you need to set the operational attribute <strong>caseExactRDNComparison</strong> to <strong>true</strong> in the generated request. Use the Op. Mapping tab of your channel get this into the workflow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;mappingDefinition&gt;
    &lt;operationalAttrMapping mappingType="constant" name="caseExactRDNComparison"&gt;
        &lt;value&gt;true&lt;/value&gt;
    &lt;/operationalAttrMapping&gt;
&lt;/mappingDefinition&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_delta_workflows"><a class="anchor" href="#_ldap_delta_workflows"></a>LDAP Delta Workflows</h4>
<div class="paragraph">
<p>For a general explanation of the delta workflows, see the sections under "Java-based Workflow Architecture" in "Understanding the Default Application Workflows" in this guide.</p>
</div>
<div class="paragraph">
<p>The default LDAP delta workflow <strong>LDAP_Ident_Realtime_Delta</strong> (as the workflow name already implies) synchronizes deltas from an LDAP connected system to the Identity Store both for accounts and groups. You can verify this function by looking at the <strong>deltaSyncOneWay2Identity</strong> controller used by the workflow. The delta definitions given in the Delta tab for the LDAP connected directory&#8217;s channels apply (Connectivity Configuration Data &#8594; Connected Directories &#8594; Target Scheduled &#8594; LDAP &#8594; Channels).</p>
</div>
<div class="paragraph">
<p>Delta synchronization for the LDAP connected directories is based on time stamps: specifically, the LDAP attributes <strong>createTimeStamp</strong> and <strong>modifyTimeStamp</strong>. In the Delta tab, <strong>Delta</strong> <strong>Type</strong> is set to <strong>SearchAttributes</strong> and the two LDAP attributes are listed, and in <strong>Sort</strong> <strong>Type</strong>, the value <strong>String</strong> is selected.</p>
</div>
<div class="paragraph">
<p>When searching for deltas, the (configured) export search filter is extended and entries whose <strong>createTimeStamp</strong> or <strong>modifyTimeStamp</strong> attributes are set to a value that is more recent than (or equal to) the time stamp of the previous workflow run will be searched. For the first run, the (configured) export filter is not changed because there is no time stamp available for comparison.</p>
</div>
<div class="paragraph">
<p>When evaluating the search result, the most recent time stamp is retained as delta information and is stored in the Identity domain for each channel. This time stamp is subsequently used when the workflow is next activated (either in the DirX Identity Manager or by schedule).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Delta tab of the corresponding channels (that is, the Identity Store channels) hold delta definitions, too. These definitions apply if you have defined a delta workflow for synchronization from the Identity Store to the LDAP connected system.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ibm_notes_workflows"><a class="anchor" href="#_ibm_notes_workflows"></a>IBM Notes Workflows</h3>
<div class="paragraph">
<p>The IBM Notes (formerly Lotus Notes) Provisioning workflow synchronizes data between an IBM Notes target system within the Identity Store and an IBM Domino server. The following figure shows the deployment.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image17.png" alt="IBM Notes Workflows Architecture">
</div>
<div class="title">Figure 17. IBM Notes Workflows Architecture</div>
</div>
<div class="paragraph">
<p>The join engine running in the Java-based Server needs to send and retrieve data from a Domino server. The Notes API that is used for accessing the Notes address book is a C/C interface. Therefore, the Notes Provisioning workflow provides an SPML/SOAP connector that enables the join engine to exchange SPML requests and responses with the C-based Server. The SPML/SOAP-service running in the C-based Server exchanges the SPML requests and responses with the Notes connector, which finally interacts with the Domino server using the Notes C/C-API.</p>
</div>
<div class="paragraph">
<p>The Notes Provisioning workflow allows you to synchronize accounts and groups with Notes users and groups in the Notes address book.</p>
</div>
<div class="sect3">
<h4 id="_notes_workflow_prerequisites_and_limitations"><a class="anchor" href="#_notes_workflow_prerequisites_and_limitations"></a>Notes Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Notes Provisioning workflow has the following prerequisites and limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The workflow requires the version of Notes C/C++-API V 7.0.2 or newer.</p>
</li>
<li>
<p>Before you can use the workflow, you must extend the DirX Identity Store schema with Notes target system-specific attributes and object classes so that the workflows can store Notes-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows".</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_notes_workflow"><a class="anchor" href="#_configuring_the_notes_workflow"></a>Configuring the Notes Workflow</h4>
<div class="paragraph">
<p>Configuring a Notes Provisioning workflow consists of the following steps:</p>
</div>
<div class="paragraph">
<p>Configuring the Notes Connector (running in the C++-based Server)</p>
</div>
<div class="paragraph">
<p>In Identity Manager, log in to Connectivity, go to the <strong>Expert</strong> <strong>View</strong>, and set the <strong>Is Active</strong> flag in</p>
</div>
<div class="paragraph">
<p><strong>Connectivity Configuration Data</strong> &#8594; <strong>Configuration</strong> &#8594; <strong>DirX Identity Servers</strong> &#8594; <strong>C Servers</strong> &#8594; <em>server_name</em> &#8594; <em>Notes_Connector_name</em></p>
</div>
<div class="paragraph">
<p>Verify the attributes of the C++-based Server (in <strong>ConSvr SOAP Listener</strong> and <strong>ConSvr SOAP Receiver</strong> tab) in</p>
</div>
<div class="paragraph">
<p><strong>Connectivity Configuration Data</strong> &#8594; <strong>Configuration</strong> &#8594; <strong>DirX Identity Servers</strong> &#8594; <strong>C Servers</strong> &#8594; <em>server_name</em></p>
</div>
<div class="paragraph">
<p>Configuring the Notes Service</p>
</div>
<div class="paragraph">
<p>Assign the Notes server name in the following (Notes-specific) format:</p>
</div>
<div class="paragraph">
<p><strong>CN=</strong><em>server_name</em><strong>/O=</strong><em>org_name</em><strong>[/&#8230;&#8203;]</strong></p>
</div>
<div class="paragraph">
<p>Make sure that the attribute types in the server name (for example, CN, O, OU) are specified in uppercase letters.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Notes server name format</div>
<div class="content">
<strong>CN=my-server/O=my-organization</strong>
</div>
</div>
<div class="paragraph">
<p>Configuring the Connected Directory</p>
</div>
<div class="paragraph">
<p>Assign the <strong>Addr(ess) Book</strong> field.</p>
</div>
<div class="paragraph">
<p>In the <strong>Provisioning</strong> tab, check the fields</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account Base</strong> and <strong>Group Base</strong> in "in Identity" property page.</p>
</li>
<li>
<p><strong>user Base</strong> and <strong>Group Base</strong> in "in Target System" property page.</p>
</li>
<li>
<p><strong>Admin Request Database</strong>, <strong>Admin Request Author</strong>, <strong>Group Member Limit</strong> and <strong>Unique Org Unit Attr</strong> in "Notes specific" property page. For details see the section "Static Configuration" in the <em>DirX Identity Connectivity Reference</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuring the Bind Profiles</p>
</div>
<div class="paragraph">
<p>At least two bind profiles are required: one for the Notes administrator (Admin) and another one for registering, moving or renaming users (Certifier).</p>
</div>
<div class="paragraph">
<p>Others may be required when moving Notes users to different organizations or organizational units. (one per organization or organizational unit)</p>
</div>
<div class="paragraph">
<p>Note that the <strong>User</strong> field of the bind profile is used as the file name of the appropriate Notes ID file. Furthermore, make sure that the file name exactly matches the file in the Notes profile when used as “PathFileCertId”.</p>
</div>
<div class="paragraph">
<p>For details, see the section “Static Configuration” in the <em>DirX Identity Connectivity Reference</em>.</p>
</div>
<div class="paragraph">
<p>Configuring the Organizational Specific Profiles</p>
</div>
<div class="paragraph">
<p>For registration of users or moving users in the Notes address book, the Notes APIs need several attributes. For details, see the topic “Notes Connector” in the <em>DirX Identity Connectivity Reference</em>.</p>
</div>
<div class="paragraph">
<p>Profiles are used for storing Notes-relevant attributes per organizational unit in order to avoid storing each attribute in the account separately. The profiles are located in</p>
</div>
<div class="paragraph">
<p><em>domain_root</em> &#8594; <strong>TargetSystems</strong> &#8594; <em>Targetsystem_name</em> &#8594; <strong>configurations</strong> &#8594; <strong>profiles</strong></p>
</div>
<div class="paragraph">
<p>At least one default profile must exist. It’s used when no organizational unit specific one is available.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_notes_target_system"><a class="anchor" href="#_configuring_the_notes_target_system"></a>Configuring the Notes Target System</h4>
<div class="paragraph">
<p>To support Notes groups and accounts in Identity Store, the service layer makes use of object descriptions and Java scripts that are located in</p>
</div>
<div class="paragraph">
<p><em>domain_root</em> &#8594; <strong>TargetSystems</strong> &#8594; <strong>Notes</strong> &#8594; <strong>ObjectDescriptions</strong></p>
</div>
<div class="paragraph">
<p><em>domain_root</em> &#8594; <strong>TargetSystems</strong> &#8594; <strong>Notes</strong> &#8594; <strong>JavaScripts</strong></p>
</div>
<div class="paragraph">
<p>The following object descriptions are provided:</p>
</div>
<div class="paragraph">
<p><strong>Group.xml</strong> - for creation of Notes groups in the Identity Store</p>
</div>
<div class="paragraph">
<p><strong>Profile.xml</strong> - for creation of profile objects (profiles) in the Identity Store</p>
</div>
<div class="paragraph">
<p><strong>TS.xml</strong> - for creation of a Notes target system in the Identity Store</p>
</div>
<div class="paragraph">
<p><strong>TSAccount.xml</strong> - for creation of Notes accounts in the Identity Store</p>
</div>
<div class="paragraph">
<p>The following Java scripts (called when processing the object descriptions) are also provided:</p>
</div>
<div class="paragraph">
<p><strong>mail.js</strong> - for creation of the mail attribute</p>
</div>
<div class="paragraph">
<p><strong>ProfileFromOU.js</strong> - for creation of the dxrProfileLink attribute</p>
</div>
<div class="paragraph">
<p><strong>UniqueNameForAccounts.js</strong> - for creation of the dxrPrimaryKey attribute for accounts (which represents the attribute FullName in Notes)</p>
</div>
<div class="paragraph">
<p><strong>UniqueNameForGroups.js</strong> - for creation of the dxrPrimaryKey attribute for groups (which represents the attribute ListName in Notes)</p>
</div>
<div class="paragraph">
<p>The following section describes these object descriptions in detail.</p>
</div>
<div class="paragraph">
<p>Object Descriptions</p>
</div>
<div class="paragraph">
<p>This section provides detailed information about object descriptions.</p>
</div>
<div class="paragraph">
<p>Group.xml</p>
</div>
<div class="paragraph">
<p>The object description is used for creation of a Notes group in the Identity Store.</p>
</div>
<div class="paragraph">
<p>Profile.xml</p>
</div>
<div class="paragraph">
<p>The Notes APIs need several attributes for registration of users or moving users in the Notes address book. For details, please refer to the section Notes Connector” in the <em>DirX Identity Connectivity Reference</em>.</p>
</div>
<div class="paragraph">
<p>Profiles are used for storing Notes-relevant attributes per organizational unit in order to avoid storing each attribute in the account separately. The profiles are located in</p>
</div>
<div class="paragraph">
<p><em>domain_root</em> &#8594; <strong>TargetSystems</strong> &#8594; <em>Targetsystem_name</em> &#8594; <strong>configurations</strong> &#8594; <strong>profiles</strong></p>
</div>
<div class="paragraph">
<p>At least one default profile must exist. It is used when no organizational unit specific one is available.</p>
</div>
<div class="paragraph">
<p>The available attributes from the Notes profile objects are:</p>
</div>
<div class="paragraph">
<p><strong>Control parameters:</strong><br>
CreateIdFile<br>
CreateMailDatabase<br>
CreateMailDBNow<br>
CreateNorthAmericanId<br>
SaveIdInAddressBook<br>
SaveIdInFile<br>
SaveInternetPassword<br>
DeleteMailFile</p>
</div>
<div class="paragraph">
<p>Other attributes:<br>
CertifierStructure (will be passed as TargetCertifier to the Notes Connector)<br>
ClientType<br>
DbQuotaSizeLimit<br>
DbQuotaWarningThreshold</p>
</div>
<div class="paragraph">
<p>DefaultMailServer (will normally be mapped to the attribute MailServer)</p>
</div>
<div class="paragraph">
<p>LocalAdmin<br>
MailACLManager<br>
MailForwardAddress<br>
MailOwnerAccess</p>
</div>
<div class="paragraph">
<p>MailServer<br>
MailSystem<br>
MailTemplate<br>
MinPasswordLength</p>
</div>
<div class="paragraph">
<p>OtherMailServers<br>
PathFileCertId<br>
PathFileCertLog<br>
PathUserId<br>
RegistrationServer<br>
Validity</p>
</div>
<div class="paragraph">
<p>TS.xml</p>
</div>
<div class="paragraph">
<p>The object description is used for creation of a Notes target system in the Identity Store.</p>
</div>
<div class="paragraph">
<p>TSAccount.xml</p>
</div>
<div class="paragraph">
<p>The object description is used for creation of a Notes account in the Identity Store. New accounts inherit many attributes from the user. (for example, description, ou, and so on). The following attributes are explicitly set by the object description and hold the following default values:</p>
</div>
<div class="paragraph">
<p><strong>dxmLNcreateInAddressBook=true<br>
dxmLNregisterUser=true<br>
dxmLNuserRegistered=false<br>
dxmLNuserInAddressBook=false</strong></p>
</div>
<div class="paragraph">
<p>There are a few attributes that depend on others:</p>
</div>
<div class="paragraph">
<p><strong>dxrProfilesLink</strong> depends on <strong>ou<br>
dxrPrimaryKey</strong> depends on <strong>dxrProfileLink<br>
dxmLNuniqueOrgUnit</strong> depends on <strong>dxrPrimaryKey<br>
mail</strong> depends on <strong>dxmLNshortName</strong></p>
</div>
<div class="paragraph">
<p>Keep in mind that <strong>dxrProfileLink</strong> is only set for new objects (see description of <strong>ProfileFromOU.js</strong>) and therefore all the other attributes are only created and never changed.</p>
</div>
<div class="paragraph">
<p>Java Scripts</p>
</div>
<div class="paragraph">
<p>This section provides detailed information about Java scripts.</p>
</div>
<div class="paragraph">
<p>Mail.js</p>
</div>
<div class="paragraph">
<p>In the object description <strong>TSAccount.xml</strong>, the Java script <strong>mail.js</strong> is called to generate the mail attribute of the account. The value is calculated whenever the attribute <strong>dxmLNshortName</strong> changes or is created for the first time.</p>
</div>
<div class="paragraph">
<p>The script checks whether the account object holds the attribute <strong>dxrProfileLink</strong>. If true, it uses the attribute <strong>dxrCreateObjDefaults(mail)</strong> of the profile. The value of that attribute is used as a suffix that is blindly appended to the calculated value of the mail address. If <strong>dxrCreateObjDefaults(mail)</strong> is not set or the attribute <strong>dxrProfileLink</strong> is not available, then no mail attribute value is returned.</p>
</div>
<div class="paragraph">
<p>If the mail suffix is available, the mail attribute is calculated in the following way:</p>
</div>
<div class="paragraph">
<p><em>value_of_<strong><em>givenName</em></strong>.value_of_<strong><em>sn</em></strong>.value_of_<strong><em>dxmLNshortName@</em></strong>mail_suffix</em></p>
</div>
<div class="paragraph">
<p>If one of the attributes <strong>givenName</strong>, <strong>sn</strong> (surname), <strong>dxmLNshortName</strong> is not set, the missing components (including the delimiter for the next component) are dropped.</p>
</div>
<div class="paragraph">
<p>The return value of the Java script is stored in the variable "mail".</p>
</div>
<div class="paragraph">
<p>ProfileFromOU.js</p>
</div>
<div class="paragraph">
<p>In the object description <strong>TSAccount.xml</strong>, the Java script <strong>ProfileFromOU.js</strong> is called to generate the <strong>dxrProfileLink</strong> attribute of the account. The value is returned in the variable <strong>dxrProfile</strong> and is set based on the value of the attribute <strong>ou</strong>. If a value of the organizational unit is present, the script tries to find the appropriate profile in the target system specific subtree</p>
</div>
<div class="paragraph">
<p><em>domain_root</em> &#8594; <strong>TargetSystems</strong> &#8594; <em>TargetSystem_name</em> &#8594; <strong>configuration</strong> &#8594; <strong>profiles</strong></p>
</div>
<div class="paragraph">
<p>by matching the <strong>ou</strong> value with the <strong>cn</strong> value of the profile.</p>
</div>
<div class="paragraph">
<p>If no profile for that organizational unit was found or if the <strong>ou</strong> attribute in the account is empty, the Java script tries to find the default profile. If there is no default profile, the return value <strong>dxrProfile</strong> of the Java script is "".</p>
</div>
<div class="paragraph">
<p>Note that the attribute <strong>dxrProfileLink</strong> is only calculated for new objects. If, for example, the <strong>ou</strong> changes in the user object, then the <strong>ou</strong> attribute in the account changes, too (by a master mechanism); nevertheless, the attribute <strong>dxrProfileLink</strong> is not updated (even if it depends on attribute <strong>ou</strong>). It is a workflow task (in the user hooks) to update the attribute <strong>dxrProfileLink</strong> after having renamed the user in the Notes address book.</p>
</div>
<div class="paragraph">
<p>UniqueNameForAccounts.js</p>
</div>
<div class="paragraph">
<p>In the object description <strong>TSAccount.xml</strong>, the Java script <strong>UniqueNameForAccounts.js</strong> is called to generate the <strong>dxrPrimaryKey</strong> attribute of the account. The value is returned in the variable <strong>UniqueNameAccount</strong>.</p>
</div>
<div class="paragraph">
<p>The attribute <strong>UniqueNameAccount</strong> must be unique and is generated the following way:</p>
</div>
<div class="paragraph">
<p><em><strong><em>CN=</em></strong>value_of_<strong><em>givenName</em></strong> value_of_<strong><em>initials</em></strong> value_of_<strong><em>sn/OU=</em></strong>value_of_<strong><em>uniqueOrgUnit/O=</em></strong>value_of_<strong><em>orgUnit</em></strong></em></p>
</div>
<div class="paragraph">
<p>Setup of CN is straightforward. Missing components are simply ignored and the delimiter moves to the next components. The other components require a more sophisticated approach.</p>
</div>
<div class="paragraph">
<p>For the components O and OU, the Java script reads the attributes</p>
</div>
<div class="paragraph">
<p><strong>dxrCreateObjDefaults(Unique)<br>
dxrOptions(TargetCertifier)</strong></p>
</div>
<div class="paragraph">
<p>of the relevant profile (that is defined in the attribute <strong>dxrProfileLink</strong>). The attribute <strong>dxrOptions(TargetCertifier)</strong> is used as value of the component <strong>O</strong>. The component <strong>OU</strong> is only set, if the attribute <strong>UniqueNameAccount</strong> is not yet unique. Therefore the Java script searches all accounts whose attribute <strong>dxrPrimaryKey</strong> matches the component <strong>CN</strong> and component <strong>OU</strong>. If no object with that name is found <strong>UniqueNameAccount</strong> is returned as</p>
</div>
<div class="paragraph">
<p><em><strong><em>CN=</em></strong>value_of_<strong><em>givenName</em></strong> value_of_<strong><em>initials</em></strong> value_of_<strong><em>sn/O=</em></strong>value_of_<strong><em>orgUnit</em></strong></em></p>
</div>
<div class="paragraph">
<p>If more than one object has been found, then the Java script function <strong>getUniqueOrgUnit</strong> analyzes the search results and returns the next available value for OU by using the base for OU (<strong>dxrCreateObjDefaults(Unique)</strong>) and appending a unique number.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As opposed to <strong>UniqueNameForGroups.js</strong>, a unique account name is generated by the script itself. There is no need for the service layer to call the script several times to generate a unique value by a trial and error procedure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>UniqueNameForGroups.js</p>
</div>
<div class="paragraph">
<p>In the object description <strong>Group.xml</strong>, the Java script <strong>UniqueNameForGroups.js</strong> is called to generate the <strong>dxrPrimaryKey</strong> attribute of the group. The value is returned in the variable <strong>ListName</strong>.</p>
</div>
<div class="paragraph">
<p>The Java script uses the attribute cn of the group as the <strong>ListName</strong> and generates a unique name by simply appending an integer value. The service layer provides the current value of that integer value in the variable <strong>$UniqueOrgUnit</strong>. The service layer tries to create the group with that name; if not unique, it will call the Java script again with an incremented value of <strong>$UniqueOrgUnit</strong>. If the Java script reaches the limit 100, it returns the string <strong>JavaScript.Error</strong>, which causes the service layer to stop creation of the group (because no unique list name could be generated).</p>
</div>
<div class="paragraph">
<p>UniqueShortName.js</p>
</div>
<div class="paragraph">
<p>In the object description <strong>TSAccount.xml</strong>, the Java script <strong>UniqueShortNames.js</strong> is called to generate the <strong>dxmLNshortName</strong> attribute of the account. The value is returned in the variable <strong>ShortName</strong>.</p>
</div>
<div class="paragraph">
<p>The Java script sets up the value as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first letter of <strong>givenName</strong></p>
</li>
<li>
<p>first letter of sn</p>
</li>
<li>
<p>employeeNumber</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Java script checks whether that value is unique by calling the Java script function <strong>searchAccountName</strong>, which searches all accounts whose <strong>dxmLNshortName</strong> attribute matches that value (initial substring matching). If the attribute value is not unique, the Java script calls the function <strong>getUniqueCounter</strong>, which calculates the next available number to make the basic value unique. <strong>getUniqueCounter</strong> analyzes the search result (returned by <strong>searchAccountName</strong>) and returns the next available unique number. This unique number is appended to the basic value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As opposed to <strong>UniqueNameForGroups.js</strong>, a unique short name is generated by the script itself. There is no need for the service layer to call the script several times to generate a unique value by a trial and error procedure.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_notes_workflow_and_activities"><a class="anchor" href="#_notes_workflow_and_activities"></a>Notes Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image17.png" alt="Notes Workflow Channels and Objects">
</div>
<div class="title">Figure 18. Notes Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>The workflows handle these Notes objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Person - a physical user in the Notes address book</p>
</li>
<li>
<p>Group - a group in the Notes address book</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DirX Identity supports these Notes workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_Notes_Realtime</strong> - this workflow is a Java-based synchronization workflow. It can run either scheduled or event-based. Event-based means that it is triggered by an account or group change in DirX Identity. Each modification of an account or a group, for example, adding an attribute to an account, adding a new group, adding/removing a member to or from a group or changing the group owner starts a workflow that propagates this change to Notes.<br>
Once the change is applied, it is propagated back to the account or group object in the DirX Identity target system, for example to adjust the group&#8217;s state or other data.</p>
</li>
<li>
<p><strong>Restore_Notes_Ident</strong> - this workflow is a scheduled validation workflow running from the Identity Store to the Notes address book. It imports persons and groups in the Notes address book using the associated Identity target systems accounts and groups. It</p>
</li>
<li>
<p>creates new persons and groups in the Notes address book</p>
</li>
<li>
<p>modifies existing persons and groups (for example, modifies the group’s members and other attributes according to the current group state)</p>
</li>
<li>
<p>deletes persons and groups in the Notes address book</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This workflow is used to perform an initial load of the Notes address book and to keep the Notes address book in sync if changes are done in Identity target system (for example, accounts or groups are added or deleted).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SetPassword_in_Notes</strong> - this workflow is a Java-based synchronization workflow that synchronizes the attribute dxmPassword of a target system account with the attribute HTTPPassword of a person in the Notes address book.</p>
</li>
<li>
<p><strong>Validate_Notes_Ident</strong> - this workflow is a scheduled validation workflow. It imports persons and groups from the Notes address book to the associated Identity target systems and</p>
</li>
<li>
<p>creates new accounts and groups in the Identity Store</p>
</li>
<li>
<p>modifies existing accounts and groups (for example, modifies the group’s members and other attributes according to the current group state)</p>
</li>
<li>
<p>deletes accounts and groups in the Identity Store</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This workflow is used to perform an initial load of the Identity Notes target systems and to keep the Identity target systems in sync if changes are done in Notes (for example, persons or groups are added or deleted).</p>
</div>
</div>
<div class="sect3">
<h4 id="_notes_workflow_ports"><a class="anchor" href="#_notes_workflow_ports"></a>Notes Workflow Ports</h4>
<div class="paragraph">
<p>This section describes Notes workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="paragraph">
<p>The <strong>ts</strong> port references the Notes connected directory and its channels. The channels contain the mapping definitions for the import of persons/groups to the Notes address book and the join definitions. The export parameters are also defined (for exporting persons and groups from the Notes address book).</p>
</div>
<div class="paragraph">
<p>The following filters are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
Standard crypt filter for password decryption.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>IdentityDomain Port</p>
</div>
<div class="paragraph">
<p>The <strong>IdentityDomain</strong> port references the Notes channels (Channel Parent) of the Identity connected directory. The channels contain the mapping definitions for the import of accounts and groups from the Notes address book and the join definition for Identity. The export parameters are also defined (for exporting persons and groups from the Notes address book).</p>
</div>
<div class="paragraph">
<p>There is no filter defined in the <strong>IdentityDomain</strong> port.</p>
</div>
<div class="paragraph">
<p>Note that the validation workflow and the sync workflow use the same connected directory and channel configuration. Only the controller class is changed in the join activity.</p>
</div>
</div>
<div class="sect3">
<h4 id="_notes_workflow_channels"><a class="anchor" href="#_notes_workflow_channels"></a>Notes Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about Notes workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_direction_identity_store_ibm_notes"><a class="anchor" href="#_direction_identity_store_ibm_notes"></a>Direction: Identity Store &#8594; IBM Notes</h5>
<div class="paragraph">
<p>This section describes the mapping and user hook details of the direction Identity Store to IBM Notes. Complex post-mappings and user hooks are required because the Notes target system handles some of the update requests asynchronously (using the <strong>adminP</strong> process) and problems arise if the previous request has not been successfully processed when the next request arrives. Therefore the Notes real-time workflows use an internal attribute <strong>dxrPendingRequest</strong> that indicates whether or not a request can be sent to the Notes system without resulting in an error. For details, please refer to the following sections.</p>
</div>
<div class="paragraph">
<p>For a complete list and explanation of Notes-specific attributes, see the attribute section of the Notes connector description in the <em>DirX Identity Connectivity Reference</em>.</p>
</div>
<div class="paragraph">
<p>Post-Mapping for Groups</p>
</div>
<div class="paragraph">
<p>If the attribute <strong>dxrState</strong> in Identity Store is "DELETED", the operation (as part of the mapped entry) is set to DELETE.</p>
</div>
<div class="paragraph">
<p>Post-Mapping for Accounts</p>
</div>
<div class="paragraph">
<p>If the attribute dxrState in Identity Store is “DELETED”, the operation (as part of the mapped entry) is set to DELETE and the value of the attribute DeleteMailFile is set to <strong>0</strong>.</p>
</div>
<div class="paragraph">
<p>For Modify Requests, the following steps apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For each modify request to the Notes connector, a check is performed whether there is a pending request available (these pending requests are stored in the attribute <strong>dxrPendingRequest</strong>).<br>
<br>
Presence of a pending request results in a check of the <strong>FullName</strong> of Notes against the attribute <strong>dxrPrimaryKey</strong> in the Identity Store. If the attributes are still the same, a trace entry (a warning) is written indicating that the current request will not be propagated (the <strong>Request-Type</strong> in the mapped entry is set to NONE).<br></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the attribute values differ, then later on, the attribute <strong>dxrPendingRequest</strong> will be removed by the user hook <strong>preUpdate</strong>, because the user hook knows the connector for updating the attribute whereas the post-mapping procedure doesn&#8217;t.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Next, the current request is analyzed. A check is made as to whether the request would result in both a <strong>Rename</strong> and a <strong>MoveInHierarchy</strong> operation.<br></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Rename operation is detected by comparing the attributes <strong>LastName</strong>, <strong>FirstName</strong>, <strong>MiddleInitial</strong> and <strong>UniqueOrgUnit</strong> (identified by the <strong>UniqueOrgUnitAttrType</strong> attribute) of Notes against <strong>sn</strong>, <strong>givenName</strong>, <strong>initials</strong> and <strong>dxmLNuniqueOrgUnit</strong> in the Identity Store. If one of the values is different, a <strong>Rename</strong> operation is propagated. A <strong>MoveInHierarchy</strong> operation is detected by the existence of the attribute <strong>PathFileTargetCertId</strong> in the attribute list.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If both a <strong>Rename</strong> and <strong>MoveInHierarchy</strong> operation are detected, then the parameters for the <strong>MoveInHierarchy</strong> operation are dropped and a logging entry (a warning) is written. The <strong>MoveInHierachy</strong> operation (<strong>PathFileTargetCertId</strong>) will be propagated the next time the account is synchronized again to Notes.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>AC - com.siemens.dxm.join.userhook.notes.UserHookAccountsTo (user hooks for accounts)</p>
</div>
<div class="paragraph">
<p>The following user hooks are used:</p>
</div>
<div class="paragraph">
<p>User hook <strong>preUpdate</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>This user hook checks whether the attribute <strong>dxrPendingRequest</strong> (set by an earlier request) could be reset. This is indicated by a change of the <strong>FullName</strong> which means that the request has been processed by Notes. If the <strong>FullName</strong> of Notes is different from the attribute <strong>dxrPrimaryKey</strong> in the Identity Store, then the attribute <strong>dxrPendingRequest</strong> is deleted.</p>
</li>
<li>
<p>The user hook must provide additional attributes that are kept in the Notes profile object in the Identity Store. For this reason, the profile identified by the value of the attribute <strong>ou</strong> is selected. If no such profile exists or the value of <strong>ou</strong> is empty, then the default profile is selected.<br>
<br>
The source attribute list is extended by a set of attributes from the profile object. For details, see the section "Notes Dynamic Configuration" in the <em>DirX Identity Connectivity Reference</em>.</p>
</li>
<li>
<p>Next, the user hook checks whether the account has been moved to another organizational unit in the Identity Store. This is indicated by a change of the <strong>ou</strong> attribute, whereas the attribute <strong>dxrProfileLink</strong> was not changed. If the entry was moved, then a potentially new Notes profile object needs to be assigned in the attribute <strong>dxrProfileLink</strong>.<br>
<br>
The user hook <strong>preUpdate</strong> determines which profile applies and stores the name of the new profile in the member variable <strong>newProfileName</strong> of the user hook. Later on, the user hook <strong>postUpdate</strong> will update that profile name in the Identity Store.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assignment of a new profile updates these attributes:*<br>
PathFileTargetCertId* (derived from the attribute <strong>PathFileCertId</strong> of the new profile)<br>
<strong>TargetCertifier</strong><br>
<strong>Validity</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no profile is available for the new <strong>ou</strong> and the old value of <strong>dxrProfileLink</strong> was mapped to the default profile, then propagation of <strong>MoveInHierachy</strong> to Notes is not possible as no new information for <strong>PathFileTargetCertId</strong> and <strong>TargetCertifier</strong> is available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the attribute <strong>dxrProfileLink</strong> is not set (for example, because the account was created in an earlier DirX Identity version that did not support this attribute) then the user hook <strong>preUpdate</strong> evaluates a profile name using the value of <strong>ou</strong>.</p>
</div>
<div class="paragraph">
<p>User hook <strong>postUpdate</strong></p>
</div>
<div class="paragraph">
<p>After a successful update in Notes this user hook checks whether the attribute <strong>dxrPendingRequest</strong> needs to be set. The existence of the attribute <strong>dxrPendingRequest</strong> guarantees that no other critical update operation (rename or move) on the same objects is initialized while the previous one is still running.</p>
</div>
<div class="paragraph">
<p>The check comprises these tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the attribute <strong>dxmLNregisterUser</strong> is set to true, the user is registered in the Notes server and normally the <strong>FullName</strong> is generated. If the <strong>FullName</strong> is not available in the SPML-Response of the update request, then a pending request is generated.</p>
</li>
<li>
<p>The attributes <strong>LastName</strong>, <strong>FirstName</strong>, <strong>MiddleInitial</strong> and <strong>UniqueOrgUnit</strong> (stored in the attribute defined by <strong>uniqueOrgUnitAttrType</strong>) of Notes are checked against the attributes <strong>sn</strong>, <strong>givenName</strong>, <strong>initials</strong> and <strong>dxmLNuniqueOrgUnit</strong> of the Identity Store. If there is a difference in one of these attributes and the <strong>FullName</strong> of Notes is still the same as <strong>dxrPrimaryKey</strong> in Identity Store, the attribute <strong>dxrPendingRequest</strong> is set.</p>
</li>
<li>
<p>If the attribute <strong>PathFileTargetCertId</strong> is present in the attribute list, then a <strong>MoveInHierarchy</strong> operation needs to be executed by Notes. This is an indication to set the attribute <strong>dxrPendingRequest</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the attribute <strong>dxrPendingRequest</strong> is:</p>
</div>
<div class="paragraph">
<p><code>date=<em>date</em>;PendingOperation=<em>operation</em>;PathFileCertId=<em>value</em>;PathFileTargetCertId=<em>value</em>;FullName=<em>value</em></code></p>
</div>
<div class="paragraph">
<p>Furthermore, if a requested move operation was successful, then the attribute <strong>dxrProfileLink</strong> is set to the value of the previously evaluated <strong>newProfileName</strong> (see the preUpdate user hook).</p>
</div>
</div>
<div class="sect4">
<h5 id="_direction_ibm_notes_identity_store"><a class="anchor" href="#_direction_ibm_notes_identity_store"></a>Direction: IBM Notes &#8594; Identity Store</h5>
<div class="paragraph">
<p>This section describes the user hook details of the direction Identity Store to IBM Notes.</p>
</div>
<div class="paragraph">
<p>For a complete list and explanation of Notes-specific attributes that are kept in the Identity Store, see the attribute section of the Notes connector description in the <em>DirX Identity Connectivity Reference</em>.</p>
</div>
<div class="paragraph">
<p>AI - com.siemens.dxm.join.userhook.notes.UserHookAccountsFrom (user hooks for accounts)</p>
</div>
<div class="paragraph">
<p>The following user hooks are used:</p>
</div>
<div class="paragraph">
<p>User hook <strong>postUpdate</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user hook checks after a successful update in Identity Store, whether the attribute <strong>dxrPendingRequest</strong> could be deleted. If the request contained an update of the attribute <strong>dxrPrimaryKey</strong>, then the attribute <strong>dxrPendingRequest</strong> has to be read first. The reason is, that it could have been set in the <strong>postUpdate</strong> user hook of Identity Store to Notes synchronization. Therefore, it is not available in the attribute list of the Identity Store on the way back due to the fact that the Identity Store is normally not read again. If <strong>dxrPendingRequest</strong> exists it will be deleted.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_password_channel_4"><a class="anchor" href="#_password_channel_4"></a>Password Channel</h5>
<div class="paragraph">
<p>A password channel updates the account passwords.</p>
</div>
<div class="paragraph">
<p>A password channel can also be configured backwards from the connected system to Identity to be able to update some attributes in Identity after a password change or reset has taken place in the connected system. The join engine then as usual synchronizes the attributes specified in the corresponding password channel mapping to Identity after the account with its password-relevant attributes was updated in the connected system.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_medico_workflows"><a class="anchor" href="#_medico_workflows"></a>Medico Workflows</h3>
<div class="paragraph">
<p>The Medico Provisioning workflows operate between a target system of type <strong>Medico</strong> in the Identity Store and the corresponding connected Medico system.</p>
</div>
<div class="paragraph">
<p>Because Medico provides an SPML/SOAP service, the workflows use the SPML connector (SpmlV1SoapConnector2TS) for provisioning. This connector communicates with the Medico SPML server. The following figure illustrates the Medico Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image18.png" alt="Medico Provisioning Workflow Architecture">
</div>
<div class="title">Figure 19. Medico Provisioning Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The workflows handle the following Medico objects:</p>
</div>
<div class="paragraph">
<p><strong>Person</strong> - the physical user. The Person object holds the demographic data and is not used for login.</p>
</div>
<div class="paragraph">
<p><strong>LoginID</strong> (or User ID) - the user login account ID. Each user can have one or more accounts to log into a Medico application. Different accounts are needed for different access rights. Access rights are expressed in terms of roles, profiles and groups. There are special accounts (“Sonderbenutzer” / “Sonderrolle”) with high access rights that are reserved for emergency situations.</p>
</div>
<div class="paragraph">
<p><strong>Role</strong> - the role associated with the LoginID. A role is composed of a set of entry points that regulate the applications and menu entries that are allowed for and presented to a LoginID.</p>
</div>
<div class="paragraph">
<p><strong>Profile</strong> - the profile associated with the LoginID. The profile contains information used mainly to determine the stations (beds) for which physicians are responsible.</p>
</div>
<div class="paragraph">
<p><strong>Group</strong> - the group associated with the LoginID. The group exists for historical reasons, but it can be used to specify general access rights, for example, printer access. A LoginID must have exactly one group associated with it.</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the relationships between Medico and DirX Identity objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image19.png" alt="Relationships between Medico and DirX Identity Objects">
</div>
<div class="title">Figure 20. Relationships between Medico and DirX Identity Objects</div>
</div>
<div class="paragraph">
<p>As shown in the figure, a Person and LoginID object on the Medico side are created from the Account entry on the Identity side.</p>
</div>
<div class="paragraph">
<p>Groups within the Medico target system in DirX Identity have a type attribute. The corresponding object on the Medico side (Role, Profile, Group) is mapped according to this type attribute.</p>
</div>
<div class="paragraph">
<p>The memberships between a LoginID and a Role or Profile are described as member attributes of a Role or Profile. Membership changes result in an add or delete member attribute at the Identity side.</p>
</div>
<div class="paragraph">
<p>The membership between a LoginID and a Group is described in the groupid attribute of the LoginID.</p>
</div>
<div class="sect3">
<h4 id="_medico_workflow_prerequisites_and_limitations"><a class="anchor" href="#_medico_workflow_prerequisites_and_limitations"></a>Medico Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Medico workflow requires medico//s Release 16 or higher.</p>
</div>
<div class="paragraph">
<p>The Medico SPML server supports a subset of the SPML V1 request; in particular, the server does not support search requests without filter specifications. As a result, you must be careful when changing the configuration. For detailed information on the Medico SPML server, see the Medico documentation. This limitation also means that the real-time password workflow SetPassword currently does not work. Please use the "setPassword in Medico" workflow instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_medico_workflow"><a class="anchor" href="#_configuring_the_medico_workflow"></a>Configuring the Medico Workflow</h4>
<div class="paragraph">
<p>To configure the connection to Medico:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the IP address and the data port at the Medico service object (Medico CD &#8594; Service).</p>
</li>
<li>
<p>Configure the socket timeout at the workflow&#8217;s TS port. You may increase the timeout value (in seconds) for long SPML requests to the Medico SPML server (for example, searches with a large result set).</p>
</li>
<li>
<p>Do not change the URL path.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_medico_target_system"><a class="anchor" href="#_configuring_the_medico_target_system"></a>Configuring the Medico Target System</h4>
<div class="paragraph">
<p>The Medico target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - for each Medico LoginID, one account with <strong>dxrType=login</strong> is created in DirX Identity. The Medico target system in the Identity Store does not contain any Person objects. All accounts are located in a subfolder <strong>logins</strong>.</p>
</li>
<li>
<p><strong>Groups</strong> - the Medico role, profile and group objects are represented as groups in the subfolders <strong>Medico Roles</strong>, <strong>Medico Profiles</strong> and <strong>Medico Groups</strong>. The attribute <strong>dxrType</strong> is used to identify the type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Medico-specific JavaScript superior.js is used to distribute the objects to the different folders.</p>
</div>
<div class="paragraph">
<p>The following Medico-specific JavaScripts calculate the attributes <strong>dxrName</strong> and <strong>dxrPrimaryKey</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>calcDxrNameAcc.js</p>
</li>
<li>
<p>calcDxrNameGroup.js</p>
</li>
<li>
<p>calcPrimaryKeyAcc.js</p>
</li>
<li>
<p>calcPrimaryKeyGroup.js</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The attribute <strong>dxrPrimaryKey</strong> contains the SPML ID in the target system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>loginid=dxrName/employeeNumber,type=login</p>
</li>
<li>
<p>groupid=dxrName,type=group</p>
</li>
<li>
<p>profileid=dxrName,type=profile</p>
</li>
<li>
<p>roleid=dxrName,type=role</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The attribute <strong>dxrName</strong> contains the employeeNumber for accounts and the cn for groups.</p>
</div>
<div class="paragraph">
<p>Mastered attributes for accounts include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dxrProfession</p>
</li>
<li>
<p>gender</p>
</li>
<li>
<p>dayOfBirth</p>
</li>
<li>
<p>mail</p>
</li>
<li>
<p>street</p>
</li>
<li>
<p>postalCode</p>
</li>
<li>
<p>l</p>
</li>
<li>
<p>c</p>
</li>
<li>
<p>telephoneNumber</p>
</li>
<li>
<p>title</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_medico_workflow_and_activities"><a class="anchor" href="#_medico_workflow_and_activities"></a>Medico Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the Medico workflow&#8217;s join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image20.png" alt="Medico Provisioning Workflow Channels and Objects">
</div>
<div class="title">Figure 21. Medico Provisioning Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>A pair of channels (one channel per direction) exists for every Medico object (Role, Profile, Group, LoginID, Person). There are no member channels. Memberships are modeled as the member attribute.</p>
</div>
<div class="paragraph">
<p>The following construction is used for the logins and persons channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identity side - the <strong>logins</strong> channel is the primary channel of the persons channel. Person data is merged with the login channel that represents the account. DirX Identity does not model a Person object.</p>
</li>
<li>
<p>Medico side - the <strong>person</strong>s channel references the Medico Person object. Demographic data is passed in this channel.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_medico_workflow_ports"><a class="anchor" href="#_medico_workflow_ports"></a>Medico Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the Medico workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CR -</strong> <strong>Crypt Filter</strong><br>
The standard crypt filter for password decryption.</p>
</li>
<li>
<p><strong>MF - Medico Crypt Filter</strong><br>
A MedicoCrypt filter is implicitly configured. It is used to send the Medico password attribute <strong>pawo</strong> in the SOAP request decrypted to the Medico SPML server. This filter is used only for the initial password when a new login is added.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_medico_workflow_channels"><a class="anchor" href="#_medico_workflow_channels"></a>Medico Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about Medico workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_common_aspects_4"><a class="anchor" href="#_common_aspects_4"></a>Common Aspects</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Medico</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mapAttrMaxLength</strong> - Medico attributes have a maximum length, and requests with attribute values exceeding this limit will fail. As a result, this mapping function truncates the value.</p>
</li>
<li>
<p><strong>mapAttrDefaultMaxLength</strong> - for convenience, an additional mapping function is defined which sets a given default value if there is no source attribute value. The function also truncates the value to the defined maximum length.</p>
</li>
<li>
<p><strong>mapValidFromAttr</strong> - in the Medico system, objects are never deleted. Each object has a <strong>validFrom</strong> and <strong>validTo</strong> attribute. The conversion is handled within this mapping function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Medico &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CommonProcsMedico.calculateIdInIdentity</strong> - calculates the Id.</p>
</li>
<li>
<p><strong>dxrType</strong> is set according to the type of the channel handles (login, profile, &#8230;&#8203;).</p>
</li>
<li>
<p><strong>dxrPrimarykey</strong> is set to the value of the source ID.</p>
</li>
<li>
<p><strong>dxrName</strong> is taken from the Medico id attribute (loginid, profileid, &#8230;&#8203;).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_person"><a class="anchor" href="#_person"></a>Person</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Medico</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>"pnr="$\{source.employeeNumber}",type=person</strong></p>
</li>
<li>
<p>Join: <strong>pnr= $\{source.employeeNumber}</strong></p>
</li>
<li>
<p>A Medico person has two additional name attributes:*<br>
Namechr* surname, givenName<strong><br>
Namechrnorm</strong> Namchr umlauts are expanded and converted to lowercase<br>
For details see the JavaDoc of <strong>mapNameChr</strong> and <strong>mapNameChrNorm</strong></p>
</li>
<li>
<p>Medico supports only one e-mail address per person. In DirX Identity, e-mail is defined as a multi-valued attribute. If there is no e-mail attribute value stored in Medico, the first value is taken from the DirX Identity e-mail attribute. If the value in Medico matches one of the DirX Identity values, nothing is changed. If not, the first value is taken.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Medico &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Primary Channel login - join to primary via employeeNumber.</p>
</li>
<li>
<p>Postmapping - prevents creating a Person object. Action is set to <strong>NONE</strong> if the action was set to <strong>add</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_login"><a class="anchor" href="#_login"></a>Login</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Medico</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: the <strong>dxrPrimaryKey</strong> is used as the identifying attribute.</p>
</li>
<li>
<p>Join: the join is performed with the ID.</p>
</li>
<li>
<p>loginid: the <strong>dxrName</strong> value is used as the loginid.</p>
</li>
<li>
<p>For new logins, a constant groupid <strong>DIRXOHNE</strong> is set (groupid is a mandatory attribute).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>LC - com.siemens.dxm.join.userhook.medico.UserHookAccountsTo</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>preUpdate - creates a person if necessary</p>
</li>
<li>
<p>postUpdate - if login was renamed, the old login is disabled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Medico&#8594; Identity Store</p>
</div>
<div class="paragraph">
<p><strong>LI - com.siemens.dxm.join.userhook.medico.UserHookAccountsFrom</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>preUpdate: merge the person attribute to account. In the current workflow version, it should work without this user hook (primary channel construct). If you have an older version of this workflow, you need this user hook.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_password_channel_5"><a class="anchor" href="#_password_channel_5"></a>Password Channel</h5>
<div class="paragraph">
<p>A password channel updates the login passwords.</p>
</div>
<div class="paragraph">
<p>A Password Channel can also be configured backwards from the Connected System to Identity to be able to update some attributes in Identity after a password change or reset has taken place in the Connected System. The join engine then as usual synchronizes the attributes specified in the corresponding Password Channel Mapping to Identity after the account with its password relevant attributes was updated in the Connected System.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_office_365_workflows"><a class="anchor" href="#_office_365_workflows"></a>Office 365 Workflows</h3>
<div class="paragraph">
<p>The Office 365 Provisioning workflows operate between a target system of type <strong>Office 365</strong> in the Identity Store and the corresponding connected Office 365 endpoint.</p>
</div>
<div class="paragraph">
<p>The workflows use the Office 365 connector (Office365Connector) for provisioning. This connector communicates with the Office 365 endpoint using RESTful API with JSON requests.</p>
</div>
<div class="paragraph">
<p>The connector uses Office 365 OAuth server for authentication and authorization.</p>
</div>
<div class="paragraph">
<p>The Office 365 workflows handle the following Office 365 objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account -</strong> the common Office 365 (Windows Azure) accounts.</p>
</li>
<li>
<p><strong>Group</strong> - the common Office 365 (Windows Azure) security groups.</p>
</li>
<li>
<p><strong>Role</strong> - the predefined Office 365 (Windows Azure) administrative roles.</p>
</li>
<li>
<p><strong>Service</strong> <strong>Plan</strong> - the access to the predefined Office 365 applications bound to a single Office 365 license (subscribed sku).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The delivered workflows include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Validate_Office365_Realtime -</strong> the validation workflow that imports existing Office 365 accounts, security groups, roles and service plans together with assignment from Office 365 server to the Identity Store.</p>
</li>
<li>
<p><strong>Ident_Office365_Realtime -</strong> the synchronization workflow that exports detected changes for account and group objects including assignments from Identity Store to the Office 365 endpoint in the first step. The second step is to validate the processed changes in Office 365 endpoint to the Identity Store.</p>
</li>
<li>
<p><strong>SetPassword in Office365</strong> - the SetPassword workflow that sets the password for the user object in Office 365.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates the Office 365 Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image21.png" alt="Office 365 Provisioning Workflow Architecture">
</div>
<div class="title">Figure 22. Office 365 Provisioning Workflow Architecture</div>
</div>
<div class="sect3">
<h4 id="_office_365_workflow_prerequisites_and_limitations"><a class="anchor" href="#_office_365_workflow_prerequisites_and_limitations"></a>Office 365 Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Office 365 Provisioning workflows support only those object and attributes supported by the Office 365 connector. The workflows can handle only one valid Office 365 license (subscribed sku).</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_office_365"><a class="anchor" href="#_connecting_to_office_365"></a>Connecting to Office 365</h4>
<div class="paragraph">
<p>Verify that services are correctly configured at the Office 365 connected directory. The Office 365 Service referenced by the connected directory should contain the default value <strong>graph.microsoft.com</strong> with SSL enabled. The referenced Office 365 OAuth Service should contain the full URL <strong><a href="https://login.microsoftonline.com/*" class="bare">https://login.microsoftonline.com/*</a><em>tenantID</em></strong>/oauth2/token*. Verify that both Graph API (<strong><a href="https://graph.microsoft.com" class="bare">https://graph.microsoft.com</a></strong>) and the OAuth service (<strong><a href="https://login.microsoftonline.com" class="bare">https://login.microsoftonline.com</a></strong>/<em>tenantID</em>/<strong>oauth2/token</strong>) are accessible from the host where the Office 365 workflows will run.</p>
</div>
<div class="paragraph">
<p>Office 365 connected directory and provisioning workflows support the central HTTP proxy server configuration. See the section "HTTP Proxy Server Configuration" for details.</p>
</div>
<div class="paragraph">
<p>DirX Identity must be registered as a valid principal service for your existing Office 365 tenant domain. Use Windows PowerShell commands to create a principal service. You can also use an existing script CreateServicePrincipal.ps1 which can be freely downloaded from Internet. As a result of the configuration, you will obtain an application principal ID and a symmetric key used for authentication to the OAuth service.</p>
</div>
<div class="paragraph">
<p>Configure the tab Graph API and enter your Office 365 <strong>Tenant</strong> and <strong>Application ID</strong>. Enter the generated client key in the <strong>Application Secret</strong> field.</p>
</div>
<div class="paragraph">
<p>Make sure that the registered principal service representing DirX Identity has sufficient rights. For basic user synchronization and group assignment, the Office 365 role <strong>User</strong> <strong>Account</strong> <strong>Administrator</strong> is sufficient. The assignment of the Office 365 roles requires assignment of the <strong>Company</strong> <strong>Administrator</strong> role. Use Microsoft PowerShell to administer the rights of the principal service.</p>
</div>
<div class="paragraph">
<p>Note that the default validity for the Application Secret is one year. The Office 365 OAuth service will refuse incoming requests that use an expired key. Renew the Application Secret also in Microsoft PowerShell when necessary.</p>
</div>
<div class="paragraph">
<p>Check the <strong>Provisioning</strong> settings used by the connected directory and then set them to the real values for your provisioned target system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_office_365_target_system"><a class="anchor" href="#_configuring_the_office_365_target_system"></a>Configuring the Office 365 Target System</h4>
<div class="paragraph">
<p>The Office 365 target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> – all Office 365 accounts are located in a subfolder <strong>Accounts</strong>.</p>
</li>
<li>
<p><strong>Groups</strong>/<strong>Security</strong> <strong>Groups</strong> – all Office 365 groups are located in a subfolder <strong>Security</strong> <strong>Groups</strong>.</p>
</li>
<li>
<p><strong>Groups</strong>/<strong>Roles</strong> – all Office 365 roles are located in a subfolder <strong>Roles</strong>.</p>
</li>
<li>
<p><strong>Groups</strong>/<strong>Service</strong> <strong>Plans</strong> – all Office 365 service plans that belong to a single valid Office 365 license (subscribed sku) are located in a subfolder <strong>Service</strong> <strong>Plans</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of accounts, groups, roles and service plans contains the unique ID generated by the Office 365 endpoint.</p>
</div>
<div class="paragraph">
<p>The <strong>dxrLicense</strong> attribute is automatically populated if any active service plan assignment exists. It’s deleted when the last service plan is unassigned from a user. It uses the obligation mechanism (see service plan objects) and the target system-specific JavaScript AccountSkuId.js.</p>
</div>
<div class="paragraph">
<p>The group membership (security groups, roles and service plans) is stored at the account object and references the <strong>dxrPrimaryKey</strong> attribute of group objects.</p>
</div>
<div class="paragraph">
<p>Configure the <strong>Tenant</strong> <strong>Domain</strong> property at the target system at the Options tab. This value is used as a suffix for the Office 365 User Principal Name (dxmADsUserPrincipalName).</p>
</div>
</div>
<div class="sect3">
<h4 id="_office_365_workflow_and_activities"><a class="anchor" href="#_office_365_workflow_and_activities"></a>Office 365 Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image22.png" alt="Office 365 Provisioning Workflow Channels and Objects">
</div>
<div class="title">Figure 23. Office 365 Provisioning Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>The Office 365 objects and membership are synchronized via a pair of channels (one channel per direction).</p>
</div>
</div>
<div class="sect3">
<h4 id="_office_365_workflow_ports"><a class="anchor" href="#_office_365_workflow_ports"></a>Office 365 Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the Office 365 workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
An Office 365 filter is configured implicitly. It is used to send the decrypted password attribute <strong>password</strong> to the Office 365 endpoint.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_office_365_workflow_channels"><a class="anchor" href="#_office_365_workflow_channels"></a>Office 365 Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about Office 365 workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_accounts"><a class="anchor" href="#_accounts"></a>Accounts</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Office 365:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>dxrPrimaryKey</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong></p>
</li>
<li>
<p><strong>accountEnabled</strong> - the attribute used to disable the account object in Office 365. The correct value is derived from the <strong>dxrState</strong> attribute of the corresponding account object in the Identity Store.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>AC</strong> - <strong>com.siemens.dxm.join.map.office365.accounts.to.UserHookSyncServicePlansAndSkuId</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>preUpdate</strong> - removes the mapped values for the attributes skuId and disabledPlans with values for joined entry in order to prevent the synchronization of these attributes.</p>
</li>
<li>
<p><strong>postUpdate</strong> – checks whether a synchronization of the <strong>skuId</strong> and <strong>disabledPlans</strong> attributes is necessary. It actualizes the list of disabled service plans according to the current list of assigned service plans in Office 365. It also removes an unused license (sku) for an Office 365 account.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Office 365 &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>${joinedEntry.id}</strong> or <strong>"cn="${source.displayName}","+${env.role_ts_account_base}</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong> or <strong>${target.id}</strong>.</p>
</li>
<li>
<p><strong>dxrTSState</strong> - the attribute used to detect the current state of the account in Office 365. The correct value is derived from the <strong>accountEnabled</strong> attribute of the corresponding account object in Office 365. It is set to DELETED when no account entry is found.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>AI</strong> - <strong>com.siemens.dxm.join.map.office365.accounts.from.UserHookGetServicePlans</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>prolog</strong> - creates a list of available service plans for a valid Office 365 license. It makes them available for other mapping classes.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_groups"><a class="anchor" href="#_groups"></a>Groups</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Office 365</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>dxrPrimaryKey</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong></p>
</li>
<li>
<p>Post-Mapping - if the <strong>dxrState</strong> attribute in the Identity Store is DELETED, the operation (as part of the mapped entry) is set to DELETE.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Office 365 &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>${joinedEntry.id}</strong> or <strong>"cn="${source.displayName}",cn=security groups,"+${env.role_ts_group_base}</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong> or <strong>${target.id}</strong>.</p>
</li>
<li>
<p><strong>dxrTSState</strong> - the attribute used for detection of the real state of the group in Office 365. It is set to ENABLED for existing entries; for non-existing entries, it is set to DELETED.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_roles"><a class="anchor" href="#_roles"></a>Roles</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Office 365</p>
</div>
<div class="paragraph">
<p><strong>RC</strong> - <strong>com.siemens.dxm.join.map.office365.roles.to.UserHookRolesTo</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>processSourceEntry</strong> - prevents synchronization of role objects to Office 365 since roles are read-only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Office 365 &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>${joinedEntry.id}</strong> or <strong>"cn="${source.displayName}",cn=roles,"+${env.role_ts_group_base}</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong> or <strong>${target.id}</strong>.</p>
</li>
<li>
<p><strong>dxrTSState</strong> - the correct value is derived from the <strong>roleDisabled</strong> attribute of the corresponding role object in Office 365. It is set to DELETED when no role entry is found.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_service_plans"><a class="anchor" href="#_service_plans"></a>Service Plans</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Office 365</p>
</div>
<div class="paragraph">
<p><strong>SC</strong> - <strong>om.siemens.dxm.join.map.office365.plans.to.UserHookServicePlansTo</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>processSourceEntry</strong> – this user hook prevents synchronization of service plan objects to Office 365 since service plan are read-only parts of an existing Office 365 license.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Office 365 &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>${joinedEntry.id}</strong> or <strong>"cn="${source.servicePlanName}",cn=service plans,"+${env.role_ts_group_base}</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong> or <strong>${target.id}</strong>.</p>
</li>
<li>
<p><strong>dxrTSState</strong> - the attribute used for detection of real state of the service plan in Office 365. It is set to ENABLED for existing entries, for non-existing entries it is set to DELETED.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_password_channel_6"><a class="anchor" href="#_password_channel_6"></a>Password Channel</h5>
<div class="paragraph">
<p>A password channel updates the Office 365 account passwords.</p>
</div>
</div>
<div class="sect4">
<h5 id="_member_channel"><a class="anchor" href="#_member_channel"></a>Member Channel</h5>
<div class="paragraph">
<p>The member channel configuration holds the mapping of the group members.</p>
</div>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Office 365</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mapping of the <strong>memberOf</strong> attribute is handled in a special Java mapping function. It separates membership for service plans and sends the result to Office 365. The Office 365 connector can handle both role and group memberships. The service plans and license assignments are handled in the AC user hook (user channel user hook).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Office 365 &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mapping of the member state <strong>dxrGroupMember</strong> attributes is standard for all attributes. The information about assigned groups, roles and service plans in Office 365 is joined.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openicf_windows_local_accounts_workflows"><a class="anchor" href="#_openicf_windows_local_accounts_workflows"></a>OpenICF Windows Local Accounts Workflows</h3>
<div class="paragraph">
<p>The OpenICF Windows Local Accounts Provisioning workflows operate between a target system of type <strong>OpenICF</strong> in the Identity Store and the corresponding OpenICF .Net connector server, which is configured for communication with a Windows Local Accounts and Groups database using the OpenICF connector bundle <strong>WindowsLocalAccounts.Connector.dll</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>WindowsLocalAccounts.Connector.dll</strong> bundle represents the OpenICF Windows Local Accounts connector, which is described in the <em>DirX</em> <em>Identity Connectivity Reference</em> in the section "OpenICF Windows Local Accounts Connector".</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the OpenICF Windows Local Accounts deployment.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image23.png" alt="OpenICF Windows Local Accounts Deployment">
</div>
<div class="title">Figure 24. OpenICF Windows Local Accounts Deployment</div>
</div>
<div class="paragraph">
<p>As shown in the figure, the Java-based UNIX-OpenICF connector sends a request to an OpenICF .Net connector server which runs on a Windows platform. The OpenICF connector server passes the request to the Windows Local Accounts connector bundle. The bundle then establishes a connection to the specified Windows host and performs the operations on the host&#8217;s local Security Account Manager (SAM) database. It is possible to provision several Windows hosts using a single OpenICF .Net connector server.</p>
</div>
<div class="paragraph">
<p>For a more detailed description about deployment scenarios, see the <em>DirX Identity Connectivity Reference</em> &#8594; "OpenICF Windows Local Accounts Connector".</p>
</div>
<div class="paragraph">
<p>For a detailed description of the DirX Identity Java-based UNIX-OpenICF connector, see the <em>DirX Identity Connectivity Reference</em> &#8594; "UNIX-OpenICF Connector".</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the OpenICF Windows Local Accounts Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image24.png" alt="OpenICF Windows Local Accounts Provisioning Workflow Architecture">
</div>
<div class="title">Figure 25. OpenICF Windows Local Accounts Provisioning Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The workflows handle the following Windows local system objects:</p>
</div>
<div class="paragraph">
<p><strong>Account</strong> (synonymously also named User) - the Windows local system accounts.</p>
</div>
<div class="paragraph">
<p><strong>Group</strong> - the Windows local system groups.</p>
</div>
<div class="paragraph">
<p>The delivered workflows are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_WinLA-OICF_Realtime</strong> - the synchronization workflow that exports detected changes for account and group objects from the Identity Store to the Windows system and then validates the processed changes in the Windows system to the Identity Store.</p>
</li>
<li>
<p><strong>SetPassword in WinLA-OICF</strong> - the workflow that sets the password for the account in the Windows system.</p>
</li>
<li>
<p><strong>Validate_WinLA-OICF_Realtime</strong> - the validation workflow that imports existing Windows accounts and groups including group assignments from the Windows system to the Identity Store.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_openicf_windows_local_accounts_workflow_prerequisites_and_limitations"><a class="anchor" href="#_openicf_windows_local_accounts_workflow_prerequisites_and_limitations"></a>OpenICF Windows Local Accounts Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>All prerequisites and limitations refer to the connector and are therefore described in the <em>DirX Identity Connectivity Reference</em> "OpenICF Windows Local Accounts Connector" section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_the_windows_local_accounts_system"><a class="anchor" href="#_connecting_to_the_windows_local_accounts_system"></a>Connecting to the Windows Local Accounts System</h4>
<div class="paragraph">
<p>Before you configure the workflows, install and configure the OpenICF .Net Connector Server as described in the <em>DirX Identity Connectivity Reference</em> &#8594; OpenICF Windows Local Accounts Connector.</p>
</div>
<div class="paragraph">
<p>Then configure the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the WinLA-OpenICF connected directory that represents the Windows Local Accounts system to be provisioned, go to the OpenICF Connector Server tab and from there to the connected directory that represents the OpenICF Server (<strong>Generic</strong> connected directory type) and specify the IP address or the host name and the data port of the OpenICF Server service object. Adapt the bind profile for the OpenICF Server: set the password that is configured as a shared secret with the OpenICF connector server and enable SSL if it is enabled on the OpenICF server side. Using SSL may require additional configuration steps. See the section "UNIX-OpenICF Connector" in the <em>DirX Identity Connectivity Reference</em> for details.</p>
</li>
<li>
<p>On the WinLA-OpenICF connected directory, specify the IP address or the host name of the targeted Windows system at the WinLA-OpenICF service object. No port number is required here. Then set the bind profile properly. Because the OpenICF .Net Connector Server is started under credentials with appropriate access rights for managing the target Windows systems, no user name must be specified. A user name beginning with "dummy" would have the same effect because it is not used for building a connection to the target Windows system. The password is ignored in these cases.</p>
</li>
<li>
<p>Specify the <strong>Response</strong> <strong>Timeout</strong> property on the OpenICF Connector Server tab of the WinLA-OpenICF Connected Directory. The default value is <strong>30</strong> and should be sufficient.</p>
</li>
<li>
<p>Check the settings related to the OpenICF connector bundle at the TS port object tab OpenICF Connector Bundle, which usually must not be changed. The properties to define are <strong>Bundle</strong> <strong>Name</strong> (default: <strong>WindowsLocalAccounts.Connector</strong>), <strong>Bundle</strong> <strong>Version</strong> (default: <strong>1.4.0.0</strong>) and <strong>Class</strong> <strong>Name</strong> (the default is <strong>Org.IdentityConnectors.WindowsLocalAccounts.WindowsLocalAccountsConnector</strong>).</p>
</li>
<li>
<p>Assign the resource family <strong>OpenICF</strong> in the IdS-J server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_openicf_windows_local_accounts_target_system"><a class="anchor" href="#_configuring_the_openicf_windows_local_accounts_target_system"></a>Configuring the OpenICF Windows Local Accounts Target System</h4>
<div class="paragraph">
<p>The target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accounts - all Windows accounts are located in a subfolder Accounts.</p>
</li>
<li>
<p>Groups - all Windows groups are located in a subfolder Groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The attributes dxrName and dxrPrimaryKey of accounts contain the name (SamAccountName) of these objects in the connected Windows system.</p>
</div>
<div class="paragraph">
<p>The standard JavaScript dxrNameForAccounts.js generates the attribute dxrName for the Windows account.</p>
</div>
<div class="paragraph">
<p>The attributes dxrName and dxrPrimaryKey of groups contain the name (SamAccountName) of these objects in the connected Windows system.</p>
</div>
<div class="paragraph">
<p>The account object also stores the group membership and references the dxrPrimaryKey attribute of the group objects.</p>
</div>
</div>
<div class="sect3">
<h4 id="_openicf_windows_local_accounts_workflow_and_activities"><a class="anchor" href="#_openicf_windows_local_accounts_workflow_and_activities"></a>OpenICF Windows Local Accounts Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the OpenICF Windows Local Accounts workflow&#8217;s join activity:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image25.png" alt="OpenICF Windows Local Accounts Provisioning Workflow Channels">
</div>
<div class="title">Figure 26. OpenICF Windows Local Accounts Provisioning Workflow Channels</div>
</div>
</div>
<div class="sect3">
<h4 id="_openicf_windows_local_accounts_workflow_ports"><a class="anchor" href="#_openicf_windows_local_accounts_workflow_ports"></a>OpenICF Windows Local Accounts Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the ports of the workflows.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
This filter is configured implicitly. It is used to send the decrypted password attribute <strong><em>PASSWORD</em></strong> to the OpenICF connector server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_openicf_windows_local_accounts_workflow_channels"><a class="anchor" href="#_openicf_windows_local_accounts_workflow_channels"></a>OpenICF Windows Local Accounts Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about the OpenICF Windows Local Accounts workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_accounts_2"><a class="anchor" href="#_accounts_2"></a>Accounts</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; WinLA -OpenICF</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct mapping <strong>dxrPrimaryKey</strong> &#8594; ID - where <strong>dxrPrimaryKey</strong> is built by the common JavaScript dxrNameForAccounts, producing a unique account name in the Identity target system.</p>
</li>
<li>
<p>Java Source mapping &#8594; <strong><em>ENABLE</em></strong> - the attribute is used for enabling or disabling the account in the Windows system. The value is derived from the dxrState attribute of the corresponding account object in DirX Identity.</p>
</li>
<li>
<p>Direct mapping dxmPassword &#8594; <strong><em>PASSWORD</em></strong> - which is used only on an add request.</p>
</li>
<li>
<p>Join - ${source.dxrPrimaryKey}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: WinLA -OpenICF &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Join via the <strong>dxrName</strong> attribute that is mapped in the same way as the dxrPrimaryKey attribute from $\{source.id}.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_groups_2"><a class="anchor" href="#_groups_2"></a>Groups</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; WinLA -OpenICF</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct mapping dxrPrimaryKey &#8594; ID– where dxrPrimaryKey is taken from the cn of the group in the Identity target system.</p>
</li>
<li>
<p>Join - ${source.dxrPrimaryKey}</p>
</li>
<li>
<p>PostMapping script - changes the type of the request to delete if dxrState=DELETED.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: WinLA -OpenICF &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Join via the <strong>dxrName</strong> attribute that is mapped in the same way as the <strong>dxrPrimaryKey</strong> attribute from ${source.id}.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_members"><a class="anchor" href="#_members"></a>Members</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; WinLA-OpenICF</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java common class mapping Members &#8594; <strong><em>GROUPS</em></strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_setpassword_2"><a class="anchor" href="#_setpassword_2"></a>setPassword</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; WinLA-OpenICF</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct mapping <strong>dxmPassword</strong> &#8594; <strong><em>PASSWORD</em></strong></p>
</li>
<li>
<p>Direct mapping <strong>dxmPasswordExpired</strong> &#8594; <strong><em>PASSWORD_EXPIRED</em></strong></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_racf_workflows"><a class="anchor" href="#_racf_workflows"></a>RACF Workflows</h3>
<div class="paragraph">
<p>The RACF Provisioning workflows operate between a target system of type <strong>RACF</strong> in the Identity Store and the corresponding connected RACF system.</p>
</div>
<div class="paragraph">
<p>The RACF connector used in the workflows communicates with the LDAP server across the native LDAP protocol, as shown in the following figure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image26.png" alt="RACF Workflow Architecture">
</div>
<div class="title">Figure 27. RACF Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The delivered workflows include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_RACF_Realtime</strong> - the synchronization workflow that exports detected changes for account and group objects from Identity Store to the RACF end system and then validates the processed changes in RACF to the Identity Store. The workflow also generates a password if the object is created. When this workflow is triggered by a schedule or started directly in DirX Identity Manager, it also synchronizes the Users and Groups subtrees.</p>
</li>
<li>
<p><strong>SetPassword_in_RACF</strong> - the SetPassword workflow that synchronizes the user’s password to RACF when a password change in the Identity Store is detected.</p>
</li>
<li>
<p><strong>Validate_RACF_Realtime</strong> - the validation workflow that imports existing RACF accounts and RACF groups from RACF to the Identity Store.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_prerequisites_and_limitations"><a class="anchor" href="#_prerequisites_and_limitations"></a>Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The RACF workflows have the following prerequisites and limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The RACF connector does not support nested group assignments. They cannot be read or written.</p>
</li>
<li>
<p>The workflow and the connector do not handle the RACF group member limit for groups that are not default groups.</p>
</li>
<li>
<p>Group memberships in the DirX Identity target system must be stored at the account.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_racf_target_system"><a class="anchor" href="#_configuring_the_racf_target_system"></a>Configuring the RACF Target System</h4>
<div class="paragraph">
<p>Group memberships must be stored at the accounts, so <strong>Reference Group from Account</strong> must be checked.</p>
</div>
<div class="paragraph">
<p>Each RACF user must have a RACF default group. When a RACF user is to be created, the channel user hook of the Provisioning workflow calculates the default group to be used. It selects from a list of default groups that are configured in the target system using the Options tab &#8594; <strong>Default Groups</strong>. Make sure to fill in this list with enough groups to hold all the RACF users and make sure they already exist in RACF. Keep in mind that the maximum number of users per RACF group is limited to <strong>5900</strong>.</p>
</div>
<div class="paragraph">
<p>The Options tab of the target system also shows the field <strong>Last Used Default Group</strong>. It is managed by the workflow user hook and holds the last used default group. You do not need to fill in this field.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_connection_to_racf"><a class="anchor" href="#_configuring_the_connection_to_racf"></a>Configuring the Connection to RACF</h4>
<div class="paragraph">
<p>As the RACF connector accesses the RACF system via LDAP, the properties for the LDAP service and bind profile apply.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_connected_directory"><a class="anchor" href="#_configuring_the_connected_directory"></a>Configuring the Connected Directory</h4>
<div class="paragraph">
<p>As with the LDAP connected directory, it is important to configure the base nodes for users and groups within the DirX Identity target system folder and in the connected system. The corresponding fields can be set in the connected directory’s Provisioning tab.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the tab is not visible, perform <strong>Reload Object Descriptors</strong> from the context menu.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, for a RACF system, you must configure the parent node for the connection objects (representing RACF user - group memberships) in the Specific Attributes tab.</p>
</div>
<div class="paragraph">
<p>Provisioning</p>
</div>
<div class="paragraph">
<p><strong>Account Base</strong> - the base node for the account tree in the DirX Identity target system.</p>
</div>
<div class="paragraph">
<p><strong>Group Base</strong> - the base node for the group tree in the DirX Identity target system.</p>
</div>
<div class="paragraph">
<p><strong>User Base</strong> - the base node for the accounts in the RACF connected system.</p>
</div>
<div class="paragraph">
<p><strong>Group Base</strong> - the base node for the groups in the RACF connected system.</p>
</div>
<div class="paragraph">
<p>Specific Attributes</p>
</div>
<div class="paragraph">
<p><strong>connect_base</strong> - the base node for the connect objects (user-group memberships) in the RACF connected system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_racf_workflow_ports"><a class="anchor" href="#_racf_workflow_ports"></a>RACF Workflow Ports</h4>
<div class="paragraph">
<p>This section describes RACF workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
The configured Crypt Filter decrypts the password attribute racfPassword before passing it to the RACF connector. The attribute name is configured in the Target System tab of the TS port.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_racf_workflow_channels"><a class="anchor" href="#_racf_workflow_channels"></a>RACF Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about RACF workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_accounts_channel"><a class="anchor" href="#_accounts_channel"></a>Accounts Channel</h5>
<div class="paragraph">
<p>The members channel must be referenced from the accounts channel. Note the following attributes:</p>
</div>
<div class="paragraph">
<p>racfid</p>
</div>
<div class="paragraph">
<p>The racfid is used as an identifier for users in RACF and is stored in the DirX Identity target system account in the attribute racfid.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The racfid cannot have more than 8 characters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>racfDefaultGroup</p>
</div>
<div class="paragraph">
<p>The default group for a RACF user is calculated in the channel user hook and passed as an artificial attribute of the source entry. For details on configuring default groups, see the section “Configuring the RACF Target System” in this guide.</p>
</div>
<div class="paragraph">
<p>racfAttributes</p>
</div>
<div class="paragraph">
<p>The racfAttributes attribute triggers special processing in the RACF LDAP service and represents their result when reading. The following values related to activating / deactivating a RACF user are set by the connector. They are calculated in the mapping function configured for this attribute:</p>
</div>
<div class="paragraph">
<p>RESUME – set for unlocking a RACF user.</p>
</div>
<div class="paragraph">
<p>REVOKE – set for locking a RACF user. After successful processing, RACF sets the value REVOKED.</p>
</div>
<div class="paragraph">
<p>racfPassword</p>
</div>
<div class="paragraph">
<p>Make sure to set an initial password when the account is created in the DirX Identity target system and map it from dxmPassword to racfPassword.</p>
</div>
<div class="paragraph">
<p>When you observe the values PASSWORD or PROTECTED in the user’s racfAttributes in the RACF system, the typical reason is that the user has no password or an expired one. For more details on racfAttributes, see the IBM documentation, for example, <a href="https://www.ibm.com/docs/en/zos/2.5.0?topic=information-associating-ldap-attributes-racf-fields" class="bare">https://www.ibm.com/docs/en/zos/2.5.0?topic=information-associating-ldap-attributes-racf-fields</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groups_channel"><a class="anchor" href="#_groups_channel"></a>Groups Channel</h5>
<div class="paragraph">
<p>Note that the attributes <strong>racfSuperiorGroup</strong>, <strong>racfOwner</strong>, and <strong>racfSubGroupName</strong> are only read from the RACF system.</p>
</div>
<div class="paragraph">
<p>The <strong>racfid</strong> is used as identifier for groups in RACF and is stored in the DirX Identity target system group in the attribute racfid. Note that the racfid cannot have more than 8 characters.</p>
</div>
</div>
<div class="sect4">
<h5 id="_members_channel"><a class="anchor" href="#_members_channel"></a>Members Channel</h5>
<div class="paragraph">
<p>The members channel must be referenced from the accounts channel.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The attribute <strong>dxrPrimaryKey</strong> must be mapped to the identifier.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_setpassword_channel"><a class="anchor" href="#_setpassword_channel"></a>SetPassword Channel</h5>
<div class="paragraph">
<p>Password change operation</p>
</div>
<div class="paragraph">
<p>The old password must be part of the password change request because RACF does not allow resetting a password. After the password is set, the connector performs an extra bind operation with the RACF user and the old password to set the new password. The two passwords are delivered in one string, separated by a slash character, for example, <strong>oldpassword/newpassword</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_salesforce_workflows"><a class="anchor" href="#_salesforce_workflows"></a>Salesforce Workflows</h3>
<div class="paragraph">
<p>The Salesforce Provisioning workflows operate between a target system of type Salesforce in the Identity Store and the corresponding connected Salesforce system. The Salesforce connector uses the REST API, which provides a powerful, convenient and simple Web services API for interacting with the Salesforce system.</p>
</div>
<div class="paragraph">
<p>The Salesforce workflows handle the following Salesforce tables (note: in this section, <strong>SF</strong> indicates Salesforce objects and <strong>DXI</strong> indicates DirX Identity objects):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SF</strong> <strong>Account</strong> - the Salesforce accounts. This table represents an individual account, which is an organization or person involved with a business (such as customers, competitors, and partners) and holds a ContactID, which is the ID of the user who currently owns the account.</p>
</li>
<li>
<p><strong>SF</strong> <strong>Contact</strong> - the Salesforce contacts. This table represents a contact, which is a person associated with an account. It holds the following important attributes:</p>
</li>
<li>
<p><strong>ContactID</strong> - the ID of the account that’s the parent of this contact.</p>
</li>
<li>
<p><strong>OwnerID</strong> - the ID of the owner of the account associated with this contact.</p>
</li>
<li>
<p><strong>SF</strong> <strong>PermissionSet</strong> - the Salesforce permission sets. This table represents a set of permissions used to grant more access to one or more users without changing their profiles or reassigning profiles. (The Permission Set object is available in the SalesForce API version 22.0 and newer.)</p>
</li>
<li>
<p><strong>SF</strong> <strong>Profile</strong> - the Salesforce profiles. This table represents a profile, which defines a set of permissions to perform different operations, such as querying, adding, updating, or deleting information. It holds a <strong>UserLicenseId</strong>, which is the ID of the <strong>UserLicense</strong> associated with this profile.</p>
</li>
<li>
<p><strong>SF</strong> <strong>User</strong> - the Salesforce users in an organization. This table holds the following important attributes:</p>
</li>
<li>
<p><strong>AccountID</strong> - the ID of the account associated with a customer portal user. This field is null for Salesforce users.</p>
</li>
<li>
<p><strong>ContactID</strong> - the ID of the contact associated with this account. This field is null for Salesforce users.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Salesforce workflows synchronize a Salesforce user (with its profile/user license information and optionally one or more permission sets) to a target system account in DirX Identity and store the SF Profile and SF PermissionSets as target system groups.</p>
</div>
<div class="paragraph">
<p>Salesforce also supports the concept of community users, which are external users with access to a Salesforce community. These users require holding information about SF Contacts and SF Accounts. A community user uses one of the following user licenses: Customer_Community, Customer_Community_Login, Partner_Community, Partner_Community_Login. Salesforce stores community users in the same user table as other users. The only difference is the use of a few ProfileIds that are attached to these community user licenses. As a result, community users appear in the DirX Identity account tree of the target system.</p>
</div>
<div class="paragraph">
<p>SF Accounts are mapped to DXI Organizations. They should reside in the subfolder <strong>Business Objects/SalesforceAccounts</strong> to distinguish them from other organizations.</p>
</div>
<div class="paragraph">
<p>SF Contacts are mapped to DXI users. These users are assumed to be associated with organizations such as customers. Storing SF Contacts in the DirX Identity user tree makes them available to user relations and to delegated user management. Thus they can also be provisioned to other target systems. This design supports a global view compared to having everything in a target system. SF Contacts should reside in the subfolder <strong>Users/SalesforceContacts</strong> to distinguish them from internal users.</p>
</div>
<div class="paragraph">
<p>The following figure illustrates how DirX Identity represents the Salesforce object model:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image27.png" alt="DirX Identity - Salesforce Object Model">
</div>
<div class="title">Figure 28. DirX Identity - Salesforce Object Model</div>
</div>
<div class="paragraph">
<p>The figure shows the DirX Identity objects on the left and the Salesforce objects on the right. On the DirX Identity side:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The target system holds the DirX Identity accounts (which are SF users and SF (Community) users) and the DirX Identity groups (which are the SF Profiles and the SF Permission Sets).</p>
</li>
<li>
<p>Outside the target system are the DirX Identity business organizations for SF Accounts and the DirX Identity users (for SF Contacts).</p>
</li>
<li>
<p>The names enclosed in brackets (&lt; &gt;) represent DirX Identity objects. The names of objects that appear underneath the DirX Identity objects are the corresponding Salesforce objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On the Salesforce side:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SF users and the SF (Community) users are enclosed in a dashed-line box to indicate that "normal" users have no relationship to SF Account and SF Contacts whereas the SF (Community) users require the existence of an entry in the SF Account and in the SF Contact table.</p>
</li>
<li>
<p>The arrows represent the links between the tables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The delivered Salesforce workflows include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_Salesforce_Realtime</strong> - the synchronization workflow that exports detected changes for account and group objects from Identity Store to the Salesforce cloud and then validates the processed changes in Salesforce to the Identity Store. The workflow also generates a password if the object is created. When this workflow is triggered by a schedule or started directly in DirX Identity Manager, it also synchronizes the <strong>Users/SalesforceContacts</strong> and the <strong>Business Objects/SalesforceAccounts</strong> subtrees.</p>
</li>
<li>
<p><strong>Ident_Salesforce_SLSFAccounts_Realtime</strong> - the synchronization workflow that is triggered by an entry change event and exports detected changes for an object in the <strong>Business Objects/SalesforceAccounts</strong> subtree in Identity Store to the Salesforce cloud and then validates the processed changes in Salesforce to the Identity Store. Note that this workflow uses an entry change topic and therefore uses the following definition in the <strong>WhenApplicable</strong> section:</p>
<div class="ulist">
<ul>
<li>
<p>Topic Prefix: <strong>dxm.event.ebr</strong></p>
</li>
<li>
<p>Type: <strong>aSFOrganization</strong></p>
</li>
<li>
<p>Cluster; *</p>
</li>
<li>
<p>Domain: *</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This definition implies that an event policy for the object description <strong>aSFOrganization</strong> and the LDAP object class <strong>dxmSLSFaccount</strong> needs to be active.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_Salesforce_SLSFContacts_Realtime</strong> - the synchronization workflow that is triggered by an entry change event and exports detected changes for an object in the <strong>Users/SalesforceContacts</strong> subtree in Identity Store to the Salesforce cloud and then validates the processed changes in Salesforce to the Identity Store. Note that this workflow uses an entry change topic and therefore uses the following definition in the <strong>WhenApplicable</strong> section:</p>
<div class="ulist">
<ul>
<li>
<p>Topic Prefix: <strong>dxm.event.ebr</strong></p>
</li>
<li>
<p>Type: <strong>aSFContact</strong></p>
</li>
<li>
<p>Cluster; *</p>
</li>
<li>
<p>Domain: *</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This definition implies that an event policy for the object description <strong>aSFContact</strong> and the LDAP object class <strong>dxmSLSFcontactt</strong> needs to be active.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Validate_Salesforce_Realtime</strong> - the validation workflow that imports existing SF Accounts, SF Contacts, SF PermissionSets and SF Profiles from the Salesforce cloud to the Identity Store.</p>
</li>
<li>
<p><strong>SetPassword in Salesforce</strong> - the SetPassword workflow that synchronizes the user’s password to Salesforce when a password change in the Identity Store is detected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates the Salesforce Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image28.png" alt="Salesforce Provisioning Workflow Architecture">
</div>
<div class="title">Figure 29. Salesforce Provisioning Workflow Architecture</div>
</div>
<div class="paragraph">
<p>SF Profiles and SF PermissionSets are only administered in Salesforce directly. (One of the reasons for this is that SF PermissionSets are very complex objects with a huge variety of permission flags). As a result, you always need to start by running the <strong>Validate_Salesforce_Realtime</strong> workflow to make these objects available in the TS groups subtree.</p>
</div>
<div class="paragraph">
<p>Once these objects are available, you can fully administer the SF Accounts, SF Contacts and SF users directly in the Identity Store.</p>
</div>
<div class="paragraph">
<p>When creating new entries in DirX Identity, the (Salesforce) <strong>Id</strong> attribute of such an entry is not yet known; it is synchronized back from Salesforce to Identity and the object in Identity is renamed (because the <strong>Id</strong> is stored in the <strong>cn</strong> in Identity).</p>
</div>
<div class="paragraph">
<p>DirX Identity provisions both SF Profiles and SF Permission Sets as groups and stores them in the TS subtree <strong>groups &#8594; Profiles</strong> and <strong>groups &#8594; PermissionSets</strong>.</p>
</div>
<div class="paragraph">
<p>When you assign Salesforce groups to a user, you must assign exactly one group that is an SF Profile and optionally one or more SF PermissionSets.</p>
</div>
<div class="paragraph">
<p>SF Profiles and SF PermissionSets can be differentiated by the description attributes. SF Profiles are identified by the <strong>(PRF)</strong> prefix, for example:</p>
</div>
<div class="paragraph">
<p>(PRF): Chatter Free User; (UL): Chatter Free</p>
</div>
<div class="paragraph">
<p>Note that the substrings <strong>(UL)</strong> identify the underlying user license on which the SF Profile is based.</p>
</div>
<div class="paragraph">
<p>SF PermissionSets are identified by the <strong>(PERM)</strong> prefix; for example:<br></p>
</div>
<div class="exampleblock">
<div class="content">
(PERM): (PRF): Chatter Free User; (UL): Chatter Free<br>
(PERM): (PRF): -; (UL): -<br>
(PERM): (PRF): -; (UL): Salesforce
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The substring <strong>(PRF)</strong> identifies the SF Profile that is assigned to that SF PermissionSet. The <strong>(UL)</strong> prefix identifies the underlying user license on which the SF Profile is based.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>(PRF)</strong> and <strong>(UL)</strong> may be absent (represented by a hyphen (<strong>-</strong>), if the SF PermissionSet is not attached to an SF Profile. In this case, such permission sets can be used in addition to any SF profile.</p>
</div>
<div class="paragraph">
<p>Keep in mind that the SF Profile and the SF PermissionSet profile definitions must match. If they do not, they are in conflict and can’t be assigned in parallel.</p>
</div>
<div class="sect3">
<h4 id="_salesforce_workflow_prerequisites_and_limitations"><a class="anchor" href="#_salesforce_workflow_prerequisites_and_limitations"></a>Salesforce Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>Before you can use the Salesforce workflows, you must perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create and register a Remote Access application in the Salesforce system, as described in "Registering the Remote Access Application".</p>
</li>
<li>
<p>Create the customer-specific attribute <strong>StatusInfo<em>c</strong> to manage the status of Salesforce user deletion, as described in "Creating the StatusInfo</em>c Attribute".</p>
</li>
<li>
<p>Extend the DirX Identity Store schema with Salesforce target system-specific attributes and object classes so that the workflows can store Salesforce-specific information in the Identity Store, as described in the section "Extending the Schema for the Target System Workflows".</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_registering_the_remote_access_application"><a class="anchor" href="#_registering_the_remote_access_application"></a>Registering the Remote Access Application</h5>
<div class="paragraph">
<p>The Salesforce connector acts as a remote application to the Salesforce system. As a result, you need to create a Remote Access application in the Salesforce system before you can use the Salesforce workflows. (For details, see <a href="https://developer.salesforce.com/page/Getting_Started_with_the_Force.com_REST_API" class="bare">https://developer.salesforce.com/page/Getting_Started_with_the_Force.com_REST_API</a>). To register the remote access application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log in to <strong>Salesforce.com</strong> with your (developer) account and then navigate to <strong>Setup</strong> &gt; <strong>Develop</strong> &gt; <strong>Remote</strong> <strong>Access</strong>.</p>
</li>
<li>
<p>In the <strong>Connected</strong> <strong>Apps</strong> section, click <strong>New</strong>. In the next dialog, enter the following items:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Connected</strong> <strong>App</strong> <strong>Name</strong>; for example, <strong>DirXIdentityConnector</strong></p>
</div>
<div class="paragraph">
<p><strong>API</strong> <strong>Name</strong>; for example, <strong>DirXIdentityConnector</strong></p>
</div>
<div class="paragraph">
<p><strong>Contact</strong> <strong>Email</strong> - your e-mail address</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In <strong>API</strong> <strong>(Enable OAuth Settings)</strong>, select <strong>Enable</strong> <strong>OAuth</strong> <strong>Settings</strong>. Enter the following items:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Callback</strong> <strong>URL</strong>; for example, <strong><a href="https://localhost:88123/REST-API/callback" class="bare">https://localhost:88123/REST-API/callback</a></strong></p>
</div>
<div class="paragraph">
<p><strong>Selected OAUth Scopes</strong> - select full access (<strong>full</strong>)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you click <strong>Save</strong>, you will see the following items in the <strong>API (Enable OAuth Settings)</strong> section:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Consumer</strong> <strong>Key</strong></p>
</div>
<div class="paragraph">
<p><strong>Consumer</strong> <strong>Secret</strong></p>
</div>
<div class="paragraph">
<p>Now your remote access application has been created. <strong>Consumer</strong> <strong>Key</strong> and <strong>Consumer</strong> <strong>Secret</strong> must be provided in the connected directory for Salesforce as described in "Configuring the Salesforce Workflows".</p>
</div>
</div>
<div class="sect4">
<h5 id="_creating_the_statusinfo_c_attribute"><a class="anchor" href="#_creating_the_statusinfo_c_attribute"></a>Creating the StatusInfo__c Attribute</h5>
<div class="paragraph">
<p>Salesforce users can’t be deleted. In the Salesforce system, each user has an IsActive attribute that is set to false if the user is deleted. Furthermore the workflow sets the customer specific attribute StatusInfo__c of the Salesforce user to DELETED. So there is another task before you can run the workflows. You have to create the customer specific attribute StatusInfo_c:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log in to <strong>Salesforce.com</strong> with your (developer) account and then navigate to <strong>Setup</strong> &gt; <strong>Build</strong> &gt; <strong>Customize</strong> &gt; <strong>Users</strong> &gt; <strong>Fields</strong>.</p>
</li>
<li>
<p>In the section User Custom Fields, click <strong>New</strong>. In the Data Type section, select <strong>Text</strong> and then click <strong>Next</strong>.</p>
</li>
<li>
<p>In <strong>Step 2. Enter the details</strong>, enter the following fields:</p>
<div class="ulist">
<ul>
<li>
<p>Field Label: StatusInfo</p>
</li>
<li>
<p>Length: 16</p>
</li>
<li>
<p>Field Name: StatusInfo</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and then click <strong>Next</strong>.</p>
</div>
</li>
<li>
<p>In <strong>Step 3. Establish field level security</strong>, select the <strong>Visible</strong> field and then click <strong>Next</strong>.</p>
</li>
<li>
<p>In <strong>Step 4. Add to page layouts</strong>, the <strong>Add</strong> field and <strong>User</strong> <strong>Layout</strong> should already be selected. If they are not selected, select them, and then click <strong>Save</strong>. You will see the User Custom Fields again and you will see the new attribute <strong>StatusInfo</strong> with its internal API name <strong>StatusInfo__c</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The internal name StatusInfo__c is used in the account-channel mapping and in the account-channel Export section as a filter. If you want to use another Salesforce attribute, you must change the account-channel mapping and the account-channel Export section.</p>
</div>
</div>
<div class="sect4">
<h5 id="_salesforce_workflow_limitations"><a class="anchor" href="#_salesforce_workflow_limitations"></a>Salesforce Workflow Limitations</h5>
<div class="paragraph">
<p>The following limitations apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Currently, only Salesforce users and profiles are synchronized.</p>
</li>
<li>
<p>A Salesforce user can only hold one value in the <strong>ProfileId</strong> attribute. Consequently, you can only assign one group (=Salesforce Profile) to a DirX Identity account.</p>
</li>
<li>
<p>Salesforce users can&#8217;t be deleted. In the Salesforce system, each user has an <strong>IsActive</strong> attribute that is set to <strong>false</strong> if the user is deleted. Furthermore the workflow sets the customer-specific attribute <strong>StatusInfo<em>c</strong> of the Salesforce user to DELETED, as described in "Creating the StatusInfo</em>c Attribute". When you remove a group from an Identity Store user, the account is normally disabled. At the account (which also received the state DISABLED), you normally no longer see the assigned group in the Member of tab.<br>
<br>
The Salesforce workflows have a different behavior concerning the deletion of groups. The <strong>ProfileId</strong> attribute (which represents the assigned group) can&#8217;t be deleted at the Salesforce user. Thus, when synchronizing back to the Identity Store, the <strong>ProfileId</strong> is still returned in the search result and so, when applying the mapping for the <strong>dxrGroupMemberDelete</strong> attribute, the value doesn&#8217;t change (will not be deleted). As a result, you will always see the group (<strong>ProfileId</strong>) with the state DELETE in the Member of tab of the account.</p>
</li>
<li>
<p>Salesforce profiles can&#8217;t be created/deleted using the Salesforce connector. As a result, you must run the <strong>Validate_Salesforce_Realtime</strong> workflow as the first action once you have set up your environment. When doing so, the Salesforce profiles are created as groups in the Identity Store. From now on, you can assign one of these groups to your Identity Store users.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_salesforce_workflows"><a class="anchor" href="#_configuring_the_salesforce_workflows"></a>Configuring the Salesforce Workflows</h4>
<div class="paragraph">
<p>To configure the connection to Salesforce:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <strong>IP</strong> <strong>Address</strong> in the Salesforce service object; for example, <strong>login.salesforce.com</strong>. Check the <strong>SSL</strong> flag. No <strong>Ports</strong> are required.</p>
</li>
<li>
<p>Set up the bind credentials of the connected directory that represents the Salesforce system. Use a Salesforce user with sufficient rights. Enter <strong>Name</strong>, <strong>Password</strong> and <strong>Security</strong> <strong>Token</strong> (which you normally receive as e-mail from Salesforce, if you registered for the first time or if you changed your password).</p>
</li>
<li>
<p>Set up the following items in your Salesforce connected directory (in the Salesforce tab):</p>
</li>
<li>
<p><strong>URL-Suffixes</strong>:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For connecting to the Salesforce system using OAuth, enter:</p>
</div>
<div class="paragraph">
<p><strong>/services/oauth2/token</strong></p>
</div>
<div class="paragraph">
<p>For performing search and updates requests, enter the Salesforce API version you want to use. For example:</p>
</div>
<div class="paragraph">
<p><strong>/services/data/v30.0</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Consumer</strong> <strong>Key</strong> - enter the consumer key of your remote access application.</p>
</li>
<li>
<p><strong>Consumer</strong> <strong>Secret</strong> - enter the consumer secret of your remote access application.</p>
</li>
<li>
<p>Set up the following items in your Salesforce connected directory, if required (in the HTTP/HTTPS Proxy Server tab):</p>
</li>
<li>
<p>In <strong>Proxy</strong> <strong>Server</strong>, the link to the proxy server modeled as a connected directory object.</p>
</li>
<li>
<p>In <strong>Proxy</strong> <strong>Server</strong> <strong>Bind</strong> <strong>Profile</strong>, the link to the bind profile used by the proxy server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the Salesforce workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the schema extensions required by the Salesforce workflows as described in the section "Extending the Schema for the Target System Workflows", selecting the <strong>Salesforce</strong> extensions.</p>
</li>
<li>
<p>Assign the resource family <strong>Salesforce</strong> in the IdS-J server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_salesforce_target_system"><a class="anchor" href="#_configuring_the_salesforce_target_system"></a>Configuring the Salesforce Target System</h4>
<div class="paragraph">
<p>The Salesforce target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accounts - all accounts (Salesforce users) are located in a subfolder <strong>Accounts</strong>.</p>
</li>
<li>
<p>Groups - all groups (Salesforce profiles) are located in a subfolder <strong>Groups</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_salesforce_workflow_and_activities"><a class="anchor" href="#_salesforce_workflow_and_activities"></a>Salesforce Workflow and Activities</h4>
<div class="paragraph">
<p>The Salesforce users and profiles are synchronized via a pair of channels (one channel per direction). The membership in Identity (Salesforce attribute ProfileId) is stored on accounts. See the default Salesforce workflow for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_salesforce_workflow_ports"><a class="anchor" href="#_salesforce_workflow_ports"></a>Salesforce Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the Salesforce workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF -</strong> <strong>Crypt</strong> <strong>Filter</strong><br>
A Salesforce crypt filter is implicitly configured. It is used to send the decrypted password attribute Password to the Salesforce system.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_account_channel_mapping_for_sf_users"><a class="anchor" href="#_account_channel_mapping_for_sf_users"></a>Account-Channel Mapping for SF Users</h4>
<div class="paragraph">
<p>In the Account channel mapping, many LDAP attributes are mapped one-to-one to Salesforce attributes. The following attributes receive special handling:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EmailEncodingKey, LanguageLocaleKey, LocaleSidKey, TimeZoneKey - these mandatory attributes are generated via a Java Source mapping, but only for an ADD operation. The attributes are not stored in the Identity Store. In the Java Source mapping, either the LDAP attribute <strong>language</strong> or <strong>c</strong> is evaluated.</p>
</li>
<li>
<p>Password - remember that the account’s password is inherited from the user object in Identity Store when you assign a group (=Salesforce profile) to a user (and then implicitly the account is created). If no password is present at the user, the account’s password is initially set to <strong>dirxdirx1</strong>. Check to make sure that the passwords comply with the password policies in effect for the Salesforce system. If the default password <strong>dirxdirx1</strong> is not useful for your purposes, you need to change the object description for Salesforce (cn=TSAccount.xml,cn=Object Descriptions,cn=Salesforce,cn=TargetSystems,cn=Configuration,cn=&lt;domain&gt;).</p>
</li>
<li>
<p>Email - the <strong>Email</strong> attribute in the Salesforce system is a single-valued attribute; in the Identity Store, the corresponding LDAP <strong>mail</strong> attribute is a recurring attribute. As a result, the Java Source mapping operates as follows:</p>
</li>
<li>
<p>If the attribute is not yet set in the Salesforce system, the value of <strong>mail</strong> that fits best with the attribute <strong>dxrName</strong> is mapped to <strong>Email</strong>. (remember that the <strong>Username</strong> attribute in Salesforce is derived from <strong>dxrName</strong> in the Identity Store, and that <strong>Username</strong> and <strong>Email</strong> in the Salesforce system normally appear to be similar or are even the same.).If none of the values of <strong>mail</strong> matches with <strong>dxrName</strong>, the first value of <strong>mail</strong> is mapped to <strong>Email</strong>.</p>
</li>
<li>
<p>If the value of <strong>Email</strong> is already set in the Salesforce system, this value is retained "as is" if it is available in the <strong>mail</strong> attribute in the Identity Store.</p>
</li>
<li>
<p>If the value of <strong>Email</strong> in the Salesforce system is completely different from the values of <strong>mail</strong> in the Identity Store, the value is generated as if it was not yet set in the Salesforce system.</p>
</li>
<li>
<p>Phone - the <strong>Phone</strong> attribute in the Salesforce system is a single-valued attribute; in the Identity Store, the corresponding LDAP attruibute <strong>telephoneNumber</strong> is a recurring attribute. As a result, the Java Source mapping operates as follows:</p>
</li>
<li>
<p>If the attribute is not yet set in the Salesforce system, the first value of <strong>telephoneNumber</strong> is mapped to <strong>Phone</strong>.</p>
</li>
<li>
<p>If the value of Phone is already set in the Salesforce system, this value is retaiined "as is" if it is available in the <strong>telephoneNumber</strong> attribute in the Identity Store.</p>
</li>
<li>
<p>If the attribute value of <strong>Phone</strong> in the Salesforce system is completely different from the values of <strong>telephoneNumber</strong> in the Identity Store, the first value of <strong>telephoneNumber</strong> is mapped to <strong>Phone</strong>.</p>
</li>
<li>
<p>StatusInfo<em>c - the customer-specific attribute <strong>StatusInfo</em>c</strong> is set to DELETED if the corresponding <strong>dxrState</strong> attribute in the Identity Store is set to DISABLED or DELETED.</p>
</li>
<li>
<p>IsActive - the <strong>IsActive</strong> attribute is set to <strong>true</strong> if the corresponding dxrState attribute in the Identity Store is set to DISABLED or DELETED.</p>
</li>
<li>
<p>When a new account is created by assigning a Salesforce group to a user in Identity Store.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_group_channel_mapping_for_sf_permissionsets"><a class="anchor" href="#_group_channel_mapping_for_sf_permissionsets"></a>Group-Channel Mapping for SF PermissionSets</h4>
<div class="paragraph">
<p>Mappings are defined for the Salesforce attributes <strong>Name</strong>, <strong>Description</strong>, <strong>LicenseId</strong> and <strong>ProfileId</strong>. However, because SF PermissionSets cannot be added, modified or deleted, you should avoid making changes to the groups in Identity Store. (Note that these mappings are only present to define the set of attributes that is read when synchronizing from Salesforce to Identity Store.) Make the changes in Salesforce and then run the <strong>Validate_Salesforce_Realtime</strong> workflow to update the groups in the Identity Store.</p>
</div>
<div class="paragraph">
<p>Many attributes are simply mapped one to one or comparable attribute names are mapped (for example, <strong>Name</strong> to <strong>cn</strong>).</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of groups contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the Salesforce profile objects. The <strong>dxrName</strong> attribute contains the Salesforce <strong>Name</strong> attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="_group_channel_mapping_for_sf_profiles"><a class="anchor" href="#_group_channel_mapping_for_sf_profiles"></a>Group-Channel Mapping for SF Profiles</h4>
<div class="paragraph">
<p>Mappings are defined for the Salesforce attributes <strong>Name</strong>, <strong>Description</strong>, <strong>UserLicenseId</strong> and <strong>UserType</strong>. However, because Salesforce profiles cannot be added, modified or deleted, you should avoid making changes to the groups in Identity Store. (Note that these mappings are only present to define the set of attributes that is read when synchronizing from Salesforce to Identity Store.) Make the changes in Salesforce and then run the <strong>Validate_Salesforce_Realtime</strong> workflow to update the groups in the Identity Store.</p>
</div>
<div class="paragraph">
<p>Many attributes are simply mapped one to one or comparable attribute names are mapped (for example, <strong>Name</strong> to <strong>cn</strong>).</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of groups contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the Salesforce profile objects. The <strong>dxrName</strong> attribute contains the Salesforce <strong>Name</strong> attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="_channel_mapping_for_sf_accounts"><a class="anchor" href="#_channel_mapping_for_sf_accounts"></a>Channel Mapping for SF Accounts</h4>
<div class="paragraph">
<p>Mappings are defined for the Salesforce attributes <strong>Name</strong>, <strong>Description</strong>, <strong>LicenseId</strong> and <strong>ProfileId</strong>. However, because SF PermissionSets cannot be added, modified or deleted, you should avoid making changes to the groups in Identity Store. (Note that these mappings are only present to define the set of attributes that is read when synchronizing from Salesforce to Identity Store.) Make the changes in Salesforce and then run the <strong>Validate_Salesforce_Realtime</strong> workflow to update the groups in the Identity Store.</p>
</div>
<div class="paragraph">
<p>Many attributes are simply mapped one to one or comparable attribute names are mapped (for example, <strong>Name</strong> to <strong>cn</strong>).</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of SF Accounts contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the SF Accounts objects. The <strong>dxrName</strong> attribute contains the Salesforce <strong>Name</strong> attribute.</p>
</div>
<div class="paragraph">
<p>When creating an SF Account in Identity Store, take the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the attribute “Provision To Salesforce”; if it is not set, the SF Account is not synchronized to Salesforce.</p>
</li>
<li>
<p>Assign an “Owner” in the “Owner Information” section; note that the “Owner Id” is automatically set when assigning the “Owner”.</p>
</li>
<li>
<p>Set additional attributes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the BO organization in Identity Store that you just created is renamed by the workflow and the <strong>cn</strong> then holds the <strong>id</strong> attribute of the new SF Account in Salesforce.</p>
</div>
</div>
<div class="sect3">
<h4 id="_channel_mapping_for_sf_contacts"><a class="anchor" href="#_channel_mapping_for_sf_contacts"></a>Channel Mapping for SF Contacts</h4>
<div class="paragraph">
<p>Many attributes are simply mapped one to one or comparable attribute names are mapped (for example, <strong>dxmSLSFwebSite</strong> to <strong>cn</strong>).</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the SF Contact objects. The <strong>dxrName</strong> attribute contains the <strong>Salesforce</strong> <strong>Name</strong> attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="_member_channel_mapping_for_sf_users"><a class="anchor" href="#_member_channel_mapping_for_sf_users"></a>Member-Channel Mapping for SF Users</h4>
<div class="paragraph">
<p>The member channel mapping for <strong>PermissionSetId</strong> (which contains both the Ids for the SF Profile and the SF PermissionSets) sets the attribute <strong>ProfileId</strong> in Salesforce when assigning groups to a user in Identity Store. It also creates/updates/removes the internal Salesforce Permission Set assignment.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setpassword_channel_mapping_for_sf_users"><a class="anchor" href="#_setpassword_channel_mapping_for_sf_users"></a>SetPassword-Channel Mapping for SF Users</h4>
<div class="paragraph">
<p>Password changes in the Identity Store (in the LDAP attribute <strong>dxmPassword</strong>) are transferred as a modification of the pseudo-attribute <strong>Password</strong>. An additional modification request is also sent to the Salesforce system to reset the user’s password.</p>
</div>
<div class="paragraph">
<p>When you subsequently log in to Salesforce, the system asks you to enter a security question with its answer. On this Web page, you need to enter the new password (and the security question/answer); but you don’t need to change the password again.</p>
</div>
</div>
<div class="sect3">
<h4 id="_account_channel_mapping_for_identity_store_accounts"><a class="anchor" href="#_account_channel_mapping_for_identity_store_accounts"></a>Account-Channel Mapping for Identity Store Accounts</h4>
<div class="paragraph">
<p>Many attributes are simply mapped one-to-one or comparable attribute names are mapped (for example, <strong>CompanyName</strong> to <strong>o</strong>).</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of accounts contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the Salesforce user object. The attribute <strong>dxrName</strong> contains the Salesforce <strong>Username</strong>.</p>
</div>
<div class="paragraph">
<p>Remember, too, that for most of the attributes, the <strong>onAddOnly</strong> flag is set in the mapping because the assumption is that the Identity Store holds the master data and thus the Identity Store will never be overwritten with updates from Salesforce.</p>
</div>
</div>
<div class="sect3">
<h4 id="_group_channel_mapping_for_identity_store_profiles"><a class="anchor" href="#_group_channel_mapping_for_identity_store_profiles"></a>Group-Channel Mapping for Identity Store Profiles</h4>
<div class="paragraph">
<p>Many attributes are simply mapped one-to-one or comparable attribute names are mapped (for example, <strong>UserLicenseId</strong> to <strong>dxmSLSFuserLicenseId</strong>).</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of accounts contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the SF Profile object. The attribute <strong>dxrName</strong> contains the Salesforce <strong>Name</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_group_channel_mapping_for_identity_store_permissionsets"><a class="anchor" href="#_group_channel_mapping_for_identity_store_permissionsets"></a>Group-Channel Mapping for Identity Store PermissionSets</h4>
<div class="paragraph">
<p>Many attributes are simply mapped one-to-one or comparable attribute names are mapped (for example, <strong>LicenseId</strong> to <strong>dxmSLSFuserLicenseId</strong>).</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of accounts contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the SF PermissionSet object. The attribute <strong>dxrName</strong> contains the Salesforce <strong>Name</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_channel_mapping_for_identity_store_organizations_sf_accounts"><a class="anchor" href="#_channel_mapping_for_identity_store_organizations_sf_accounts"></a>Channel Mapping for Identity Store Organizations (SF Accounts)</h4>
<div class="paragraph">
<p>Many attributes are simply mapped one-to-one or comparable attribute names are mapped (for example, <strong>Fax</strong> to <strong>facsimileTelephoneNumber</strong>). Note that the schema maps the Salesforce attributes to attributes in the Identity Store using the same name and the prefix <strong>dxmSLSF</strong>; for example, <strong>Site</strong> is mapped to <strong>dxmSLSFsite</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the SF Account object. The attribute <strong>dxrName</strong> contains the Salesforce <strong>Name</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_channel_mapping_for_identity_store_users_sf_contacts"><a class="anchor" href="#_channel_mapping_for_identity_store_users_sf_contacts"></a>Channel Mapping for Identity Store Users (SF Contacts)</h4>
<div class="paragraph">
<p>Many attributes are simply mapped one-to-one or comparable attribute names are mapped (for example, <strong>MobilePhone</strong> to <strong>mobile</strong>). Note that the schema maps the Salesforce attributes to attributes in the Identity Store using the same name and the prefix <strong>dxmSLSF</strong>; for example, <strong>OtherPhone</strong> is mapped to <strong>dxmSLSFotherPhone</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute contains the identifier (the <strong>Id</strong> attribute in Salesforce) of the SF Contact object. The attribute <strong>dxrName</strong> contains the Salesforce <strong>Name</strong>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sap_ecc_r3_um_workflows"><a class="anchor" href="#_sap_ecc_r3_um_workflows"></a>SAP ECC (R/3) UM Workflows</h3>
<div class="paragraph">
<p>The SAP ECC (formerly R/3) UM Provisioning workflows synchronize data between a target system of type SAPR3UM in the Identity Store and the corresponding connected SAP ECC system. In the following sections, R/3 is synonymous with ECC.</p>
</div>
<div class="paragraph">
<p>The SAP R/3 UM connector used in the workflows communicates with the SAP R/3 system across the SAP Java connector JCo.</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the SAP R/3 UM workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image29.png" alt="SAP R/3 UM Workflow Architecture">
</div>
<div class="title">Figure 30. SAP R/3 UM Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The validation, synchronization and password workflows allow you to synchronize DirX Identity account and group objects with SAP R/3 user, role and profile objects.</p>
</div>
<div class="sect3">
<h4 id="_sap_r3_um_workflow_prerequisites_and_limitations"><a class="anchor" href="#_sap_r3_um_workflow_prerequisites_and_limitations"></a>SAP R/3 UM Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The SAP R/3 UM workflows have the following prerequisites and limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SAP Java Connector JCo must be installed on the machine where the SAP R/3 UM connector runs. It can be downloaded free of charge from the SAP Web pages.</p>
</li>
<li>
<p>Roles and profiles are not allowed to be created in SAP R/3 by the underlying SAP BAPI interfaces, so the synchronization workflows can only modify user-SAP role or user-SAP profile assignments.</p>
</li>
<li>
<p>Before you can use the workflows, you must extend the DirX Identity Store schema with SAP R/3 UM target system-specific attributes and object classes so that the workflows can store SAP R/3 UM-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows".</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_sap_r3_um_target_system"><a class="anchor" href="#_configuring_the_sap_r3_um_target_system"></a>Configuring the SAP R/3 UM Target System</h4>
<div class="paragraph">
<p>This section provides information about SAP R/3 UM target system configuration.</p>
</div>
<div class="paragraph">
<p>Connectivity View</p>
</div>
<div class="paragraph">
<p>Configure the SAPR3UM connected directory with the connected directory configuration wizard from the Global View target real-time scenario. You are guided through the steps. The main configuration tasks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the IP address or host name of the SAP R/3 UM service object (SAP application server).</p>
</li>
<li>
<p>Specify username and password in the bind profile.</p>
</li>
<li>
<p>Specify account and group base of the target system in provisioning.</p>
</li>
<li>
<p>Specify the values on the parameters page, mainly client Id, system number and whether you work with a CUA enabled system or not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Provisioning View</p>
</div>
<div class="paragraph">
<p>When creating the account, the attribute <strong>dxrName</strong> is created with a target system-wide unique value. You can see this in the <strong>tsaccount.xml</strong> object description. Also the attribute <strong>sapUsername</strong> is filled with this value. <strong>sapUsername</strong> is used for generating the identifier passed to the SAP R/3 connector when synchronizing the account to the SAP R/3 connected system. In the DirX Identity direction, the <strong>dxrName</strong> attribute is used for joining.</p>
</div>
<div class="paragraph">
<p>In the SAP R/3 UM target system, the members are referenced from the account objects. The reference attribute is the <strong>cn</strong> attribute of the groups. Also in the connected SAP R/3 system the memberships are held by the accounts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sap_r3_um_workflow_and_activities"><a class="anchor" href="#_sap_r3_um_workflow_and_activities"></a>SAP R/3 UM Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image30.png" alt="SAP R/3 UM Workflow Channels and Objects">
</div>
<div class="title">Figure 31. SAP R/3 UM Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>As the figure shows, there is a pair of channels between accounts, groups and members on each side. The members are linked to the accounts on both sides, so there is no cross channel relationship.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sap_r3_um_workflow_ports"><a class="anchor" href="#_sap_r3_um_workflow_ports"></a>SAP R/3 UM Workflow Ports</h4>
<div class="paragraph">
<p>This section describes SAP R/3 UM workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
The configured crypt filter is used to send the password attribute PASSWORD.BAPIPWD decrypted to the SAP R/3 system.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sap_r3_um_workflow_channels"><a class="anchor" href="#_sap_r3_um_workflow_channels"></a>SAP R/3 UM Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about SAP R/3 UM workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_common_aspects_5"><a class="anchor" href="#_common_aspects_5"></a>Common Aspects</h5>
<div class="paragraph">
<p>Master attributes</p>
</div>
<div class="paragraph">
<p>Almost all attributes except a few special ones like dxrTSState are mastered by DirX Identity. Consequently, in the mapping direction to DirX Identity, these attributes have set the <strong>OnAddOnly</strong> flag and in the target system direction this flag is not set.</p>
</div>
<div class="paragraph">
<p>However, some attributes cannot be changed for single users through the mapping. Those attributes, for example ADDRESS.STREET, are linked to an extra table for a certain group of users, where they are set by the SAP R/3 administrator.</p>
</div>
<div class="paragraph">
<p>CUA- or non CUA system</p>
</div>
<div class="paragraph">
<p>The workflow does not need to be adapted depending on whether or not the connected system is a CUA (Central User Administration) system. The workflow mappings and post-mappings handle the difference transparently.</p>
</div>
</div>
<div class="sect4">
<h5 id="_accounts_3"><a class="anchor" href="#_accounts_3"></a>Accounts</h5>
<div class="paragraph">
<p>Direction: Identity &#8594; Connected System</p>
</div>
<div class="paragraph">
<p>The attribute <strong>dxrTSState</strong> is a pseudo attribute of the SAP R/3 connector. That is it is not passed to the SAP R/3 system as an attribute, but is interpreted by the connector, which performs the corresponding actions depending on the values <strong>ENABLED</strong>, <strong>DISABLED</strong> or <strong>DELETED</strong>.</p>
</div>
<div class="paragraph">
<p>Direction: Connected System &#8594; Identity</p>
</div>
<div class="paragraph">
<p>The attributes <strong>ISLOCKED.LOCAL_LOCK</strong> and <strong>ISLOCKED.GLOB_LOCK</strong>, which are set depending on whether a CUA or non-CUA system is connected, are read from the SAP R/3 connected system and converted by the <strong>dxrTSState</strong> Java mapping to the corresponding states in DirX Identity.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groups_3"><a class="anchor" href="#_groups_3"></a>Groups</h5>
<div class="paragraph">
<p>Direction: Identity &#8594; Connected System</p>
</div>
<div class="paragraph">
<p>The group mapping only results in modifications to the corresponding role in SAP R/3 because roles and profiles are not allowed to be created in SAP R/3 via an interface. Add operations are rejected by the SAP R/3 connector.</p>
</div>
<div class="paragraph">
<p>Direction: Connected System &#8594; Identity</p>
</div>
<div class="paragraph">
<p>The mapping, the export filters and the join filters of the group channels are configured to synchronize SAP R/3 roles - not profiles - to Identity groups.</p>
</div>
</div>
<div class="sect4">
<h5 id="_memberships"><a class="anchor" href="#_memberships"></a>Memberships</h5>
<div class="paragraph">
<p>In both systems, DirX Identity and SAP R/3, accounts hold the memberships. Therefore, no cross-channel relationship is required.</p>
</div>
<div class="paragraph">
<p>Direction: Identity &#8594; Connected System</p>
</div>
<div class="paragraph">
<p>Post-Mapping</p>
</div>
<div class="paragraph">
<p>If a non-CUA system is connected, the target attribute <strong>ACTIVITYGROUPS.AGR_NAME</strong> must be mapped. If a CUA system is connected, the attribute <strong>dxrRole.NAME</strong> must be set. This action is handled in the Java PostMapping, which must have access to both attributes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_password_channel_7"><a class="anchor" href="#_password_channel_7"></a>Password Channel</h5>
<div class="paragraph">
<p>The target systems password attribute <strong>PASSWORD.BAPIPWD</strong> is updated with the current password of the account in DirX Identity contained in the attribute <strong>dxmPassword</strong>. The <strong>dxrPwdReset</strong> attribute of the SAP R/3 connector, which determines whether the user must change the password on the next login, is set depending on the source attribute <strong>dxmPasswordExpired</strong>. This attribute was set beforehand by the Password Event Manager workflow listening for requests of Web Center or Password Listener.</p>
</div>
<div class="paragraph">
<p>A Password Channel can also be configured backwards from the Connected System to Identity to be able to update some attributes in Identity after a password change or reset has taken place in the Connected System. The join engine then as usual synchronizes the attributes specified in the corresponding Password Channel Mapping to Identity after the account with its password relevant attributes was updated in the Connected System.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_sap_r3_um_workflows"><a class="anchor" href="#_customizing_the_sap_r3_um_workflows"></a>Customizing the SAP R/3 UM Workflows</h4>
<div class="paragraph">
<p>The workflows can be customized to synchronize SAP R/3 profiles instead of SAP R/3 roles. To make this customization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up a corresponding object structure on the Identity side.</p>
</li>
<li>
<p>Specify the prefix "PROFILE:" instead of "ROLE:" in the workflows export filter and identifier mapping of the group channel.</p>
</li>
<li>
<p>Specify the corresponding member attributes in the membership mapping.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_management_workflows"><a class="anchor" href="#_service_management_workflows"></a>Service Management Workflows</h3>
<div class="paragraph">
<p>The Service Management Provisioning workflows operate between a target system of type <strong>RequestWorkflow</strong> in the Identity Store and the external offline system. Instead of direct provisioning, the Java-based workflows start a corresponding request workflow instance for each provisioning action via the DirX Identity Request Workflow Services. This model assumes that there is an acting administrator who receives tasks via request workflow approval activities. He performs manual provisioning and then approves the task.</p>
</div>
<div class="paragraph">
<p>For more information about manual provisioning, read the corresponding section in the <em>DirX Identity Use Case Document</em> "DXI Service Management".</p>
</div>
<div class="paragraph">
<p>The workflows handle these common objects:</p>
</div>
<div class="paragraph">
<p><strong>Account</strong> - the account represents a common account in a target system. It represents any account-like object in the real (offline) system.</p>
</div>
<div class="paragraph">
<p><strong>Group</strong> - the group represents a common group in a target system. It represents any group-like object in the real (offline) system.</p>
</div>
<div class="paragraph">
<p>The delivered workflows are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_SvcMgmt_Realtime</strong> - the synchronization one-way workflow that exports detected changes for account or group objects from DirX Identity to the Workflow Service, which creates the appropriate request workflow instances.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_service_management_workflow_prerequisites_and_limitations"><a class="anchor" href="#_service_management_workflow_prerequisites_and_limitations"></a>Service Management Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Connectivity workflow does not update the entries in the external offline system directly. It only invokes a special request workflow that contains tasks for a human administrator. This means that there is no direct provisioning to the offline system.</p>
</div>
<div class="paragraph">
<p>In this scenario, password management does not make sense because the administrator would see all user passwords.</p>
</div>
<div class="paragraph">
<p>The scenario does not comprise initial load or validation workflows. Such workflows must be built as project-specific solutions; for example, via files.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_service_management_workflows"><a class="anchor" href="#_configuring_service_management_workflows"></a>Configuring Service Management Workflows</h4>
<div class="paragraph">
<p>To configure the Service Management workflows, use the connected directory and workflow wizards.</p>
</div>
<div class="paragraph">
<p>Connected Directory Wizard</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the connected directory wizard and open the <strong>Service</strong> object.</p>
</li>
<li>
<p>Specify the <strong>IP Address</strong> of the host where the DirX Identity Request Workflow Service runs. This is the Java-based Server that is configured for the domain.<br>
DirX Identity is typically configured to accept SOAP requests for request workflow management on the pre-configured unsecured port 40000 (and on the secured port 40443).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Workflow Wizard</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the workflow wizard.</p>
</li>
<li>
<p>Click the <strong>Join Activity General Info</strong> tab. Here you can configure the timing parameters for the join activity.</p>
</li>
<li>
<p>Click the <strong>Request Workflows Settings</strong> tab. Here you can configure the <strong>URL Path</strong> and <strong>Socket Timeout</strong> at the target system port of the appropriate workflow object.</p>
</li>
<li>
<p>The <strong>URL Path</strong> of the Workflow Service is pre-configured to the default value <strong>workflowService/services/WorkflowService</strong>. Do not change this setting.</p>
</li>
<li>
<p>Set the timeout value (in seconds) in <strong>Socket Timeout</strong> if necessary.</p>
</li>
<li>
<p>Enter LDAP name of the provisioning domain into the optional <strong>Domain</strong> property. It enables the Java-based Server to identify if the request is for the correct domain.</p>
</li>
<li>
<p><strong>Primary Workflow DN</strong> is the valid DN of the active request workflow definition, which will be used for handling the generated requests. The primary workflow will always be invoked for account objects if configured. It will also be used for group objects if the <strong>Secondary Workflow DN</strong> is not set. Secondary workflow can be configured only for handling the group objects. The secondary workflow configuration is valid only if the primary workflow is also configured. If both primary and secondary workflow configurations are not set, the Workflow Service will try to find a suitable request workflow definition according to its <strong>When Applicable</strong> settings. It is recommended to configure at least a primary workflow. Remember that using a single request workflow definition requires an implementation that can handle two different object types.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_service_management_target_system"><a class="anchor" href="#_configuring_the_service_management_target_system"></a>Configuring the Service Management Target System</h4>
<div class="paragraph">
<p>A service management target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - in the DirX Identity target system, a corresponding account object exists for every account in the external offline system. All accounts are located in the subfolder <strong>Accounts</strong>.</p>
</li>
<li>
<p><strong>Groups</strong> - in the DirX Identity target system, a corresponding group object exists for every group in the external offline system. All groups are located in the subfolder <strong>Groups</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The attribute <strong>dxrPrimaryKey</strong> has a special meaning. It stores the identification of the account or group object in the offline system. It is also a description that should be well-understood by an administrator performing the manual operation in the offline system. The slight modification of the object descriptions for account and group objects in the Provisioning configuration may be necessary in order to satisfy this goal.</p>
</div>
</div>
<div class="sect3">
<h4 id="_service_management_workflows_and_activities"><a class="anchor" href="#_service_management_workflows_and_activities"></a>Service Management Workflows and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the join activity:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image31.png" alt="Service Management Channels and Object Types">
</div>
<div class="title">Figure 32. Service Management Channels and Object Types</div>
</div>
<div class="paragraph">
<p>The service management account and group objects are synchronized via a pair of channels. Both channels use the same user hook implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_service_management_workflow_ports"><a class="anchor" href="#_service_management_workflow_ports"></a>Service Management Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the Service Management ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Crypt Filter</strong><br>
a service management filter is configured implicitly. It is pre-configured for custom usage only.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_service_management_workflow_channels"><a class="anchor" href="#_service_management_workflow_channels"></a>Service Management Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about Service Management Workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_common_aspects_6"><a class="anchor" href="#_common_aspects_6"></a>Common Aspects</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Service Management</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The workflow uses a special channel user hook implementation. The workflow gets the original SPMLv1 event along with tracked attribute changes initiated by the saved change of an account or a group object. Add or delete events are directly transformed to add or delete types of the mapped SPMLv1 request. A modify event can be transformed to a delete type if the tracked event modifications contain the change of the dxrState attribute with the added value "<strong>DELETED</strong>". Add and modify events always contain a list of changed attributes.<br>
<br>
These event attributes are taken and compared with the list of mapped attributes (channel configuration). The result contains the intersection of the attribute names contained in the event and in the mapped entry. If such an intersection is empty, no request is propagated. The generated request always contains the attribute values taken from the corresponding mapped attribute. Attribute values contained in the event are ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Service Management &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The workflow uses the one-way synchronization controller. Therefore no direct updates are possible.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_account_2"><a class="anchor" href="#_account_2"></a>Account</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Service Management</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>${source.id}</strong></p>
</li>
<li>
<p>Join: is not applicable since the connector always returns an empty result.</p>
</li>
<li>
<p>State attribute: <strong>dxrState</strong></p>
</li>
<li>
<p>The user hook handles the events along with the mapped entries; see "Common Aspects".</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_group_2"><a class="anchor" href="#_group_2"></a>Group</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Service Management</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>${source.id}</strong></p>
</li>
<li>
<p>Join: is not applicable since the connector always returns an empty result.</p>
</li>
<li>
<p>State attribute: <strong>dxrState</strong></p>
</li>
<li>
<p>The user hook handles the events along with the mapped entries; see "Common Aspects".</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sharepoint_workflows"><a class="anchor" href="#_sharepoint_workflows"></a>SharePoint Workflows</h3>
<div class="paragraph">
<p>The SharePoint Provisioning workflows provision groups and group memberships between a target system of type <strong>SharePoint</strong> in the Identity Store and the corresponding connected SharePoint system. Supported SharePoint systems are SharePoint Server 2007, SharePoint Server 2010, SharePoint Server 2013 and SharePoint Server 2016.</p>
</div>
<div class="paragraph">
<p>Microsoft introduced the claims-based identity model in SharePoint Server 2013. A claim is a piece of identity information, like name, email address, group membership or type of the identity. This model includes that SharePoint group memberships are kept in the form <em>claims-based identity prefixdomain_name\user_name</em>. For instructions on how to configure the SharePoint workflows and the SharePoint target system to correctly provision group memberships, see the sections "Configuring the SharePoint Target System" and "SharePoint Workflow Channels".</p>
</div>
<div class="paragraph">
<p>Because SharePoint uses the accounts from the Active Directory, a corresponding ADS workflow must be configured.</p>
</div>
<div class="paragraph">
<p>The SharePoint workflow&#8217;s join activity uses the LDAP connector to connect to the Identity Store and the SharePoint connector to connect to the SharePoint server.</p>
</div>
<div class="paragraph">
<p>Two default workflows are provided for DirX Identity SharePoint synchronization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_SharePoint_Realtime_Clustered</strong> - performs synchronization to SharePoint.</p>
</li>
<li>
<p><strong>Validate_SharePoint_Ident_Clustered</strong> - helps to validate the SharePoint connected system with the related DirX Identity target system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates the SharePoint Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image32.png" alt="SharePoint Provisioning Workflow Architecture">
</div>
<div class="title">Figure 33. SharePoint Provisioning Workflow Architecture</div>
</div>
<div class="paragraph">
<p>Data Structures</p>
</div>
<div class="paragraph">
<p>SharePoint is organized into sites. Each site has its own set of groups with a different set of access rights (called roles in SharePoint). SharePoint uses the Windows account names to identify users. Adding an account to a SharePoint group will grant the user the access rights that are attached to the group.</p>
</div>
<div class="paragraph">
<p>Each SharePoint site has its own bind credentials that are related to a bind account.</p>
</div>
<div class="paragraph">
<p>DirX Identity&#8217;s target system cluster feature is used to map this structure to DirX Identity. Each SharePoint site has its counterpart in a DirX Identity target system that is part of a common SharePoint cluster. The advantages of this approach are that only one workflow needs to be configured for use by all the clustered target systems and that clusters support a bind account mechanism. Each target system references one bind account that holds the credentials for the target system connection. This mechanism fits perfectly with the requirement of different bind credentials per site.</p>
</div>
<div class="paragraph">
<p>Since SharePoint uses the Windows Active Directory accounts, account objects are not held in the SharePoint target systems. Each SharePoint target system references the associated Active Directory target systems by a peer target system link.</p>
</div>
<div class="paragraph">
<p>In a group of an Identity SharePoint target system, the members are DN links to the user objects. Special SharePoint user hooks are added to the SharePoint workflows that transform user DNs to account names and vice-versa by evaluating the accounts in the linked peer target system related to the user by the <strong>dxrUserLink</strong> attribute.</p>
</div>
<div class="sect3">
<h4 id="_sharepoint_workflow_prerequisites_and_limitations"><a class="anchor" href="#_sharepoint_workflow_prerequisites_and_limitations"></a>SharePoint Workflow Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The SharePoint workflows have the following prerequisites and limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before you can use the workflows, you must extend the DirX Identity Store schema with SharePoint target system-specific attributes and object classes so that the workflows can store SharePoint-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows".</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_sharepoint_clusters_workflows_and_connection"><a class="anchor" href="#_configuring_the_sharepoint_clusters_workflows_and_connection"></a>Configuring the SharePoint Clusters, Workflows and Connection</h4>
<div class="paragraph">
<p>Configuring the SharePoint workflows consists of the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting up SharePoint clustered target systems</p>
</li>
<li>
<p>Setting up the SharePoint workflows</p>
</li>
<li>
<p>Setting up a SharePoint SSL connection</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_creating_clustered_sharepoint_target_systems"><a class="anchor" href="#_creating_clustered_sharepoint_target_systems"></a>Creating Clustered SharePoint Target Systems</h5>
<div class="paragraph">
<p>To set up a SharePoint cluster in the Identity Manager:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the <strong>Provisioning</strong> &#8594; <strong>Target System</strong> view.</p>
</li>
<li>
<p>Select <strong>New</strong> &#8594; <strong>Cluster Container</strong> at the top-level node and create a cluster container. For example, name it <strong>SharePoint</strong>.</p>
</li>
<li>
<p>Select this container, and then select <strong>New Cluster</strong> to create a cluster for your SharePoint server. For example, name it <strong>SharePointServer1</strong>. It shall contain all SharePoint sites as target systems.</p>
</li>
<li>
<p>Select the cluster object, and then select <strong>New Target System</strong> for each site. This action starts the Target System wizard. Note that the wizard does not create Java-based workflows because only one workflow is necessary for a SharePoint cluster (it handles all contained sites). To set up the synchronization and validation workflows, perform the procedure described in "Configuring SharePoint Workflows".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The result is a structure like this:</p>
</div>
<div class="exampleblock">
<div class="content">
<strong>SharePoint</strong><br>
<strong>SharePointServer1</strong><br>
Site1<br>
Site2<br>
&#8230;&#8203;<br>
<strong>SharePointServer2</strong><br>
Site1<br>
&#8230;&#8203;
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All target systems use a common configuration tree with common object descriptions. Thus, after you create the first target system, move the configuration container from the target system one level up. Now it is a child of the cluster and lies in parallel with the target system. If you add the next target system to the cluster, the configuration container is automatically omitted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following configuration steps must be performed at each SharePoint target system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong>General</strong> tab, add the links to the related peer target systems. These are the target systems containing the related active directory accounts.</p>
</li>
<li>
<p>In the <strong>Server Connection</strong> tab, enter the URL of the related SharePoint site.</p>
</li>
<li>
<p>In the <strong>Server Connection</strong> tab, edit the bind account. Click <strong>Edit</strong> and enter the bind credentials for the SharePoint site: <em>domain</em>**<em>loginname</em> (for example, *domain1\admin*) and password.</p>
</li>
<li>
<p>Save bind account and target system.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_sharepoint_workflows"><a class="anchor" href="#_configuring_sharepoint_workflows"></a>Configuring SharePoint Workflows</h5>
<div class="paragraph">
<p>If you don&#8217;t want to use the Target System wizard to create the SharePoint workflows, you can also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Identity Manager to copy the workflow to your scenario (<strong>Connectivity &#8594; Global View</strong>).</p>
</li>
<li>
<p>Select the copied workflow from the context menu of the workflow line, and then select <strong>Configure</strong>.</p>
</li>
<li>
<p>Check that the <strong>Is applicable for</strong> parameters section is set correctly (for the synchronization workflow only; leave the parameters empty for the validation workflow):</p>
</li>
<li>
<p><strong>Type</strong> - must be set to <strong>SharePoint</strong>.</p>
</li>
<li>
<p><strong>Cluster</strong> - should be set to the <strong>Cluster</strong> field value of the target system objects in your corresponding cluster (<strong>Advanced</strong> tab, Match properties).</p>
</li>
<li>
<p><strong>Domain</strong> - set this field to '*'. This action defines that this workflow runs for all target systems in your target system cluster, which means it runs for all sites in your SharePoint server.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_sharepoint_ssl_connections"><a class="anchor" href="#_configuring_sharepoint_ssl_connections"></a>Configuring SharePoint SSL Connections</h5>
<div class="paragraph">
<p>To create an SSL connection to SharePoint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a trust store (a keystore containing the certificate of the trusted root certification authority).</p>
</li>
<li>
<p>Configure SSL in DirX Identity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Creating the Trust Store</p>
</div>
<div class="paragraph">
<p>The trust store is a Java keystore that is created using the keytool supplied with the Java Runtime Environment. The certificate is obtained by exporting it from the Internet Explorer&#8217;s key store of trusted root certification authorities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Export the certificate as DER encoded binary X.509 (.CER) to file, for example, <strong>SharePointCa.cer</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a Java keystore containing this file, call the Java keytool with the following arguments:</p>
</div>
<div class="paragraph">
<p><strong>keytool -import -alias</strong> <em>alias</em> <strong>-storepass</strong> <em>password</em> <strong>-keystore</strong> <em>keystore_filename</em> <strong>-file</strong> <em>certificate_filename</em></p>
</div>
<div class="paragraph">
<p><em>alias</em> can be randomly chosen, and it must be unique if multiple certificates are stored in the keystore.</p>
</div>
<div class="paragraph">
<p><em>password</em> is the keystore password. It must be entered later on as the trustStorePassword in the DirX Identity target system configuration.</p>
</div>
<div class="paragraph">
<p><em>keystore_filename</em> is the keystore file name. It should have the extension .jks</p>
</div>
<div class="paragraph">
<p><em>certificate_filename</em> denotes the file containing the certificate, with the extension .cer</p>
</div>
<div class="paragraph">
<p>keytool asks if this certificate is trusted. You must answer "Yes" if you want to use this certificate.</p>
</div>
<div class="paragraph">
<p>Here is a sample call:</p>
</div>
<div class="exampleblock">
<div class="content">
<code>keytool -import -alias sharepoint -storepass changeme -keystore SharePointCaCerts.jks -file SharePointCa.cer</code>
</div>
</div>
<div class="paragraph">
<p>This call creates a keystore file <strong>SharePointCaCerts.jks</strong> containing the certificate exported in the first step. It is called a trust store since it contains certificates of trusted authorities.</p>
</div>
<div class="paragraph">
<p>Configuring SSL in DirX Identity</p>
</div>
<div class="paragraph">
<p>Select the DirX Identity target system and choose the <strong>Server Connection</strong> tab. Set the following parameters to set up SSL:</p>
</div>
<div class="paragraph">
<p><strong>Site URL</strong> - set the site URL beginning with <strong>https</strong> and using the secure port (by default, <strong>443</strong>). A sample structure of the URL is<br></p>
</div>
<div class="exampleblock">
<div class="content">
<code><strong>https://</strong><em>server</em><strong>:</strong><em>port</em><strong>/sites/</strong><em>site</em></code>
</div>
</div>
<div class="paragraph">
<p><strong>Path to Trust Store File</strong> - set the fully-qualified path name of the trust store file created in the preceding step.</p>
</div>
<div class="paragraph">
<p><strong>Trust Store Password</strong> - set the trust store password. Note that the password should be scrambled or RSA-encrypted.</p>
</div>
<div class="paragraph">
<p>You must then restart the Java-based Server to apply the changes.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_sharepoint_target_system"><a class="anchor" href="#_configuring_the_sharepoint_target_system"></a>Configuring the SharePoint Target System</h4>
<div class="paragraph">
<p>Users are not created in SharePoint but are taken from a peer target system. Note that the SharePoint user hook supports multiple peer target system links. If you set multiple links, all accounts a user has in the related target systems are enabled for the SharePoint site.</p>
</div>
<div class="paragraph">
<p>The next sections describe the settings of the target system in more detail.</p>
</div>
<div class="paragraph">
<p>Advanced Settings</p>
</div>
<div class="paragraph">
<p>The match properties Type, Cluster and Domain are part of the event topic that is sent when a group is changed. They are used to select the appropriate workflow and to identify the target system in the workflow:</p>
</div>
<div class="paragraph">
<p><strong>Type</strong> - must contain the fixed value SharePoint (do not change!).</p>
</div>
<div class="paragraph">
<p><strong>Cluster</strong> - should contain the name of your SharePoint server (can be a symbolic name).</p>
</div>
<div class="paragraph">
<p><strong>Domain</strong> - should contain the SharePoint site name.</p>
</div>
<div class="paragraph">
<p>The assignment properties should not be changed. You must check <strong>Enable Realtime Provisioning</strong> to start an event-based workflow for a group change. <strong>Disable Password Sync</strong> should be set because the accounts reside in the Active Directory domain.</p>
</div>
<div class="paragraph">
<p>Server Configuration</p>
</div>
<div class="paragraph">
<p>This tab allows setting the URL. It contains the host address and the port.<br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Normally SharePoint is accessed via port 80. In case of SSL, port 443 is used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reference to the bind account is entered here, holding the bind credentials for the related site. Note that the account’s dxrName attribute must contain <em>domain</em>*\account;* for example, <strong>domain1\admin</strong>. The password must be stored in the bind account’s dxmPassword attribute. To achieve this, you must change the <strong>userPassword</strong> attribute of the bind account in the Data View.</p>
</div>
<div class="paragraph">
<p>Connector Configuration</p>
</div>
<div class="paragraph">
<p>You can configure the following values for an optional proxy server:</p>
</div>
<div class="paragraph">
<p><strong>Host</strong> - host name of the proxy server (optional).</p>
</div>
<div class="paragraph">
<p><strong>Port</strong> - port of the proxy server (optional).</p>
</div>
<div class="paragraph">
<p><strong>User</strong> - user for proxy server authentication (optional).</p>
</div>
<div class="paragraph">
<p><strong>Password</strong> - password for proxy server authentication (optional).</p>
</div>
<div class="paragraph">
<p>You can configure the following values for the connector:</p>
</div>
<div class="paragraph">
<p><strong>User Name Prefix</strong> - is used in sites whose members follow the syntax <em>prefixaccount_name</em>.<br>
For example the prefix <strong>ptdssomember:</strong> is used for sites with member syntax <strong>ptdssomember:*<em>account_name</em>. Note that you must configure an empty *domainnameattribute</strong> at the connected directory of those sites.</p>
</div>
<div class="paragraph">
<p><strong>Search Groups from Site Collection</strong> - a Boolean flag indicating that the groups must be searched from the site collection rather than from the specified (sub)site.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the subsite on your SharePoint server was created with inheriting the site collection (parent site) permissions, the groups created in this subsite are part of the site collection and are only contained in the search result for the subsite if this flag is set. If the subsite to be provisioned was created with unique permissions, this flag must not be set (default) if only the subsite&#8217;s groups are to be provisioned and not all site collection groups including those of subsites with inherited permissions, too.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Debugging trace file:</p>
</div>
<div class="paragraph">
<p><strong>Trace File</strong> - a path and filename for the request. This file is useful in debugging mode to inspect the SPML requests towards the connector and the corresponding responses. Once the workflows become productive, delete or rename the option to prevent writing to the trace file.</p>
</div>
<div class="paragraph">
<p>Environment Properties</p>
</div>
<div class="paragraph">
<p>You can configure the following values:</p>
</div>
<div class="paragraph">
<p><strong>Domain\Userloginname</strong> - a valid default user login name for a new group.. A user name in SharePoint versions before SharePoint Server 2013 is presented in the form <em>domain</em>**<em>account</em>. From SharePoint Server 2013 on, a user name is presented in the form of a claims-based identity type prefix (for a Windows claims identity type, the prefix is *i:0#.w|*) followed by <em>domain</em>*\*<em>account</em>. If this default_userloginname is set, it is used as the defaultUserLoginName when a new group is created in SharePoint. If it is left empty, the group&#8217;s default userloginname is populated from the user provided with the bind account.</p>
</div>
<div class="paragraph">
<p><strong>Default Owner &#8594; Owner</strong> - the default owner, if a group&#8217;s owner attribute on the DirX Identity side is not populated. The SharePoint attribute <strong>ownerIdentifier</strong> is mandatory for creating a group in SharePoint. The owner type, whose default value can be set in the environment property <strong>default_owner_type</strong>, must be either User or Group. If the owner type is User, the value for the default owner must be a valid username in the syntax <em>domain</em>**<em>account</em> or <em>claims_based_prefixdomain</em>*\*<em>account</em> depending on the SharePoint Server version as described in Domain\Userloginname. If the owner type is Group, the default owner must be the name of a group in the same SharePoint site..</p>
</div>
<div class="paragraph">
<p><strong>Default Owner &#8594; Owner Type</strong> - the default owner type. Allowed values are User and Group.</p>
</div>
<div class="paragraph">
<p><strong>Base DN</strong> (mandatory) - the base DN for groups in the current target system. This DN is used as a parent folder for the groups imported from the validation workflow. It is automatically set during save of the target system to the value *cn=Groups,*<em>dn of target system</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sharepoint_workflow_and_activities"><a class="anchor" href="#_sharepoint_workflow_and_activities"></a>SharePoint Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the SharePoint workflow&#8217;s join activity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image33.png" alt="SharePoint Provisioning Workflow Channels and Objects">
</div>
<div class="title">Figure 34. SharePoint Provisioning Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>DirX Identity supports these SharePoint workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_SharePoint_Realtime_Clustered</strong> - this workflow is a Java-based synchronization workflow. It can run either scheduled or event-based. Event-based means it is triggered by a group change in DirX Identity. Each modification of a group - for example, adding a new group, adding/removing a member to a group or changing the group owner - starts a workflow that propagates this change to SharePoint.<br>
Once the change is applied, it is propagated back to the group object in the DirX Identity target system, for example, to adjust the group’s state or other data.</p>
</li>
<li>
<p><strong>Validate_SharePoint_Ident_Clustered</strong> - this workflow is a scheduled validation workflow. It imports groups from SharePoint sites to the associated DirX Identity target systems and modifies the group’s members and other attributes according to the current group state.<br>
This workflow is used to perform an initial load of the DirX Identity SharePoint target systems and to keep the DirX Identity target systems in sync if changes are made in SharePoint (for example, groups are added or deleted).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sharepoint_workflow_ports"><a class="anchor" href="#_sharepoint_workflow_ports"></a>SharePoint Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the SharePoint workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="paragraph">
<p>The TS port references the SharePoint connected directory and its channels. The channels contain the mapping definitions for export of groups to SharePoint and the join definition for SharePoint.</p>
</div>
<div class="paragraph">
<p>IdentityDomain Port</p>
</div>
<div class="paragraph">
<p>The IdentityDomain port references the SharePoint channels (Channel Parent) of the DirX Identity connected directory. The channels contain the mapping definitions for import of groups from SharePoint and the join definition for DirX Identity.</p>
</div>
<div class="paragraph">
<p>Note that the SharePoint validation workflow and the synchronization workflow use the same connected directory and channel configuration. Only the controller class is changed in the join activity.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sharepoint_workflow_channels"><a class="anchor" href="#_sharepoint_workflow_channels"></a>SharePoint Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about SharePoint workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_aspects_common_to_all_channels_and_synchronization_directions"><a class="anchor" href="#_aspects_common_to_all_channels_and_synchronization_directions"></a>Aspects Common to All Channels and Synchronization Directions</h5>
<div class="paragraph">
<p>At the SharePoint connected directory, the directory type LDAP is used since the required configuration parameters are almost the same. The clustered workflows ignore the SharePoint target system service and the bind profiles. These parameters are read from the target systems/bind profiles in the Provisioning domain.</p>
</div>
<div class="paragraph">
<p>The <strong>Identity</strong> &#8594; <strong>Group</strong> <strong>Base</strong> property must not be set at the connected directory because it is different for each target system. In a clustered workflow, this value is overwritten by the target system-specific configuration attribute <strong>Group</strong> <strong>Folder</strong> &#8594; <strong>Base</strong> <strong>DN</strong> in the Environment Properties tab (attribute <strong>role_ts_group_base</strong>) in the Provisioning domain. The <strong>Target</strong> <strong>System</strong> &#8594; <strong>Group</strong> <strong>Base</strong> property of the connected directory must be set even though it is ignored when exporting the groups from the SharePoint server since all groups per site are flat.</p>
</div>
<div class="paragraph">
<p>Some specific attributes of the Connected Directory are important for the workflows:</p>
</div>
<div class="paragraph">
<p><strong>accountnameattribute</strong> (mandatory) - the name of the LDAP attribute holding the Windows account name in the peer target system’s account objects.</p>
</div>
<div class="paragraph">
<p><strong>delete_group_enabled</strong> - a boolean flag. If set to true, deleting a group in DirX Identity results in a physical deletion of the group in the connected SharePoint site. If set to false, groups are not deleted in SharePoint.</p>
</div>
<div class="paragraph">
<p><strong>debug_to_screen</strong> - a boolean flag. If set to true, extra debug information is written to stdout. This attribute must be set to false in a production environment.</p>
</div>
<div class="paragraph">
<p><strong>domainnameattribute</strong> - the name of the LDAP attribute holding the Windows domain name in the peer target system’s account objects. If no value is specified, the domain of the bind account is added to the account name. In SharePoint Server versions prior to SharePoint Server 2013, the user name is composed of <em>domain</em>**<em>account</em>. In SharePoint Server 2013 and higher, the user name is composed of a claims-based identity type prefix (for a Windows claims identity type, the prefix is <strong>i:0#.w</strong>|) followed by <em>domain</em>**<em>account</em>. This means that the domain attribute (the default attribute name holding the domain name is dxmAdsDomain) of an account in the peer target system must consist of this claims-based prefix plus the domain name; for example, *i:0#.w|domain1*.</p>
</div>
<div class="paragraph">
<p>In SharePoint sites that use the member syntax <em>prefixaccount</em> (for example, *ptdssomember:*<em>account</em>) the domainnameattribute must be left blank. This leads to the following behavior:</p>
</div>
<div class="paragraph">
<p>In the sync direction (Identity to SharePoint) the members are created without the domain prefix in the join engine. The SharePoint connector then adds the prefix to the account name.</p>
</div>
<div class="paragraph">
<p>In the validation direction (SharePoint to Identity), the connector strips off the configured prefix from the members. In the join engine, the corresponding accounts then are searched without domain name, only with the filter *cn=*<em>account</em>.</p>
</div>
<div class="paragraph">
<p>If you use both sites with and without user name prefix, it may be necessary that you must configure two SharePoint clusters: one for the use with user name prefix (and empty domainnameattribute), and one for the use for members with syntax <em>domain</em>*\*<em>account</em> (with domainnameattribute configured).</p>
</div>
<div class="paragraph">
<p><strong>filterblocksize</strong> - the maximum number of account names in one search filter. The account name-to-user mapping is performed via LDAP searches in DirX Identity. This attribute adjusts the maximum number of account names that are combined in one search filter.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groups_4"><a class="anchor" href="#_groups_4"></a>Groups</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; SharePoint</p>
</div>
<div class="paragraph">
<p>GC - com.siemens.dxm.join.userhook.sharepoint.UserHookGroupsTo</p>
</div>
<div class="paragraph">
<p>This user hook performs the following mapping functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The group member DNs are converted to the target account names by searching the accounts in the peer target system according to their <strong>dxrUserLink</strong>s. The references <strong>member DN</strong> to <em>domainname</em>_account name_ are extracted from the accounts.</p>
</li>
<li>
<p>If the owner DN points to a user, it is converted to <em>domainname</em>_account_ by the same mechanism. If it is a group, the group name is extracted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Export Section</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This section contains the search filter to export all SharePoint groups of one site. In the future, other object types (beside groups) may be handled, so an object class Group is introduced here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mapping Section</p>
</div>
<div class="paragraph">
<p>The DirX Identity to SharePoint mapping is:</p>
</div>
<div class="paragraph">
<p><strong>Identifier</strong> - the identifier is created in a Java mapping function. It contains the group’s cn.</p>
</div>
<div class="paragraph">
<p><strong>objectClass</strong> - set to the fixed value "Group"</p>
</div>
<div class="paragraph">
<p><strong>groupNam</strong>e - the cn of the group.</p>
</div>
<div class="paragraph">
<p><strong>ownerIdentifier</strong> - a Java source mapping that performs the following mapping:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a value for <strong>owner</strong> is present in the source entry, this valued is returned in the map result.</p>
</li>
<li>
<p>Otherwise, the value for <strong>default_owner_type</strong> is read from the environment and returned in the map result.</p>
</li>
<li>
<p>If none of the above is present, the ownerIdentifier is not deleted for a modify group operation; the old value is kept instead. For an add operation, the group creation will fail, because the ownerIdentifier attribute in SharePoint is mandatory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>ownerType</strong> - a Java source mapping that performs the following mapping:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a value for <strong>owner</strong> is present in the source entry, this value is returned in the map result.</p>
</li>
<li>
<p>Otherwise, the value for <strong>default_owner_identifier</strong> is read from the environment and returned in the map result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>role</strong> - in the sample workflow, dxrHistoryRemoved holds the SharePoint role names. It is directly mapped to the sharePoint role attribute. You must choose your own attribute here if you intend to provision role names.</p>
</div>
<div class="paragraph">
<p><strong>description</strong> - direct mapping to the same attribute.</p>
</div>
<div class="paragraph">
<p><strong>defaultUserLoginName</strong> - a Java source mapping that performs the following mapping:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a value for <strong>owner</strong> is present in the source entry and the owner is a user, this value is returned in the result.</p>
</li>
<li>
<p>Otherwise, the value for <strong>default_userloginname</strong> is read from the environment and returned in the result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Operational Mapping Section</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The remote members of the group are mapped to the operational attribute "localMember". This mechanism preserves local members so that they are not deleted in SharePoint.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Join Section</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The join filter matches the group’s cn in DirX Identity against its SharePoint group name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: SharePoint &#8594; Identity Store</p>
</div>
<div class="paragraph">
<p>GI - com.siemens.dxm.join.userhook.sharepoint.UserHookGroupsFrom</p>
</div>
<div class="paragraph">
<p>This user hook performs the following mapping functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The target account names are converted to user DNs. Through the <strong>domainnameattribute</strong> and the <strong>accountnameattribute</strong> in the connected directory configuration, the account is searched in the peer target system. If found, the dxrUserLink attribute if populated holds the related user DN. If no DN is found for an account name, the member is mapped to "remotemember".</p>
</li>
<li>
<p>The owner identifier is converted to a user or a group DN. If no DN is found, the owner is mapped to "remoteowner".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Export Section</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The export section defines the search filter to export all groups of a SharePoint target system. As the search base <strong>role_ts_group_base</strong> is used, it is defined in the DirX Identity target system configuration (<strong>Base DN</strong> in the <strong>Environment Properties</strong> tab).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mapping Section</p>
</div>
<div class="paragraph">
<p>The SharePoint to DirX Identity mapping is:</p>
</div>
<div class="paragraph">
<p><strong>Identifier</strong> - the identifier is created in a Java mapping function. If a joinedId already exists, this value is used. In a validation workflow, the group’s DN is built from the SharePoint groupName and the <strong>role_ts_group_base</strong> configured at the corresponding DirX Identity target system.</p>
</div>
<div class="paragraph">
<p><strong>objectClass</strong> - defines the object classes required for a target system group.</p>
</div>
<div class="paragraph">
<p><strong>description</strong> - direct mapping from the description in SharePoint.</p>
</div>
<div class="paragraph">
<p><strong>ownerType</strong> - the type of the SharePoint owner is mapped to <strong>dxrDefaultGroupType</strong> in the sample. You may need to change this mapping if you use <strong>dxrDefaultGroupType</strong> for other purposes.</p>
</div>
<div class="paragraph">
<p><strong>owner</strong> - the owner is mapped from the <strong>ownerIdentifier</strong>. Note that the user hook runs prior to the mapping and thus the <strong>ownerIdentifier</strong> is already a DN here.</p>
</div>
<div class="paragraph">
<p><strong>cn</strong> - the group’s common name is filled with the SharePoint groupName.</p>
</div>
<div class="paragraph">
<p><strong>dxrHistoryRemoved</strong> - this attribute is used to hold the SharePoint role names in the sample workflow. You should change this to another attribute if you intend to provision the roles.</p>
</div>
<div class="paragraph">
<p><strong>dxrState</strong>, <strong>dxrTSState</strong>, <strong>dxrTSLocal</strong> and <strong>dxrToDo</strong> - the standard mapping as, for example, in the LDAP-to-LDAP workflows is used here, too.</p>
</div>
<div class="paragraph">
<p>Join Section</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The group is joined in DirX Identity by its DN created in the mapping section.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_member_channel_2"><a class="anchor" href="#_member_channel_2"></a>Member Channel</h5>
<div class="paragraph">
<p>The member channel configuration holds the mapping of the group members.</p>
</div>
<div class="paragraph">
<p>Direction: Identity Store &#8594; SharePoint</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mapping of the member attribute is handled in a special Java mapping function. It was copied from the LDAP-to-LDAP workflow.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: SharePoint &#8594; Identity Store</p>
</div>
<div class="paragraph">
<p>Mapping Section</p>
</div>
<div class="paragraph">
<p>The DirX Identity to SharePoint mapping is:</p>
</div>
<div class="paragraph">
<p><strong>dxrGroupMember</strong> attributes - the mapping of the member state attributes is standard for most attributes. Only <strong>dxrGroupMemberRemote</strong> and <strong>uniqueMember</strong> are mapped with special Java functions.</p>
</div>
<div class="paragraph">
<p><strong>dxrGroupMemberRemote</strong> - before the mapping, <strong>remotemember</strong> contains all SharePoint user names that cannot be mapped to a DirX Identity user. This situation occurs if the Windows account is not managed in a peer target system. The Java mapping function maps <strong>remotemember</strong> to <strong>dxrGroupMemberRemote</strong>. If no <strong>remotemember</strong> exists, <strong>dxrGroupMemberRemote</strong> is deleted.</p>
</div>
<div class="paragraph">
<p><strong>uniqueMember</strong> - in a target system without accounts but with states, <strong>uniqueMember</strong> must contain all users referencing the group. Once the user is removed from all group members, it is also removed from uniqueMember.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unify_office_workflows"><a class="anchor" href="#_unify_office_workflows"></a>Unify Office Workflows</h3>
<div class="paragraph">
<p>The Unify Office Provisioning workflows operate between a target system of type Unify Office in the Identity Store and the corresponding connected Unify Office endpoint.</p>
</div>
<div class="paragraph">
<p>The workflows use the Unify Office connector (UnifyOfficeConnector) for provisioning. This connector communicates with the Unify Office (RingCentral) endpoint using RESTful API with JSON requests.</p>
</div>
<div class="paragraph">
<p>The connector uses the Unify Office (RingCentral) OAuth server for authentication and authorization.</p>
</div>
<div class="paragraph">
<p>The Unify Office workflows handle the following Unify Office objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account</strong> - the common Unify Office (RingCentral) user (SCIMv2 conformant, translates to RingCentral extension object).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The delivered workflows include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Validate_UnifyOffice_Realtime</strong> - the validation workflow that imports existing Unify Office users from Unify Office (RingCentral) server to the Identity Store.</p>
</li>
<li>
<p><strong>Ident_UnifyOffice_Realtime</strong> - the synchronization workflow that exports detected changes for account from Identity Store to the Unify Office (RingCentral) endpoint and then validates the processed changes in Unify Office (RingCentral) endpoint to the Identity Store.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates the Unify Office (RingCentral) Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image34.png" alt="Unify Office Provisioning Workflow Architecture">
</div>
<div class="title">Figure 35. Unify Office Provisioning Workflow Architecture</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_and_limitations_2"><a class="anchor" href="#_prerequisites_and_limitations_2"></a>Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The Unify Office Provisioning workflows only offer channels for the SCIM objects and attributes provided by the appropriate RingCentral API endpoint. The Unify Office Connector supports other objects as well, but since these are specific for voice telephony they are out of scope.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_unify_office"><a class="anchor" href="#_connecting_to_unify_office"></a>Connecting to Unify Office</h4>
<div class="paragraph">
<p>Verify that services are correctly configured at the Unify Office connected directory. The Unify Office Service referenced by the connected directory should contain the default value <strong>platform.devtest.ringcentral.com</strong> with SSL enabled. This platform connects to the sandbox account; for production, it must be changed to <strong>platform.ringcentral.com</strong>.</p>
</div>
<div class="paragraph">
<p>The Unify Office connected directory and Provisioning workflows support the central HTTP proxy server configuration. See the section “HTTP Proxy Server Configuration” for details.</p>
</div>
<div class="paragraph">
<p>DirX Identity must be registered as a valid principal service for your existing Unify Office tenant (account). Use the Unify Office (RingCentral) developer portal <a href="https://developers.ringcentral.com/" class="bare">https://developers.ringcentral.com/</a> to create your app and generate your client ID and client secret.</p>
</div>
<div class="paragraph">
<p>Configure the bind profile for the Admin User when you plan to use the Resource Owner Password Flow and configure the bind profile for client authentication with the generated client ID and <strong>Client</strong> <strong>Secret</strong> field from your generated app.</p>
</div>
<div class="paragraph">
<p>Check the Provisioning settings used by the connected directory and then set them to the real values for your provisioned target system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_unify_office_target_system"><a class="anchor" href="#_configuring_the_unify_office_target_system"></a>Configuring the Unify Office Target System</h4>
<div class="paragraph">
<p>The Unify Office target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - all Unify Office accounts are located in a subfolder <strong>Accounts</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>dxrPrimaryKey</strong> attribute of accounts contains the unique ID generated by the Unify Office (RingCentral) endpoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="_workflow_and_activities"><a class="anchor" href="#_workflow_and_activities"></a>Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the join activity:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image35.png" alt="Unify Office Provisioning Workflow Channels and Objects">
</div>
<div class="title">Figure 36. Unify Office Provisioning Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>The Unify Office objects are synchronized via a pair of channels (one channel per direction).</p>
</div>
</div>
<div class="sect3">
<h4 id="_workflow_ports"><a class="anchor" href="#_workflow_ports"></a>Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the Unify Office workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CF - Crypt Filter<br>
A connector filter is configured implicitly. It is used to send decrypted passwords to the Unify Office endpoint.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_workflow_channels"><a class="anchor" href="#_workflow_channels"></a>Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about Unify Office workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_accounts_4"><a class="anchor" href="#_accounts_4"></a>Accounts</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; Unify Office:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>dxrPrimaryKey</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong> or <strong>userName=${target.userName}</strong></p>
</li>
<li>
<p><strong>accountEnabled</strong> - the attribute used to disable the account object in Unify Office. The correct value is derived from the <strong>dxrState</strong> attribute of the corresponding account object in the Identity Store.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: Unify Office &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>"cn="${source.userName}","+${env.role_ts_account_base}</strong> or <strong>${joinedEntry.id}</strong></p>
</li>
<li>
<p>Join: <strong>${target.dxrPrimaryKey}</strong> or <strong>${target.dxrName}</strong> or <strong>${target.id}</strong>.</p>
</li>
<li>
<p><strong>dxrTSState</strong> - the attribute used to detect the current state of the account in Unify Office. The correct value is derived from the <strong>accountEnabled</strong> attribute of the corresponding account object in Unify Office. It is set to DELETED when no account entry is found.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unix_openicf_workflows"><a class="anchor" href="#_unix_openicf_workflows"></a>UNIX-OpenICF Workflows</h3>
<div class="paragraph">
<p>The UNIX-OpenICF Provisioning workflows operate between a target system of type OpenICF in the Identity Store and the corresponding connected OpenICF connector server which is configured for communication with a UNIX (Linux) system using the OpenICF connector bundle <strong>org.forgerock.openicf.connectors.solaris-connector</strong> (UNIX connector).</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the OpenICF connector server architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image36.png" alt="UNIX-OpenICF Connector Server Architecture">
</div>
<div class="title">Figure 37. UNIX-OpenICF Connector Server Architecture</div>
</div>
<div class="paragraph">
<p>As shown in the figure, the Java OpenICF connector sends a request to an OpenICF connector server which runs on a supported platform. Note that single an OpenICF server may support more connector bundles at the same time. The OpenICF server passes the request to the UNIX connector bundle. The bundle then establishes a SSH or telnet connection to a configured UNIX host and executes the necessary scripts. It is possible to provision more UNIX hosts using the single OpenICF connector server.</p>
</div>
<div class="paragraph">
<p>The workflows use the specially preconfigured DirX Identity OpenICF connector for UNIX provisioning (OpenIcfConnector2Unix). This connector communicates with the OpenICF connector server using the special OpenICF protocol. See the section "OpenICF Connector" in the <em>DirX Identity Connectivity Reference</em> for more details. The following figure illustrates the UNIX-OpenICF Provisioning workflow architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image37.png" alt="UNIX-OpenICF Provisioning Workflow Architecture">
</div>
<div class="title">Figure 38. UNIX-OpenICF Provisioning Workflow Architecture</div>
</div>
<div class="paragraph">
<p>The workflows handle the following UNIX objects:</p>
</div>
<div class="paragraph">
<p><strong>Account</strong> - the common UNIX accounts.</p>
</div>
<div class="paragraph">
<p><strong>Group</strong> - the common UNIX groups.</p>
</div>
<div class="paragraph">
<p>The delivered workflows are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_UNIX-OICF_Realtime</strong> - the synchronization workflow that exports detected changes for account and group objects from Identity Store to the UNIX system and then validates the processed changes in the UNIX system to the Identity Store.</p>
</li>
<li>
<p><strong>SetPassword in UNIX-OICF</strong> - the workflow that sets the password for the account in the UNIX system.</p>
</li>
<li>
<p><strong>Validate_UNIX-OICF_Realtime</strong> - the validation workflow that imports existing UNIX accounts and groups with group assignments from the UNIX system to the Identity Store.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_unix_openicf_prerequisites_and_limitations"><a class="anchor" href="#_unix_openicf_prerequisites_and_limitations"></a>UNIX-OpenICF Prerequisites and Limitations</h4>
<div class="paragraph">
<p>The UNIX-OpenICF workflows have the following prerequisites and limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The delivered workflows require a properly deployed OpenICF connector server with a supported version of <strong>org.forgerock.openicf.connectors.solaris-connector</strong> (UNIX connector). DirX Identity delivers an enhanced version of this bundle based on version 1.1.1.0-SNAPSHOT.</p>
</li>
<li>
<p>Some SUSE Enterprise Server distributions may not be able to completely remove secondary group assignments for a user. The OpenICF UNIX connector uses the common UNIX command <strong>usermod</strong> <strong>-G ""</strong> <em>account_name</em>. This command might not work correctly on SUSE distributions. In this case, deprecated secondary group assignments will remain unassigned.</p>
</li>
<li>
<p>Before you can use the workflows, you must extend the DirX Identity Store schema with UNIX-OpenICF target system-specific attributes and object classes so that the workflows can store UNIX-OpenICF-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows". When performing the procedures described in this section, select the extensions for PAM-UNIX and UNIX.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_the_unix_system"><a class="anchor" href="#_connecting_to_the_unix_system"></a>Connecting to the UNIX System</h4>
<div class="paragraph">
<p>Building the connection to the UNIX system consists of two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Installing and configuring the Java-based OpenICF connector server</p>
</li>
<li>
<p>Configuring the connection to the OpenICF connector server</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_setting_up_the_java_based_openicf_connector_server"><a class="anchor" href="#_setting_up_the_java_based_openicf_connector_server"></a>Setting up the Java-based OpenICF Connector Server</h5>
<div class="paragraph">
<p>This section provides information on how to set up the Java-based OpenICF connector server.</p>
</div>
<div class="paragraph">
<p>OpenICF Server</p>
</div>
<div class="paragraph">
<p>Download a stable installation package for the Java OpenICF connector server on <strong><a href="http://www.forgerock.org/openicf-archive.html" class="bare">http://www.forgerock.org/openicf-archive.html</a></strong>. We recommend the version OpenICF Java 1.1.1.0 for compatibility reasons. Follow the installation instructions on <strong><a href="http://openicf.forgerock.org/connector-framework-internal/connector_server.html" class="bare">http://openicf.forgerock.org/connector-framework-internal/connector_server.html</a></strong>. Configure the OpenICF server port, shared secret and create host certificates if you intend to use SSL.</p>
</div>
<div class="paragraph">
<p>OpenICF UNIX Connector Bundle</p>
</div>
<div class="paragraph">
<p>Deploy the delivered improved version of the UNIX connector bundle to your OpenICF connector server installation directory. After you have installed the feature for OpenICF connectivity, you can find the UNIX connector in the folder <em>install_path</em>/<strong>connectors/OpenICF/bundles/java</strong> (the file name is in the form <strong>solaris-connector-<strong></strong>.jar*). Copy the file to the <em>openicf_install_path</em>*/bundles* directory. If there is an older version of the file <strong>solaris-connector-</strong></strong>.jar* in this folder, delete it. The configuration of the connector bundle does not require any special steps.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_the_connection_to_the_openicf_connector_server"><a class="anchor" href="#_configuring_the_connection_to_the_openicf_connector_server"></a>Configuring the Connection to the OpenICF Connector Server</h5>
<div class="paragraph">
<p>To configure the connection to a UNIX system using an OpenICF connector server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the IP address or the host name and the data port of the OpenICF connector server with the deployed UnixConnector bundle. Adapt the bind profile for the OpenICF server - set the password that is configured as a shared secret with the OpenICF connector server and enable SSL if it is enabled on the OpenICF server side. Using SSL may require additional configuration steps. See the section "OpenICF Connector" in the <em>DirX Identity Connectivity Reference</em> for more details. All of these properties can be configured using the connected directory (Generic connected directory type) that represents the OpenICF server. It is referenced from the connected directory that represents the UNIX system (the OpenICF Server and OpenICF Server Bind Profile property on the OpenICF Connector Server tab).</p>
</li>
<li>
<p>Specify the IP address or the host name of the UNIX system at the UNIX-OpenICF service object and then set the bind profile properly. UNIX-OpenICF connected directory represents a real UNIX system that will be provisioned by our workflows. Use the correct port numbers that are configured on the UNIX host for the desired type of communication (SSH or telnet). Use credentials with sufficient access rights (UNIX account and group management).</p>
</li>
<li>
<p>Specify the <strong>Response</strong> <strong>Timeout</strong> property on the <strong>OpenICF</strong> <strong>Connector</strong> <strong>Server</strong> tab of the UNIX-OpenICF connected directory. Set the value that is sufficient for the selected bundle type (UnixConnector). The default value is <strong>30</strong>.</p>
</li>
<li>
<p>Check the settings related to the OpenICF connector bundle at the TS port of the workflow object (<strong>OpenICF</strong> <strong>Connector</strong> <strong>Bundle</strong> tab). The <strong>Bundle</strong> <strong>Specification</strong> area allows you to define the <strong>Bundle</strong> <strong>Name</strong> (the default is <strong>org.forgerock.openicf.connectors.solaris-connector</strong>), <strong>Bundle</strong> <strong>Version</strong> (the default is <strong>1.1.1.0-SNAPSHOT</strong>) and <strong>Class</strong> <strong>Name</strong> property (the default is <strong>org.identityconnectors.solaris.UNIXConnector</strong>). Only use values that are valid for a connector bundle deployed on the OpenICF connector server. Override default values if necessary. The <strong>Bundle</strong> <strong>Settings</strong> area lets you choose the <strong>Unix</strong> <strong>Mode</strong> (use <strong>linux</strong> for Linux flavors), <strong>Connection</strong> <strong>Type</strong> (use <strong>ssh</strong> or <strong>telnet</strong>) and set the <strong>Shell</strong> <strong>Prompt</strong> (use the string character that is displayed at the beginning of the UNIX command prompt for the connected user. The hash tag (<strong>#</strong>) sign is typically used for the root account.)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_unix_openicf_target_system"><a class="anchor" href="#_configuring_the_unix_openicf_target_system"></a>Configuring the UNIX-OpenICF Target System</h4>
<div class="paragraph">
<p>The UNIX-OpenICF target system requires the following layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accounts</strong> - all UNIX accounts are located in a subfolder Accounts.</p>
</li>
<li>
<p><strong>Groups</strong> - all UNIX groups are located in a subfolder Groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The attributes <strong>uid</strong>, <strong>dxrName</strong> and <strong>dxrPrimaryKey</strong> of accounts contain the name (<strong>uid</strong>) of these objects in the connected UNIX system.</p>
</div>
<div class="paragraph">
<p>The standard <strong>JavaScript dxrNameForAccounts.js</strong> generates the attribute <strong>uid</strong> for the UNIX account.</p>
</div>
<div class="paragraph">
<p>The attributes <strong>dxrName</strong> and <strong>dxrPrimaryKey</strong> of groups contain the name <strong>(gid)</strong> of these objects in the connected UNIX system.</p>
</div>
<div class="paragraph">
<p>The attribute <strong>dxmUnixPrimaryGroup</strong> for the UNIX account (refers to the primary UNIX group of the account) is by default automatically chosen as one of the currently assigned UNIX groups. It uses the obligation mechanism (see group objects) and the UNIX-OpenICF specific <strong>JavaScript AccountPrimaryGroup.js</strong>. The JavaScript updates the <strong>dxmUnixPrimaryGroup</strong> when necessary. You can change the primary group manually at the account object.</p>
</div>
<div class="paragraph">
<p>The account object also stores the group membership and references the <strong>dxrPrimaryKey</strong> attribute of the group objects.</p>
</div>
<div class="paragraph">
<p>The workflows support disabling of the accounts. In this case, a special primary group needs to be assigned for a disabled account since the primary group membership is mandatory for UNIX systems. You can configure the name of the group that will be used solely for disabled accounts. See the <strong>UNIX-OpenICF</strong> tab of the target system instance and the property <strong>Group</strong> for disabled accounts. Create a real group in the connected UNIX system with no access rights with the corresponding name (<strong>gid</strong>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_unix_openicf_workflow_and_activities"><a class="anchor" href="#_unix_openicf_workflow_and_activities"></a>UNIX-OpenICF Workflow and Activities</h4>
<div class="paragraph">
<p>The following figure shows the layout of the channels that are used by the UNIX-OpenICF workflow&#8217;s join activity:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch7_targetWFs/image38.png" alt="UNIX-OpenICF Provisioning Workflow Channels and Objects">
</div>
<div class="title">Figure 39. UNIX-OpenICF Provisioning Workflow Channels and Objects</div>
</div>
<div class="paragraph">
<p>The UNIX objects account and group (and membership) are synchronized via a pair of channels (one channel per direction).</p>
</div>
</div>
<div class="sect3">
<h4 id="_unix_openicf_workflow_ports"><a class="anchor" href="#_unix_openicf_workflow_ports"></a>UNIX-OpenICF Workflow Ports</h4>
<div class="paragraph">
<p>This section describes the UNIX-OpenICF workflow ports.</p>
</div>
<div class="paragraph">
<p>TS Port</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CF - Crypt Filter</strong><br>
A UNIX-OpenICF filter is implicitly configured. It is used to send the decrypted password attribute <strong><em>PASSWORD</em></strong> to the OpenICF connector server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unix_openicf_workflow_channels"><a class="anchor" href="#_unix_openicf_workflow_channels"></a>UNIX-OpenICF Workflow Channels</h4>
<div class="paragraph">
<p>This section provides information about UNIX-OpenICF workflow channels.</p>
</div>
<div class="sect4">
<h5 id="_common_aspects_7"><a class="anchor" href="#_common_aspects_7"></a>Common Aspects</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; UNIX-OpenICF</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>ENABLE</em></strong> - the attribute used for disabling the account in UNIX. The value is derived from dxrState attribute of the corresponding account object in DirX Identity.</p>
</li>
<li>
<p><strong>secondary_group</strong> - the attribute for secondary UNIX group membership detects changes of primary group assignment and adds the deprecated primary membership to secondary UNIX groups if necessary. It also removes primary groups from the list of secondary (supplementary) groups.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_accounts_5"><a class="anchor" href="#_accounts_5"></a>Accounts</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; UNIX-OpenICF</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>dxrPrimaryKey</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong> or <strong>${source.uidNumber}</strong></p>
</li>
<li>
<p>The <strong><em>GROUPS</em></strong> attribute holds the name of the primary group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: UNIX-OpenICF &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Join via the <strong>dxrName</strong> attribute that is mapped identically as the <strong>uid</strong> and <strong>dxrPrimaryKey</strong> attribute.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_groups_5"><a class="anchor" href="#_groups_5"></a>Groups</h5>
<div class="paragraph">
<p>Direction: Identity Store &#8594; UNIX-OpenICF</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: <strong>dxrPrimaryKey</strong></p>
</li>
<li>
<p>Join: <strong>${source.dxrPrimaryKey}</strong> or <strong>{source.gidNumber}</strong></p>
</li>
<li>
<p>PostMapping script changes the type of the request to delete if necessary.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Direction: UNIX-OpenICF &#8594; Identity Store</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Join via the <strong>dxrName</strong> attribute that is mapped identically as the <strong>dxrPrimaryKey</strong> attribute.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_tcl_based_target_system_workflows"><a class="anchor" href="#_understanding_tcl_based_target_system_workflows"></a>Understanding the Tcl-based Target System Workflows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The topics in this section provide configuration information about the Tcl-based target system (Provisioning) workflows, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The types of Provisioning workflows that exist for each target system</p>
</li>
<li>
<p>Object identification and group-to-account referencing</p>
</li>
<li>
<p>A summary of target system reference, join, and primary key attributes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a description of the script structure used by the target system workflows, see "Understanding the Default Application Workflow Technology" &gt; "Understanding Tcl-based Workflows" &gt; "Tcl-based Connectivity Architecture" &gt; "Provisioning Workflow Script Structure".</p>
</div>
<div class="paragraph">
<p>This section provides details about the Tcl-based default target system workflows, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HiPath workflow (Siemens) - describes details about the HDMS / HiPath 4000 Manager workflow<br>
Note that the Siemens HiPath synchronization workflow does not work from a DirX Identity target system - it works from the user tree of the Identity Store. See the HiPath workflow section for more information.</p>
</li>
<li>
<p>ODBC workflow - describes details about the ODBC workflow</p>
</li>
<li>
<p>RACF workflow (IBM) - describes details about the RACF workflow</p>
</li>
<li>
<p>SiPass workflow (Siemens) - describes details about the SiPass workflows</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_target_system_workflow_types"><a class="anchor" href="#_target_system_workflow_types"></a>Target System Workflow Types</h3>
<div class="paragraph">
<p>Each target system has a validation and a synchronization provisioning workflow.</p>
</div>
<div class="paragraph">
<p>You can run the validation workflow in one of two modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>InitialLoad</strong> - exports all of the accounts and groups and the relationships between them from the target system and imports them into the relevant target system subtree in the Identity Store. It performs a full export of the target system and an import to DirX Identity in replace mode. This is the default mode.</p>
</li>
<li>
<p><strong>Validation</strong> - detects deviations between the state known in DirX Identity and in the target system, for example about created or deleted accounts and groups or their relationships in the target system. It writes messages about the deviations it finds into the "to do" fields of the affected target system objects in the Identity Store. It does a full export of the target system and an import to DirX Identity in replace mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Initial load and validation modes use the same jobs and are almost identical. The only difference between them is the specific attribute mode of the workflow object, which is set to <strong>InitialLoad</strong> for the initial load workflow. The Provisioning common script checks this flag and writes the dxrToDo fields for a validation workflow run.</p>
</div>
<div class="paragraph">
<p>The synchronization workflow exports all relevant changes from the DirX Identity accounts and groups subtree, imports them into the target system and acknowledges the changes back to the Identity Store. It does a delta export in both directions and imports the data to DirX Identity in merge mode.</p>
</div>
<div class="paragraph">
<p>Both synchronization and validation workflows update the dxrTSState attribute and the group member attributes of the affected target system objects in the DirX Identity store with the state of the object in the target system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_object_identification_and_group_to_account_references"><a class="anchor" href="#_object_identification_and_group_to_account_references"></a>Object Identification and Group-to-Account References</h3>
<div class="paragraph">
<p>The Provisioning workflows for the default Connectivity scenario operate on both "hierarchical and "non-hierarchical" target systems. In a hierarchical target system, entries (typically, accounts and groups) are ordered hierarchically in trees; LDAP and ADS are examples of hierarchical target systems. A non-hierarchical target system has a "flat" ordering of entries; Windows is an example of a non-hierarchical target system. This section provides referencing and joining information about the hierarchical and non-hierarchical target system workflows provided with the default scenario.</p>
</div>
<div class="sect3">
<h4 id="_workflows_for_the_hierarchical_target_systems"><a class="anchor" href="#_workflows_for_the_hierarchical_target_systems"></a>Workflows for the Hierarchical Target Systems</h4>
<div class="paragraph">
<p>This section provides general, referencing, and joining information for the ADS, Exchange, SAP EP UM, and LDAP hierarchical target system workflows.</p>
</div>
<div class="sect4">
<h5 id="_general_information_2"><a class="anchor" href="#_general_information_2"></a>General Information</h5>
<div class="paragraph">
<p>The hierarchical workflows for the ADS, Exchange, SAP EP UM and LDAP target systems map the hierarchical tree structure of the target system to the DirX Identity target system accounts and groups subtree. They use the DirX Identity attribute dxrPrimaryKey for account and group objects to hold the target system DN of the object.</p>
</div>
<div class="paragraph">
<p>At the end of the initial load and validation workflows, the AccountRootInTs and GroupRootInTs parameters of the target system object in DirX Identity Provisioning are set to the values specified in DirX Identity Connectivity in the target system connected directory in the provisioning step. They define the account and group root distinguished name (DN) in the target system and are used in DirX Identity to create the dxrPrimaryKey attribute of an account or group object that is created in DirX Identity.</p>
</div>
</div>
<div class="sect4">
<h5 id="_referencing_information"><a class="anchor" href="#_referencing_information"></a>Referencing Information</h5>
<div class="paragraph">
<p>The workflows for the target systems ADS, Exchange, LDAP and SAP EP UM use the dxrPrimaryKey attribute as the reference attribute from a group to an account. Because it holds the DN of the object in the target system, the DirX Identity group member attributes can be mapped directly to the target system member attribute and vice-versa.</p>
</div>
</div>
<div class="sect4">
<h5 id="_joining_information"><a class="anchor" href="#_joining_information"></a>Joining Information</h5>
<div class="paragraph">
<p>The Exchange and SAP EP UM workflows use the dxrPrimaryKey attribute for joining (identifying) a target system object with an object in the Identity Store.</p>
</div>
<div class="paragraph">
<p>The LDAP workflows use the employeeNumber attribute and the ADS workflows use the sAMAccountName attribute for joining. This usage has the advantage that objects that have been moved in the LDAP or ADS directory are identified in the Identity Store and can be moved there if the flag Rename Allowed is set in the import properties of <strong>metacp</strong>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_workflows_for_the_non_hierarchical_target_systems"><a class="anchor" href="#_workflows_for_the_non_hierarchical_target_systems"></a>Workflows for the Non-Hierarchical Target Systems</h4>
<div class="paragraph">
<p>This section provides information about referencing and joining for the Windows NT and ODBC non-hierarchical workflows.</p>
</div>
<div class="sect4">
<h5 id="_referencing_and_joining"><a class="anchor" href="#_referencing_and_joining"></a>Referencing and Joining</h5>
<div class="paragraph">
<p>The NT and ODBC non-hierarchical workflows use the cn attribute as the reference attribute from groups to accounts. The ODBC workflows supply an ODBC unique identifier in the dxrPrimaryKey attribute and use it for joining in subsequent workflows. The Windows NT workflows do not use the dxrPrimaryKey attribute; instead, they use cn, which holds the Windows NT account name, for joining.</p>
</div>
<div class="paragraph">
<p>In the non-hierarchical workflows RACF and SAP R3 UM, the accounts contain the group member lists so that the groups are referenced from the accounts. This flag is set in the target system advanced page. The reference attribute of the RACF target system is the racfid of a group, and the reference attribute of the SAP R3 UM target system is the cn of a group. Neither of these target system workflows use the dxrPrimaryKey attribute. The RACF workflow uses the racfid for joining and the SAP R3 UM workflow uses sapUsername.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_target_system_reference_and_join_summary"><a class="anchor" href="#_target_system_reference_and_join_summary"></a>Target System Reference and Join Summary</h3>
<div class="paragraph">
<p>The following table provides the reference attribute, reference direction, join attribute and dxrPrimaryKey for all of the target systems supported by DirX Identity.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16%;">
<col style="width: 19%;">
<col style="width: 19%;">
<col style="width: 24%;">
<col style="width: 22%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>Reference Attribute</strong></th>
<th class="tableblock halign-left valign-top"><strong>Reference Direction</strong></th>
<th class="tableblock halign-left valign-top"><strong>Join Attribute</strong></th>
<th class="tableblock halign-left valign-top"><strong>dxrPrimaryKey</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ADS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group - Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sAMAccountName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DN of TS object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>LDAP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group - Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">employeeNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DN of TS object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>LDAPXXL</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account - Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">employeeNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DN of TS object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ODBC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group - Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ODBC unique identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDBC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group - Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC unique identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group - Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn (=LNfullName)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RACF</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">racfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account - Account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">racfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SAPR3UM</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account - Account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sapUsername</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SAPEPUM</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group - Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrPrimaryKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DN of TS object</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The reference direction indicates how the group memberships are stored in DirX Identity and in the target system. For example "Group - Group" indicates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identity Store: the memberships are stored in attributes that point from the groups to the accounts.</p>
</li>
<li>
<p>Target system database: the memberships are stored in attributes that point from the groups to the accounts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The group-side storage does not work for very large numbers of group members. In a company with 500,000 employees, all might be in the group "Standard Employee" which resides in 500,000 attribute values in one group attribute. Target systems (for example, LDAP directories) cannot handle groups of any size.</p>
</div>
<div class="paragraph">
<p>If the memberships are stored on the account side, the limit is less critical because the number of groups of which a user can be a member will not be more than 10,000. This number can be handled by any LDAP server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hipath_workflow"><a class="anchor" href="#_hipath_workflow"></a>HiPath Workflow</h3>
<div class="paragraph">
<p>The HiPath Workflow <strong>Ident_HiPath</strong> handles bi-directional synchronization between a Siemens Hicom Domain Management System (HiPath 4000) and the Identity Store (user area, not target system area!). The workflow communicates with the HiPath database using the Hicom XIE import/export interface.</p>
</div>
<div class="paragraph">
<p>The following HiPath systems are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HDMS 3.1</p>
</li>
<li>
<p>HDMS 3.6</p>
</li>
<li>
<p>HDMS-US 5.2</p>
</li>
<li>
<p>HiPath 4000 Manager V1.0</p>
</li>
<li>
<p>HiPath 4000 Manager V3.1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basic assumptions and prerequisites for the HiPath workflow are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MetaStore is entry master for the HiPath database.</p>
</li>
<li>
<p>The HiPath database is attribute master for telephoneNumber and facsimileTelephoneNumber (hardcoded).</p>
</li>
<li>
<p>The person entry in the LDAP directory must contain the attribute <strong>dxmOprOriginator</strong>. In the DirX Identity default scenario this is guaranteed via the objectClass <strong>dxrUser</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The workflow performs the following steps in sequence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Activity Meta2HiPath_HiPath</p>
</li>
<li>
<p>Activity HiPath2Meta_HiPath</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_prerequisites_and_limitations_3"><a class="anchor" href="#_prerequisites_and_limitations_3"></a>Prerequisites and Limitations</h4>
<div class="paragraph">
<p>Before you can use the HiPath workflow, you must extend the DirX Identity Store schema with HDMS target system-specific attributes and object classes so that the workflow can store HDMS-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows".</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_ident_hipath_workflow"><a class="anchor" href="#_configuring_the_ident_hipath_workflow"></a>Configuring the Ident_HiPath Workflow</h4>
<div class="paragraph">
<p>The default scenario HiPath workflow is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ident_HiPath</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the configuration for this workflow, you must set up the environment and then adapt some values in the Connectivity configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set and test the environment as described in the "Environment Setup" topic in "Default Application Reference".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the configuration wizard in the Identity Manager Global View as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <strong>Default</strong> scenario and double-click the connected directory icon <strong>HiPath</strong>.</p>
</li>
<li>
<p>In the wizard window, click the icon to the right of the <strong>Service</strong> field.</p>
</li>
<li>
<p>Set the <strong>Server Name</strong> and <strong>IP Address</strong> fields.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
<li>
<p>Click <strong>Hicom DMS Parameters</strong>.</p>
</li>
<li>
<p>Select the <strong>HiPath</strong> <strong>Version</strong> and set the correct <strong>Remote Mode</strong> parameters (see the context- sensitive help in the <em>DirX Identity Connectivity Administration Guide</em>).</p>
</li>
<li>
<p>Click <strong>OK</strong>, and then click <strong>Finish</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next, set the parameters of the workflow as follows, but only if you selected HDMS 5.2 as the version:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Right-click the workflow line between the connected directory icons <strong>Identity</strong> <strong>Store</strong> and <strong>HiPath</strong>.</p>
</li>
<li>
<p>In the pop-up menu, select the workflow <strong>Ident_HiPath</strong> and then click <strong>Configure</strong>.</p>
</li>
<li>
<p>Click <strong>Ident2HiPath</strong> <strong>Attribute Mapping</strong>, then:</p>
</li>
<li>
<p>Change the output attribute <strong>text3</strong> (this one is not supported by the US version) to another unused attribute, for example <strong>info3</strong>.</p>
</li>
<li>
<p>Change the output attribute <strong>longname</strong> (this one is not supported by the US version) to another unused attribute, for example <strong>room</strong>.</p>
</li>
<li>
<p>Click <strong>HiPath2Ident</strong> <strong>Attribute Mapping</strong>, then:</p>
</li>
<li>
<p>Change the input attribute <strong>text3</strong> (this one is not supported by the US version) to another unused attribute, for example <strong>info3</strong> (use the same one you selected for <strong>Ident2HiPath</strong> <strong>Attribute Mapping</strong>).</p>
</li>
<li>
<p>Click <strong>Finish</strong> to close the wizard and save your changes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now the workflow should run.</p>
</div>
<div class="paragraph">
<p>The workflow transfers some information back to the Identity Store (for example, the telephoneNumber and facsimileTelephoneNumber). This workflow does not create or delete any entries (it assumes that the Identity Store is the master for entries).</p>
</div>
<div class="paragraph">
<p>For details, see the next sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="_activity_ident2hipath_hipath_meta_directory_export"><a class="anchor" href="#_activity_ident2hipath_hipath_meta_directory_export"></a>Activity Ident2HiPath_HiPath (meta directory export)</h4>
<div class="paragraph">
<p>This section describes the operation and the prerequisites of the Ident2HiPath_HiPath activity.</p>
</div>
<div class="sect4">
<h5 id="_general_features_and_prerequisites"><a class="anchor" href="#_general_features_and_prerequisites"></a>General Features and Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>Delta operation at the LDAP side.</p>
</li>
<li>
<p>Filter: Status = ENABLED or TBDEL.</p>
</li>
<li>
<p>Updates HiPath in merge mode (ADD operations are converted to INSERT operations in HiPath, MODIFY operations are converted to UPDATE operations in HiPath and DELETE operations are converted to DELETE operations in HiPath).</p>
</li>
<li>
<p>The workflow handles referential integrity for HDMS 3.X: If the Workflow detects that entries in HDMS tables COMPIMP, ORGIMP, BUILDIMP, LOCIMP are required before creating a Person in HDMS, it will create these entries implicitly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basic assumptions and prerequisites for this activity are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The attributes <strong>dxrState</strong>, <strong>dxmOprOriginator</strong> and <strong>createTimeStamp</strong> should be selected at the source side. If you intend to use an attribute other than dxrState as the status attribute, you need to customize the export post mapping and the export search filter.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_basic_operation"><a class="anchor" href="#_basic_operation"></a>Basic Operation</h5>
<div class="paragraph">
<p>This activity performs a full or delta export of meta directory entries into a CSV file, which it then imports into an HiPath database. It has the following phases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Initialization</strong> - This phase reads the relevant directory data and the complete HiPath database into a data file. This phase also creates a <strong>metacp</strong> index list handle that represents the database sorted by DMSIDs and a handle that represents the database sorted by join criteria (for example, employee Number) which is created in full mode only.</p>
</li>
<li>
<p><strong>Comparison</strong> - This phase compares the directory and HiPath and derives the required HiPath update actions, including creation of the related HiPath update request file.</p>
</li>
<li>
<p><strong>Update</strong> - This phase updates the HiPath database using the request file created in the comparison phase.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <strong>full mode</strong>, export works as follows: it selects entries from the Identity Store (filter dxmOprStatus = ENABLED or TBDEL) and transfers them to the HiPath directory. For each entry in the directory search result, it considers the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Directory entry has related HiPath entries. In this case, perform these steps for each related DMSID:</p>
</li>
<li>
<p>Find related HiPath entry by DMSID.</p>
</li>
<li>
<p>If there is no match, this is considered as an inconsistency to be resolved by the administrator. The entry will be documented in the trace file as missing in HiPath.</p>
</li>
<li>
<p>If there is one match, update the related HiPath entry if directory entry is in state ENABLED (in particular, trace HiPath entry as up-to-date if no changes have been detected), and delete the related HiPath entry if the directory entry is in state TBDEL</p>
</li>
<li>
<p>Directory entry does not have related HiPath entries. Try to find the related HiPath-entry via best-guess-match and distinguish the following cases:</p>
</li>
<li>
<p>No HiPath-entry matches. If the Directory entry is in state TBDEL, nothing is to be done for that entry. Otherwise INSERT entry into HiPath.</p>
</li>
<li>
<p>More than one HiPath-entry matches. This ambiguity will be documented in the trace file.</p>
</li>
<li>
<p>Exactly one HiPath-entry matches. Consider the following subcases:</p>
</li>
<li>
<p>Directory entry is in state ENABLED. If the match is unique also in the directory. perform an UPDATE operation for updating the related HiPath-entry where the attributes to be synchronized are taken from the directory. The directory entry will also be updated with the related DMS-Identifier (if not yet present in the directory entry).</p>
</li>
<li>
<p>Directory entry is in state TBDEL If the match is unique also in the directory, then DELETE the related entry in HiPath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <strong>delta mode,</strong> there is a slight difference: for directory entries without related HiPath entries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The creationTimestamp of the Directory entry is evaluated (no best-guess-match).</p>
</li>
<li>
<p>Entries with a creationTimestamp that is more recent than export-last-update-time will lead to an INSERT in HiPath.</p>
</li>
<li>
<p>Entries with a creationTimestamp that is less recent than export-last-update-time are assumed to have related HiPath entries from previous synchronization cycles. Therefore, such an entry (old creationTimestamp and no related HiPath entry) will be discarded and documented in the trace file.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_control_of_the_remote_hipath_system"><a class="anchor" href="#_control_of_the_remote_hipath_system"></a>Control of the Remote HiPath System</h5>
<div class="paragraph">
<p>The HDMSAgent uses a remote copy command in order to transfer files to the remote host, and a remote shell command to execute the HDMS request on the remote host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The related remote copy command is <strong>rcp</strong> (remote copy) if the value of the <strong>remote_secure_interaction</strong> parameter is <strong>FALSE</strong>, and the command <strong>scp</strong> (secure shell), if the parameter value is <strong>TRUE</strong>.</p>
</li>
<li>
<p>The related remote shell command is <strong>rsh</strong> (remote shell) if the value of the <strong>remote_secure_interaction</strong> parameter is <strong>FALSE</strong>, and the command <strong>ssh</strong> (secure shell), if the parameter value is <strong>TRUE</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The meta controller script controls the remote HiPath system as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creation of a request file, for example, x.req.</p>
</li>
<li>
<p>Copy request file to remote host, using the remote copy command.</p>
</li>
<li>
<p>Invoke the script <strong>remote_hdms</strong> on remote host, using said remote shell command.</p>
</li>
<li>
<p>The script <strong>remote_hdms</strong> calls <strong>dmsiepro</strong>c with request file (for example, x.req), the response file (for example, x.rsp) contains the result of each request specified in request file.</p>
</li>
<li>
<p>Copy response file from remote host using the remote copy command.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To make this work correctly, you must set up the environment. See the section "Setting Up the HiPath Environment" for details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_activity_hipath2ident_hipath_meta_directory_import"><a class="anchor" href="#_activity_hipath2ident_hipath_meta_directory_import"></a>Activity HiPath2Ident_HiPath (meta directory import)</h4>
<div class="paragraph">
<p>This section describes the operation and the prerequisites of the HiPath2Ident_HiPath activity.</p>
</div>
<div class="sect4">
<h5 id="_general_features_and_prerequisites_2"><a class="anchor" href="#_general_features_and_prerequisites_2"></a>General Features and Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>Updates Directory in merge mode.</p>
</li>
<li>
<p>Performs MODIFY operations only.</p>
</li>
<li>
<p>A DELETEd HiPath-Entry is propagated as Directory MODIFY operation (it removes those attribute values which are correlated with the HiPath-Entry).</p>
</li>
<li>
<p>A INSERTed/UPDATEd HiPath-Entry is propagated as Directory MODIFY operation (it updates those Attribute values which are correlated with the HiPath-Entry).</p>
</li>
<li>
<p>It links multiple HiPath entries to one Directory Entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basic assumptions and prerequisites for this activity are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The attributes objectClass, dxmOprOriginator and all attributes necessary for the join operation must be selected at the target side.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_basic_operation_2"><a class="anchor" href="#_basic_operation_2"></a>Basic Operation</h5>
<div class="paragraph">
<p>This step performs a full or delta export of HiPath Person (PERS) entries into a CSV file, which it then imports into a meta directory database. The performed steps are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Getting updated/deleted PERS-table entries from HiPath. In delta-mode, an appropriate SQL-like filter regarding creation/modification time is passed to HiPath.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Connecting to the directory.</p>
</li>
<li>
<p>For each record in the result obtained in step 1, try to find the related Directory entry first by a join operation with employeeNumber, then with DMS-Identifier in the dxmOprOriginator attribute.</p>
<div class="ulist">
<ul>
<li>
<p>If the number of matches is different from one, document this fact in trace file.</p>
</li>
<li>
<p>If the match is unique, perform a MODIFY operation as follows:</p>
</li>
<li>
<p>For a deleted HiPath entry, remove the corresponding phone and fax numbers from the directory entry.</p>
</li>
<li>
<p>For an inserted/updated HiPath entry, update the corresponding phone and fax numbers from the directory entry.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="paragraph">
<p>The parameter <strong>Multi Master Attribute List</strong> (from HiPath2Ident Entry Handling) specifies the list of attributes being subject to the special handling in import as described in this section above. The default setting defines the special handling (including maintenance of attribute dxmOprOriginator) to be applied for attributes telephoneNumber and facsimileTelephoneNumber only.</p>
</div>
<div class="paragraph">
<p>The parameter <strong>Keep Unmastered Attributes</strong> (from HiPath2Ident Entry Handling, default “TRUE”) controls whether or not unmastered (for example, manually entered attribute values) will be preserved.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_entry_handling"><a class="anchor" href="#_multiple_entry_handling"></a>Multiple Entry Handling</h4>
<div class="paragraph">
<p>The agent can handle LDAP directory entries and HiPath PERS table entries. Each LDAP directory entry that corresponds one-to-one with a HiPath entry will be extended by the objectClass value <strong>dxrUser</strong>.</p>
</div>
<div class="paragraph">
<p>This concept is a general concept for multi mastering of attribute values. Currently it is only implemented for the HiPath workflow. The method should be used sparingly because it decreases performance when used with a high number of entries.</p>
</div>
<div class="paragraph">
<p>The relevant attributes of this objectClass for the HiPath workflow are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>dxrState</strong> (status) - Only Directory Entries with status ENABLED and TBDEL are subject to synchronization into HiPath.</p>
</li>
<li>
<p><strong>dxmOprOriginator</strong> - A multivalued attribute in the form “value x of attribute y originates from entry of target system system”. The purpose of this attribute is storage of attribute mastership information. The attribute structure is:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>master</em><mark><em>key</em></mark><em>attribute_name</em>#<em>attribute_value</em></p>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="paragraph">
<p><em>master</em> - Name of the master system. The <strong>Master Name</strong> operational attribute of the connected directory is taken to define this value.</p>
</div>
<div class="paragraph">
<p><em>key</em> - unique identifier for an entry in related target system (for the HiPath workflow the DMSID is used)</p>
</div>
<div class="paragraph">
<p><em>attribute_name</em> - the mastered LDAP attribute name (for example telephoneNumber)</p>
</div>
<div class="paragraph">
<p><em>attribute_value</em> - the mastered LDAP attribute value (for example +49 89 722 12345)</p>
</div>
<div class="paragraph">
<p>Sample Attribute values are:</p>
</div>
<div class="paragraph">
<p>HDMS#12345#telephoneNumber#+49 89 123 12345<br>
HDMS#23456#facsimileTelephoneNumber#+49 89 987 65432<br>
HDMS#34567##</p>
</div>
<div class="paragraph">
<p>The first line represents the assertion “Attribute value #+49 89 123 12345 of attribute telephoneNumber originates from entry with DMSID=12345 of the master system with Master Name HDMS".</p>
</div>
<div class="paragraph">
<p>The last line represents just a link to a HiPath entry.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_the_hipath_environment"><a class="anchor" href="#_setting_up_the_hipath_environment"></a>Setting up the HiPath Environment</h4>
<div class="paragraph">
<p>This section provides instructions on how to set up the HiPath environment and then test it.</p>
</div>
<div class="paragraph">
<p>To set up the environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy (using ftp, for example) the <strong>remote_hdms</strong> shell script from the <em>install_path<strong>\</strong></em>*agents\HDMS* to the subdirectory specified in the <strong>remote_subdir</strong> parameter relative to the remote account specified by the <strong>remote_account</strong> parameter.</p>
</li>
<li>
<p>Edit the copied <strong>remote_hdms</strong> script to ensure that:</p>
</li>
<li>
<p>The DMS_DIR variable setting specified in the script matches the full pathname of the HDMS XIE import/export program on the remote HiPath installation.</p>
</li>
<li>
<p>The DATA_DIR variable setting specified in the script matches the setting in the <strong>remote_subdir</strong> parameter.</p>
</li>
<li>
<p>Ensure that the account that runs HDMSAgent on the local system has the rights to run <strong>rcp</strong> and <strong>rsh</strong> (or <strong>scp</strong> and <strong>ssh</strong>, respectively) to access the remote system.</p>
</li>
<li>
<p>Enable the HiPath environment for remote operation, depending on the <strong>remote_secure_interaction</strong> parameter. Enable the HiPath environment for <strong>rsh</strong> and <strong>rcp</strong> (see the section "Enable HiPath Environment for rsh and rcp"), if the parameter value is <strong>FALSE</strong>. Enable the HiPath environment for <strong>ssh</strong> and <strong>scp</strong> (see the section "Enable HiPath environment for ssh and scp"), if the parameter value is <strong>TRUE</strong>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_user_creation_directives_for_hipath_4000_manager_v3_1"><a class="anchor" href="#_user_creation_directives_for_hipath_4000_manager_v3_1"></a>User Creation Directives for HiPath 4000 Manager V3.1</h5>
<div class="paragraph">
<p>Connectivity to a HiPath system requires a UNIX account that has read and write access over the HiPath XIE interface. UNIX accounts created with HiPath 4000 Manager V3.1 do not have these access rights. To create an account with the required access rights:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as user <strong>engr</strong>. This is the root user of the HiPath 4000 system.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Run the UNIX command <strong>useradd</strong> to create the account <strong>hdmsuser</strong>.</p>
</li>
<li>
<p>In the <strong>dmsie</strong> subdirectory of your HiPath installation, copy the file <strong>root</strong> and rename it to <strong>hdmsuser</strong>.</p>
</li>
<li>
<p>If you want to grant read and write access only for the <strong>PERSDAT</strong> table, delete all lines that are different from <strong>PERSDAT</strong> from the <strong>hdmsuser</strong> file.</p>
</li>
<li>
<p>Allow read access for all users to the file <strong>hdmsuser</strong>.</p>
</li>
<li>
<p>Add a line:*<br>
hdmsuser*<br>
to the <strong>.users</strong> file in the <strong>dmsie</strong> subdirectory of your HiPath installation.<br>
If the <strong>.users</strong> file does not exist, create this file with owner <strong>root</strong>, group <strong>sys</strong>, and access rights <strong>644</strong>.</p>
</li>
<li>
<p>Run the following <strong>procadmin</strong> commands:*<br>
<br>
procadmin -t -g XIEAPI<br>
procadmin -s -g XIEAPI<br>
procadmin -l -g XIEAPI*<br>
<br>
See your HiPath system documentation for details about the <strong>procadmin</strong> command.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_enable_hipath_environment_for_rsh_and_rcp"><a class="anchor" href="#_enable_hipath_environment_for_rsh_and_rcp"></a>Enable HiPath Environment for rsh and rcp</h5>
<div class="paragraph">
<p>Suppose that HDMSAgent runs on system <strong>host1</strong> from the account <strong>metauser</strong> and host1 has the network address <strong>ip1</strong>. Suppose you want to configure HDMSAgent for interaction with HDMS V3.1 on <strong>host2</strong>, network address <strong>ip2</strong>.</p>
</div>
<div class="paragraph">
<p>First, perform the following steps on <strong>host2</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the account <strong>hdmsuser</strong> as described in the section "User creation directives for HiPath 4000 Manager V3.1" above. With XIE, grant full access rights to this account to manage the related tables PERS, COMPIMP, LOCIMP, BUILDIMP, ORGIMP. If you use another user account, be aware of the correct access rights.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Log in as <strong>hdmsuser</strong>.</p>
</li>
<li>
<p>Edit the <strong>.rhosts</strong> file in the <strong>hdmsuser</strong> home directory to grant <strong>metauser</strong> on host1 <strong>rsh</strong>, <strong>rcp</strong> and <strong>ftp</strong> access (by creating an entry <strong>ip1</strong> <strong>metauser</strong> in the <strong>.rhosts</strong> file). Be sure that the spelling of the <strong>metauser</strong> account is correct (this field is case-sensitive).</p>
</li>
<li>
<p>Create the subdirectories <strong>req</strong> and <strong>bin</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For the actions required on host1, always use the correct (case-sensitive) account name in the login dialog (in our example, <strong>metauser</strong> instead of <strong>Metauser</strong>).</p>
</div>
<div class="paragraph">
<p>We recommend that you test your setup by running <strong>rcp</strong>, <strong>rsh</strong>, and <strong>remote_hdms</strong> by hand, as shown in the following example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On host1, remote copy (<strong>rcp</strong>) a file on the remote host into the <strong>req</strong> subdirectory of hdmsuser&#8217;s home directory:<br>
rcp xxx hdmsuser@&lt;ip2&gt;:req (if host1 is a UNIX host)<br>
rcp xxx &lt;ip2&gt;.hdmsuser:req (if host1 is Windows NT host)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>On host1, remote copy (<strong>rcp</strong>) a file from host2 that exists in the <strong>req</strong> subdirectory of <strong>hdmsuser</strong>'s home directory but that does not exist in your current working directory:<br>
rcp hdmsuser@&lt;host2&gt;:req/xxx . (if host1 is a UNIX host)<br>
rcp hdmsuser@&lt;host2&gt;:req/xxx . (if host1 is a Windows NT host)</p>
</li>
<li>
<p>On host1, run a remote execution (<strong>rsh</strong>) of a simple command. For example:<br>
rsh ip2 -l hdmsuser ls -l req</p>
</li>
<li>
<p>On host2:</p>
<div class="ulist">
<ul>
<li>
<p>Log in as <strong>hdmsuser</strong> and create an HiPath request file $HOME/req/xxx.req with the following contents and no leading white spaces:<br>
# HDMS Call: xxx.req<br>
1;SELECT * FROM COMPIMP<br>
#@*<br>
<br>
Note*: For HDMS-US 5.2, HiPath 4000 Manager V1.0 and V3.0, the COMIMP table does not exist. Please use any other valid table (e.g. PERSDAT) instead of COMPIMP.</p>
</li>
<li>
<p>Change directory to the <strong>hdmsuser</strong> home directory.</p>
</li>
<li>
<p>On the command line, type <strong>bin/remote_hdms</strong> xxx.<strong>req</strong>.</p>
</li>
<li>
<p>On the command line, type <strong>echo$?</strong> to check the exit code. On success, the exit code is 0 and the file $HOME/req/xxx.rsp should exist with content that indicates successful execution of the request, such as:<br>
# HDMS Call: xxx.req; 2000-03-22 14:00:13.00<br>
#1;1<br>
38500|DE|PQR||||<br>
#@<br>
<br>
or (if the HDMS database is empty):<br>
# HDMS Call: xxx.req; 2000-03-22 14:00:13.00<br>
#1;0<br>
#@</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Define a user account, say <em>some_user_account</em>, that is to run HiPath Workflow. We recommend the DirX Identity installation account for this purpose wherever possible. Deviation from this recommendation will imply some extra work when configuring the workflow. Ensure that <em>some_user_account</em> has the permissions to call the HDMS XIE import/export program and has the permissions to manage the related tables using the XIE program, namely</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PERS, COMPIMP, LOCIMP, BUILDIMP, ORGIMP for HDMS 3.X</p>
</li>
<li>
<p>PERSDAT for HDMS-US 5.2, HiPath 4000 Manager V1.0 and V3.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also test your setup by running the HiPath Workflow in trial mode.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hipath_environment_setup_for_ssh_and_scp"><a class="anchor" href="#_hipath_environment_setup_for_ssh_and_scp"></a>HiPath Environment Setup for ssh and scp</h5>
<div class="paragraph">
<p>For example, suppose that HDMSAgent runs on system <strong>host1</strong> from the account <strong>metauser</strong> and host1 has the network address <strong>ip1</strong>. Suppose you want to configure HDMSAgent for interaction with HDMS V3.1 on <strong>host2</strong>, network address <strong>ip2</strong>.</p>
</div>
<div class="paragraph">
<p>First, perform the following steps on <strong>host1</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login as <strong>metauser</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Create public/private key with the <strong>ssh-keygen</strong> command, as shown in the following sample dialog:<br>
<br>
$ cd<br>
$ ssh-keygen -t rsa<br>
<br>
Enter &lt;RETURN&gt; for all input requests and wait until the generation is finished.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, perform the following steps on <strong>host2</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the account <strong>hdmsuser</strong> as described in section "User creation directives for HiPath 4000 Manager V3.0" above. With XIE, grant full access rights to this account to manage the related tables PERS, COMPIMP, LOCIMP, BUILDIMP, ORGIMP. If you use another user account, pay attention to the correct access rights.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>Log in as <strong>hdmsuser</strong>.</p>
</li>
<li>
<p>Transfer the public key (which you created for account <strong>metauser</strong> on host <strong>host1</strong>) to host2, for example <strong>scp metauser@host1:.ssh/id_rsa.pub ./metapublickey.txt</strong>. Be sure that the spelling of the metauser account is correct (this field is case sensitive).</p>
</li>
<li>
<p>Create the directory <strong>$HOME/.ssh</strong> if it does not yet exist.</p>
</li>
<li>
<p>Append the public key to the authorized keys file of the user <strong>hdmsuser</strong>, for example type <strong>cat $HOME/metapublickey.txt &gt;&gt; $HOME/.ssh/authorized_keys</strong>. Verify the permissions of the file <strong>authorized_keys</strong>. They should be 644.</p>
</li>
<li>
<p>Create the subdirectories <strong>req</strong> and <strong>bin</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For the actions required on host1, always use the correct (case-sensitive) account name in the login dialog (in our example, <strong>metauser</strong> instead of <strong>Metauser</strong>).</p>
</div>
<div class="paragraph">
<p>We recommend that you test your setup by running <strong>scp</strong>, <strong>ssh</strong>, and the <strong>remote_hdms</strong> by hand. It is essential that the commands <strong>scp</strong> and <strong>ssh</strong> execute without requesting a password. The commands can be tested as shown in the following example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On host1, remote copy (<strong>scp</strong>) a file on the remote host into the <strong>req</strong> subdirectory of <strong>hdmsuser</strong>'s home directory.<br>
scp xxx hdmsuser@&lt;ip2&gt;:req</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="26">
<li>
<p>On host1, remote copy (<strong>scp</strong>) a file from host2 that exists in the <strong>req</strong> subdirectory of <strong>hdmsuser</strong>'s home directory but that does not exist in your current working directory:<br>
scp hdmsuser@&lt;host2&gt;:req/xxx .</p>
</li>
<li>
<p>On host1, run a remote execution (<strong>ssh</strong>) of a simple command. For example:<br>
ssh hdmsuser@&lt;ip2&gt; ls -l req</p>
</li>
<li>
<p>On host2:</p>
<div class="ulist">
<ul>
<li>
<p>Log in as <strong>hdmsuser</strong> and create an HDMS request file $HOME/req/xxx.req with the following contents and no leading white spaces:<br>
# HDMS Call: xxx.req<br>
1;SELECT * FROM COMPIMP<br>
#@*<br>
<br>
Note*: For HDMS-US 5.2, HiPath 4000 Manager V1.0 and V3.0, the COMIMP table does not exist. Please use any other valid table (e.g. PERSDAT) instead of COMPIMP.</p>
</li>
<li>
<p>Change directory to the <strong>hdmsuser</strong> home directory.</p>
</li>
<li>
<p>On the command line, type <strong>bin/remote_hdms</strong> xxx<strong>.req</strong>.</p>
</li>
<li>
<p>On the command line, type e<strong>cho $?</strong> to check the exit code. On success, the exit code is 0 and the file $HOME/req/xxx.rsp should exist with content that indicates successful execution of the request, for example:<br>
# HDMS Call: xxx.req; 2000-03-22 14:00:13.00<br>
#1;1<br>
38500|DE|PQR||||<br>
#@<br>
<br>
or (if the HDMS database is empty):<br>
# HDMS Call: xxx.req; 2000-03-22 14:00:13.00<br>
#1;0<br>
#@</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Define a user account, say <em>some_user_account</em>, that is to run the HiPath workflow. We recommend the DirX Identity installation account for this purpose wherever possible; deviating from this recommendation will require some extra work when configuring the workflow. Ensure that <em>some_user_account</em> has the permissions to call the HDMS XIE import/export program and has the permissions to manage the related tables using the XIE program, namely</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PERS, COMPIMP, LOCIMP, BUILDIMP, ORGIMP for HDMS 3.X</p>
</li>
<li>
<p>PERSDAT for HDMS-US 5.2, HiPath 4000 Manager V1.0 and V3.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also test your setup by running the HiPath workflow in trial mode.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_export_traces"><a class="anchor" href="#_export_traces"></a>Export Traces</h4>
<div class="paragraph">
<p>The export trace file records the progress of the export task and statistical information about the operations being performed. This section describes the format of the generated information, which consists of these sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Meta directory entries</p>
</li>
<li>
<p>HiPath entries</p>
</li>
<li>
<p>Derived HiPath updates</p>
</li>
<li>
<p>Derived Directory updates</p>
</li>
<li>
<p>HiPath update statistics</p>
</li>
<li>
<p>DMS identifier update statistics</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_meta_directory_entry_section"><a class="anchor" href="#_meta_directory_entry_section"></a>Meta Directory Entry Section</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Directory entries:</strong> Number of meta directory entries to be synchronized into HiPath.</p>
</li>
<li>
<p><strong>Discarded:</strong> Number of "invalid" meta directory entries to be discarded. By default (that is, default definition of the export user hook uh::LoopExtraFilter), an entry will be discarded in delta mode if it does not have any related HiPath entry but is older than the "last export" time. In this case, HiPath Workflow assumes that a previous synchronization attempt of the entry into the HiPath database failed and discards the entry. The meta controller trace file contains notices about such entries.</p>
</li>
<li>
<p><strong>Missing in HiPath:</strong> Number of meta directory entries with DMS identifier that are not marked as to be deleted in HiPath, but do not exist in HiPath. The meta controller trace file contains notices about such entries.</p>
</li>
<li>
<p><strong>Deleted in Directory and HiPath:</strong> Number of meta directory entries with flag <strong>deleted in HiPath</strong> set to TRUE. The trace file will contain notices about such entries.</p>
</li>
<li>
<p><strong>To-Be-Deleted, missing in HiPath:</strong> Number of meta directory entries with a DMS identifier that are marked as to be deleted in HiPath, but do not exist in HiPath. The trace-file will contain notices about such entries.</p>
</li>
<li>
<p><strong>Ambiguous in Directory:</strong> Number of meta directory entries where the related HiPath entry has been found by best-guess match, but where multiple entries have the same related HiPath entry. The meta controller trace file will contain notices about such entries.</p>
</li>
<li>
<p><strong>Ambiguous in HiPath:</strong> Number of meta directory entries where the related HiPath entry cannot be determined uniquely by best-guess match. The meta controller trace file will contain notices about such entries.</p>
</li>
<li>
<p><strong>Up-to-date in HiPath:</strong> Number of meta directory entries where the related HiPath entry is already up-to-date with respect to the attributes to be synchronized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p># Directory entries: 9<br>
# Discarded: 0<br>
# Missing in HDMS: 0<br>
# Deleted in Directory and HDMS : 0<br>
# To-Be-Deleted, missing in HDMS: 0<br>
# Ambiguous in Directory: 0<br>
# Ambiguous in HDMS: 0<br>
# Up-to-date in HDMS: 3</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, 9 meta directory entries have been detected to be synchronized into HiPath, 3 of them are already up-to-date.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hipath_entry_section"><a class="anchor" href="#_hipath_entry_section"></a>HiPath Entry Section</h5>
<div class="paragraph">
<p>If HiPath workflow has loaded the PERS table and one or more of its dependent tables (COMPIMP, ORGIMP, LOCIMP, and BUILDIMP) were examined for referential integrity, this section shows the number of entries in each table.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p># HDMS PERS-table entries: 6<br>
# HDMS COMPIMP-table entries: 1<br>
# HDMS ORGIMP-table entries: 5<br>
# HDMS LOCIMP-table entries: 4<br>
# HDMS BUILDIMP-table entries: 4</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If HiPath workflow does not need to load one or more of these tables (for example, if it detects only up-to-date entries) the section contains a message that the table has not been loaded. For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p># HDMS ORGIMP-table not loaded.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_derived_hipath_updates_section"><a class="anchor" href="#_derived_hipath_updates_section"></a>Derived HiPath Updates Section</h5>
<div class="paragraph">
<p>The derived HiPath Updates section shows the HiPath database update actions that the HiPath workflow export comparison phase has determined. A counter exists for each action to be performed in the HiPath database. For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p># HDMS-Update-Actions derived in Comparision phase<br>
# PERS-table INSERTs: 3<br>
# PERS-table UPDATEs: 1<br>
# PERS-table DELETEs: 2<br>
# COMPIMP-table INSERTS: 0<br>
# ORGIMP-table INSERTS: 2<br>
# LOCIMP-table INSERTS: 0<br>
# BUILDIMP-table INSERTS: 0</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, HiPath workflow requests INSERT of 3 PERS-table entries, UPDATE of 1 PERS-table entry, and DELETE of 2 PERS-TABLE entries. In addition, two organizations (ORGIMP table entries) will be created for support of referential integrity.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hipath_update_statistics"><a class="anchor" href="#_hipath_update_statistics"></a>HiPath Update Statistics</h5>
<div class="paragraph">
<p>This section shows a counter for each HiPath update action that HiPath workflow can perform and whether or not it succeeded or failed for this synchronization task. The INSERTs are not counted per-table.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p># HDMS update statistics:<br>
# Successful INSERTs: 4<br>
# Unsuccessful INSERTs: 1<br>
# Successful UPDATEs: 1<br>
# Unsuccessful UPDATEs: 0<br>
# Successful DELETEs: 2</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_hipath_workflow"><a class="anchor" href="#_customizing_the_hipath_workflow"></a>Customizing the HiPath Workflow</h4>
<div class="paragraph">
<p>You can customize the HiPath workflow in many areas, but it requires Tcl know-how.</p>
</div>
<div class="sect4">
<h5 id="_job_authentication"><a class="anchor" href="#_job_authentication"></a>Job Authentication</h5>
<div class="paragraph">
<p>You must make sure that the HiPath workflow uses the authentication that has been used when testing the remote copy and remote shell command in previous setup steps. Check the Authentication tab of both Jobs of the HiPath Workflow. There are 2 possibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If your Identity IdS-C service already runs with the appropriate account (i.e. because in our example above), the authentication tab should not contain any data.</p>
</li>
<li>
<p>If your Identity IdS-C service runs as local system account (on Windows platforms) or another accounts being privileged to launch jobs with different user authentication, you must enter authentication information (i.e. User Name = metauser in our example above and password and domain as appropriate).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ident2hipath_target_selected_attributes_and_hipath2ident_source_selected_attributes"><a class="anchor" href="#_ident2hipath_target_selected_attributes_and_hipath2ident_source_selected_attributes"></a>Ident2HiPath Target Selected Attributes and HiPath2Ident Source Selected Attributes</h5>
<div class="paragraph">
<p>The correct attribute set is chosen implicitly by the HiPath Workflow itself in dependency of the <strong>HDMS Version</strong> defined in the related HiPath connected directory. This approach is much more comfortable than selecting dozens of attributes one-by-one and putting them into the appropriate order. There is a drawback of this approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Identity Manager will not be able to detect and visualize invalid HiPath attribute mapping rules and select boxes for HiPath join expression</p>
</li>
<li>
<p>The administrator must use the appropriate HiPath attribute abbreviations (when using attributes in customized TCL code) and HiPath attribute names (when using Identity Manager)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See section HiPath Tables for valid attribute abbreviations and names for your HDMS/HiPath version.</p>
</div>
<div class="paragraph">
<p>Note: If the HiPath workflow shall support a customer extended HiPath dataschema, you need to customize the <strong>file_attr_list</strong> variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the statement <strong>set src_conn_param(attr_list) "$file_attr_list_tpl($hdms_version)"</strong> for computation of variable file_attr_list in the script <strong>Import HDMS Var Tcl Script</strong> of the import task</p>
</li>
<li>
<p>Change the statement <strong>set tgt_conn_param(attr_list) "$file_attr_list_tpl($hdms_version)"</strong> for computation of variable file_attr_list in the script “Export HDMS Var Tcl Script” of the Export Task</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ident2hipath_attribute_mapping"><a class="anchor" href="#_ident2hipath_attribute_mapping"></a>Ident2HiPath Attribute Mapping</h5>
<div class="paragraph">
<p>The default attribute mapping is suitable for a synchronization where entries are joined by a unique identifier (e.g. dxmGUID) which is stored in an unused HiPath attribute (e.g. text3). Moreover, this mapping computes all attributes which are required for creation of person entries and - for HDMS 3.X - implicit creation of additional entries (in tables COMPIMP, ORGIMP, BUILDIMP, LOCIMP).</p>
</div>
<div class="paragraph">
<p>Please note that target attribute text3 is not appropriate for HDMS US 5.2. For this HDMS release, another attribute must be used (e.g. info3). Please note that target attribute longname is not suitable for HDMS-US 5.2. For this HDMS release, another attribute must be used (e.g. room)</p>
</div>
<div class="paragraph">
<p>In general, appropriate mappings must be defined for your attributes constituting your join criteria (HDMS Join expression and Joinback expression). The postmapping section updates the ChangeType based on the status attribute which is dxrState by default. If your status attribute is other than dxrState, then you must customize this section and to cross-check your customization with the source selected attributes and the export filter.</p>
</div>
<div class="paragraph">
<p>Please note some special mapping rules:</p>
</div>
<div class="paragraph">
<p><strong>Special meaning of empty value</strong> - An empty string value (“”) for a HiPath attribute denotes, that the related attribute will be left unchanged when modifying a HiPath entry.</p>
</div>
<div class="paragraph">
<p><strong>Special meaning of blank value</strong> - If you intend to delete an attribute in HiPath in order to synchronize deletion of related attribute in the Directory, then your mapping must result into a blank value.<br>
Example: Suppose you intend to synchronize the ldap attribute description onto HiPath attribute text1. Then you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A mapping rule mapping description onto text1</p>
</li>
<li>
<p>A statement in the postmapping section like:<br>
<br>
if \{ $rh_dms(TEXT1) == } then \{<br>
set rh_dms(TEXT1) [llist “ “ ];# list containing non-empty string with a blank}</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ident2hipath_export_properties"><a class="anchor" href="#_ident2hipath_export_properties"></a>Ident2HiPath Export Properties</h5>
<div class="paragraph">
<p>The <strong>HDMS Join Expression</strong> / <strong>Joinback expression</strong> parameters define the best-guess-match policy that HiPath Workflow is to use to join meta directory and HiPath entries. Each Attribute in Joinback Expression must correspond one-to-one with an attribute in HiPath Join Expression. For example:</p>
</div>
<div class="paragraph">
<p>Joinback Expression: surname and givenname</p>
</div>
<div class="paragraph">
<p>HDMS Join Expression: name and christianname</p>
</div>
<div class="paragraph">
<p>In this example, HiPath workflow is to match meta directory entries with HiPath entries using a combination of surname and given name. The meta directory sn (surname) attribute maps to the HiPath attribute “name” and the meta directory gn (given name) attribute maps to the HiPath attribute “christianname”. There must be related mapping rules.</p>
</div>
<div class="paragraph">
<p>These settings assume that each meta directory entry can be identified by a unique identifier which is stored in the attribute “text3” of an HiPath entry. Please note that attribute text3 is not appropriate for HDMS US 5.2. For this HiPath release, another attribute must be used (e.g., info3).</p>
</div>
</div>
<div class="sect4">
<h5 id="_hipath2ident_attribute_mapping"><a class="anchor" href="#_hipath2ident_attribute_mapping"></a>HiPath2Ident Attribute Mapping</h5>
<div class="paragraph">
<p>The <strong>postmapping</strong> computes a filter value to be used on the attribute dxmOprOriginator in the form:</p>
</div>
<div class="paragraph">
<p>&lt;master name&gt;#dmsidval#*</p>
</div>
<div class="paragraph">
<p>The dmsidval variable was computed in the mapping table.</p>
</div>
<div class="paragraph">
<p>This filter works on the dxmOprAttribute that contains values of the form:</p>
</div>
<div class="paragraph">
<p><em>mastername</em><mark><em>dmsidval</em></mark><em>attributename</em>#<em>attributevalue</em></p>
</div>
<div class="paragraph">
<p>The specific handling of this attribute is done in the workflow-specific user hook uh::LoopPostJoin.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hipath_tables"><a class="anchor" href="#_hipath_tables"></a>HiPath Tables</h4>
<div class="paragraph">
<p>These tables define the relationship between the abbreviation names used in the DirX Identity workflows and the HDMS/HiPath name.</p>
</div>
<div class="paragraph">
<p>The first column contains the field number in the interface file, the second column the DirX Identity abbreviation name and the third the related HDMS/HiPath name.</p>
</div>
<div class="sect4">
<h5 id="_hdms_3_1_conversion_table"><a class="anchor" href="#_hdms_3_1_conversion_table"></a>HDMS 3.1 Conversion Table</h5>
<div class="paragraph">
<p>See the Hicom DMS 3.1 SA4, Service Manual, Section "Import/Export interface API" for full details about XIE interface request/response format and the meaning of the attributes.</p>
</div>
<div class="paragraph">
<p>1 - CMD - identifier<br>
2 - C - country<br>
3 - O - company<br>
4 - ORG1 - org1<br>
5 - ORG2 - org2<br>
6 - ORG3 - org3<br>
7 - NAME - name<br>
8 - SRTNAME - sortname<br>
9 - CHN - christianname<br>
10 - TIT - title<br>
11 - SAL - salutation<br>
12 - LOC - location<br>
13 - BUILD - building<br>
14 - LNAME - longname<br>
15 - EXT - extension<br>
16 - SWITCH - switch<br>
17 - POS - position<br>
18 - TIENUM - tienum<br>
19 - EXTAREA - ext_areacode<br>
20 - EXTNET - ext_netcode<br>
21 - EXTEXT - ext_ext<br>
22 - FTN - faxnumber<br>
23 - OWNGROUP - owner_group<br>
24 - DIRTRACC - direct_trunc_acc<br>
25 - TEXT1 - text1<br>
26 - TEXT2 - text2<br>
27 - TEXT3 - text3</p>
</div>
</div>
<div class="sect4">
<h5 id="_hdms_3_6_conversion_table"><a class="anchor" href="#_hdms_3_6_conversion_table"></a>HDMS 3.6 Conversion Table</h5>
<div class="paragraph">
<p>See the Hicom DMS 3.6, Service Manual, Section "Import/Export interface API" for full details about XIE interface request/response format and the meaning of the attributes.</p>
</div>
<div class="paragraph">
<p>1 - CMD - Command<br>
2 - C - country<br>
3 - O - company<br>
4 - ORG1 - org1<br>
5 - ORG2 - org2<br>
6 - ORG3 - org3<br>
7 - NAME - name<br>
8 - SRTNAME - sortname<br>
9 - CHN - christianname<br>
10 - TIT - title<br>
11 - SAL - salutation<br>
12 - LOC - location<br>
13 - BUILD - building<br>
14 - LNAME - longname<br>
15 - EXT - extension<br>
16 - SWITCH - switch<br>
17 - POS - position<br>
18 - TIENUM - tienum<br>
19 - EXTAREA - ext_areacode<br>
20 - EXTNET - ext_netcode<br>
21 - EXTEXT - ext_ext<br>
22 - FTN - faxnumber<br>
23 - OWNGROUP - owner_group<br>
24 - DIRTRACC - direct_trunc_acc<br>
25 - TEXT1 - text1<br>
26 - TEXT2 - text2<br>
27 - TEXT3 - text3<br>
28 - TEXT4 - text4<br>
29 - IMPDATA - import_dat<br>
30 - ACCCTRL - access_control<br>
31 - MODDATE - modify_date<br>
32 - EQ - equipment<br>
33-52 - L1-L20 - l1-l20<br>
53 - LPREFIX - l_prefix<br>
54 - EXTCC - ext_cc<br>
55 - COSTCENTRE - costcentre<br>
56 - CHARGEID - charge_id<br>
57 - BANKCODE - bankcode<br>
58 - ACCNUM - accnum</p>
</div>
</div>
<div class="sect4">
<h5 id="_hdms_5_2_conversion_table"><a class="anchor" href="#_hdms_5_2_conversion_table"></a>HDMS 5.2 Conversion Table</h5>
<div class="paragraph">
<p>See the Hicom DMS-US 5.2, Service Manual, Section "Import/Export interface API" for full details about XIE interface request/response format and the meaning of the attributes.</p>
</div>
<div class="paragraph">
<p>1 - CMD - Command<br>
2 - SWITCH - switch<br>
3 - DOMAIN - domain<br>
4 - C - country<br>
5 - O - company<br>
6 - ORG1 - org1<br>
7 - ORG2 - org2<br>
8 - ORG3 - org3<br>
9 - NAME - name<br>
10 - SRTNAME - sortname<br>
11 - CHN - christianname<br>
12 - TIT - title<br>
13 - ADDR - address<br>
14 - LOC - location<br>
15 - BUILD - building<br>
16 - ROOM - room<br>
17 - STATION - station<br>
18 - POS - position<br>
19 - TIENUM - tienum<br>
20 - EXTAREA - ext_areacode<br>
21 - EXTNET - ext_netcode<br>
22 - EXTEXT - ext_ext<br>
23 - FTN - faxnumber<br>
24 - IMPDATA - import_dat<br>
25 - OWNGROUP - owner_group<br>
26 - MODDATE - modify_date<br>
27 - ACCCTRL - access_control<br>
28 - INFO1 - info1<br>
29 - INFO2 - info2<br>
30 - INFO3 - info3<br>
31 - INFO4 - info4<br>
32 - DIRTRACC - direct_trunc_acc<br>
33 - EQ - equipment<br>
34-53 - L1-L20 - l1-l20<br>
54 - LPREFIX - l_prefix<br>
55 - IDF - idf<br>
56 - IDFCABLEPAIR - Idf_cable_pair<br>
57-71 - INFO5-INFO19 - info5-info19</p>
</div>
</div>
<div class="sect4">
<h5 id="_hipath_4000_manager_v1_0_conversion_table"><a class="anchor" href="#_hipath_4000_manager_v1_0_conversion_table"></a>HiPath 4000 Manager V1.0 Conversion Table</h5>
<div class="paragraph">
<p>See the HiPath Manager V1.0, Service Manual, Section "Import/Export interface API" for full details about XIE interface request/response format and the meaning, syntax, format and maximum length of the attributes.</p>
</div>
<div class="paragraph">
<p>1 - CMD - cmd<br>
2 - C - country<br>
3 - O - company<br>
4 - ORG1 - org1<br>
5 - ORG2 - org2<br>
6 - ORG3 - org3<br>
7 - ORG4 - org4<br>
8 - ORG5 - org5<br>
9 - ORG6 - org6<br>
10 - NAME - name<br>
11 - SRTNAME - srtname<br>
12 - CHN - christianname<br>
13 - TIT - title<br>
14 - SAL - salutation<br>
15 - LOC - location<br>
16 - BUILD - building<br>
17 - LNAME - longname<br>
18 - EXT - extension<br>
19 - SWITCH - switch<br>
20 - SEQNUM - seq_num<br>
21 - TIENUM - tienum<br>
22 - EXTAREA - ext_areacode<br>
23 - EXTNET - ext_netcode<br>
24 - EXTEXT - ext_ext<br>
25 - FTN - faxnumber<br>
26 - IMPDATA - import_dat<br>
27 - OWNGROUP - owner_group<br>
28 - MODDATE - modify_date<br>
29 - ACCCTRL - access_control<br>
30 - TEXT1 - text1<br>
31 - TEXT2 - text2<br>
32 - TEXT3 - text3<br>
33 - DIRTRACC - direct_trunc_acc<br>
34 - EQ - equipment<br>
35-54 - L1-L20 - l1-l20<br>
55 - LPREFIX - l_prefix<br>
56 - TEXT4 - text4<br>
57 - EXTCC - ext_cc<br>
58 - CHARGEID - chargeid<br>
59 - BASCHCLASS - basic_charge_class<br>
60 - BANKCODE - bankcode<br>
61 - ACCNUM - accnum<br>
62 - XPREXISTS - xpr_exists<br>
63 - XPRKEY - xpr_key<br>
64 - XPRPIN - xpr_pin<br>
65 - XPRSERVER - xpr_server<br>
66 - XPRVMSADMIN - xpr_vmsadmin<br>
67 - XPRBROADCAST - xpr_broadcast<br>
68 - XPRDCTSEND - xpr_dctsend<br>
69 - XPRDCTRCV - xpr_dctrcv<br>
70 - XPRPWD - xpr_password<br>
71 - XPRNAME - xpr_name<br>
72 - XPRFLAG1 - xpr_flag1<br>
73 - XPRFLAG2 - xpr_flag2<br>
74 - XPRCONNECT - xpr_connect<br>
75 - XPRQUOTA - xpr_quota<br>
76 - XPRRESERVE1 - xpr_reserve1<br>
77 - XPRRESERVE2 - xpr_reserve2<br>
78 - PERSNUM - persnum<br>
79 - DOMAIN - domain<br>
80 - IDF - idf<br>
81 - IDFCABLEPAIR - idf_cable_pair<br>
82-96 - INFO5-INFO19 - info5-info19<br>
97 – VSW – v_switch<br>
98 – HUSID – usid<br>
99 – UMUI – umuid<br>
100 – UMUS – um_user<br>
101 – UMM - um_marked<br>
102 – UMOP - um_operation_id</p>
</div>
</div>
<div class="sect4">
<h5 id="_hipath_4000_manager_v3_1_conversion_table"><a class="anchor" href="#_hipath_4000_manager_v3_1_conversion_table"></a>HiPath 4000 Manager V3.1 Conversion Table</h5>
<div class="paragraph">
<p>See the HiPath 4000 Manager V3.1, section "Import/Export interface API" in the Service Documentation for details about the XIE interface request/response format and the meaning, syntax, format and maximum length of the attributes.</p>
</div>
<div class="paragraph">
<p>1 through 102 - See the section "HiPath 4000 Manager V1.0 Conversion Table" above<br>
103 - APEGRNO apg_group_no<br>
104 - XPRDELPW - xpr_delpwd<br>
105 - XPRDELPWTMP - xpr_delpwd_tmp</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_odbc_workflows"><a class="anchor" href="#_odbc_workflows"></a>ODBC Workflows</h3>
<div class="paragraph">
<p>The DirX Identity ODBC workflows provision an ODBC target system. Two workflows are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ODBC2Ident_Validation</strong> - performs initial load or validation from an ODBC target system</p>
</li>
<li>
<p><strong>Ident_ODBC_Sync</strong> - synchronizes the DirX Identity target system and the real ODBC target system</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The workflows' implementation assumes the following table layout in the ODBC target system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A table of groups, where each row represents one group</p>
</li>
<li>
<p>A table of accounts, where each row represents one account</p>
</li>
<li>
<p>A table of memberships where each row represents a membership of one account in one group</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next sections provide conceptual and configuration information about the ODBC Provisioning workflows.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_and_limitations_4"><a class="anchor" href="#_prerequisites_and_limitations_4"></a>Prerequisites and Limitations</h4>
<div class="paragraph">
<p>Before you can use the ODBC workflows, you must extend the DirX Identity Store schema with ODBC target system-specific attributes and object classes so that the workflows can store ODBC-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows".</p>
</div>
</div>
<div class="sect3">
<h4 id="_odbc_workflow_concepts"><a class="anchor" href="#_odbc_workflow_concepts"></a>ODBC Workflow Concepts</h4>
<div class="paragraph">
<p>This section explains the concepts of the workflow implementation.</p>
</div>
<div class="sect4">
<h5 id="_attribute_correlation_2"><a class="anchor" href="#_attribute_correlation_2"></a>Attribute Correlation</h5>
<div class="paragraph">
<p>The ODBC Tcl-based workflow assumes the same database structure as the JDBC Java-based workflow. For details, see the section "Target System Configuration" in "JDBC Provisioning Workflows".</p>
</div>
</div>
<div class="sect4">
<h5 id="_attribute_configuration"><a class="anchor" href="#_attribute_configuration"></a>Attribute Configuration</h5>
<div class="paragraph">
<p>Note that the attribute configuration contains two additional pseudo-attributes <strong>addMember</strong> and <strong>delMember</strong> that do not exist in the database. These attributes are used to transform multiple joined database records to the DirX Identity multi-valued attributes dxrGroupMemberAdd and dxrGroupMemberDelete and vice-versa.</p>
</div>
</div>
<div class="sect4">
<h5 id="_identity_multi_valued_attribute_to_odbc_multi_record_transformation"><a class="anchor" href="#_identity_multi_valued_attribute_to_odbc_multi_record_transformation"></a>Identity Multi-Valued Attribute to ODBC Multi-Record Transformation</h5>
<div class="paragraph">
<p>This section provides information about the transformation of DirX Identity multi-valued attributes to ODBC multi-records, from the ODBC-to-Identity direction and vice-versa.</p>
</div>
<div class="paragraph">
<p><strong>From ODBC to DirX Identity:</strong></p>
</div>
<div class="paragraph">
<p>The reading of group memberships in ODBC is performed by special join operations. For every membership, one result record is retrieved. In DirX Identity, each member is stored in a multi-valued attribute (dxrGroupMemberImported, dxrGroupMemberaAdd and dxrGroupMemberDelete).</p>
</div>
<div class="paragraph">
<p>A special profile script <strong>ODBC2Role</strong> is used for the transformation operation. The script assumes that the ODBC records are sorted by groups. As long as records of the same group are read, only the membership attributes are accumulated. At the end, or when reading a different group record, the accumulated record is written.</p>
</div>
<div class="paragraph">
<p>The following procedure accumulates members:</p>
</div>
<div class="paragraph">
<p>proc appendMV \{ source_data<br>
rec_data<br>
first} \{<br>
#<br>
# appends the members to the multi-valued attributes delmember/addmember<br>
# depending on the changetype<br>
#<br>
# Parameters:<br>
# src_data name of source handle (if 'src_dir_type' is 'File')<br>
# rec_data handle of currently read data record<br>
# first TRUE first record of group (use set else lappend)<br>
#<br>
# Return Values:</p>
</div>
<div class="paragraph">
<p>This default appendMV procedure works well for the synchronization workflow because it handles change types.</p>
</div>
<div class="paragraph">
<p>The <strong>ODBC profile script</strong> in the validation workflow requires a special appendMV procedure, which is defined in the user hook script of the <strong>ODBC2Ident_ValGroup_MetaCP</strong> job. Here the members are accumulated in the field <strong>AccountDxrName</strong> of the source record. The attribute that is used to determine records that belong to same group is hard-coded into <strong>GroupDxrName</strong>.</p>
</div>
<div class="paragraph">
<p><strong>From Identity to ODBC:</strong></p>
</div>
<div class="paragraph">
<p>DirX Identity uses the multi-valued attributes dxrGroupMemberAdd and dxrGroupMemberDelete to store memberships. For every member to be added, an ODBC add operation to the memberships tables is generated. For every member to be deleted, an ODBC delete operation to the memberships table is generated.</p>
</div>
<div class="paragraph">
<p>This procedure is part of the user hook script of the <strong>Role2ODBC_SyncGroupMembers_MetaCP</strong> job (LoopExtraFunction). For every member a <strong>rh_file_tgt</strong> handle is created. The data is mapped to it and the appropriate changetype is set. Afterwards it is written with write_record and then released. Because the DB keys are used for ODBC operation, the DB key for the account is read from the account&#8217;s dxrPrimary key Attribute, which results in one extra search per membership.</p>
</div>
<div class="paragraph">
<p>As all mapping is performed in the user hooks routine, the mapping routine itself is very small. In postJoinMapping, the action is set to "none", so no extra record is written for this dummy mapped record.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_odbc_validation_workflow"><a class="anchor" href="#_odbc_validation_workflow"></a>ODBC Validation Workflow</h4>
<div class="paragraph">
<p>The entries from the ODBC database are loaded into DirX Identity. The ODBC database is treated as the entry master. In validation mode, the workflow writes ToDo Messages to the DirX Identity objects that are not synchronized with the ODBC database.</p>
</div>
<div class="sect4">
<h5 id="_workflow_activities"><a class="anchor" href="#_workflow_activities"></a>Workflow Activities</h5>
<div class="paragraph">
<p>The validation workflow uses the following activities:</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_ODBCExport</strong> - exports groups with their memberships from the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_ValGroup_metaCP</strong> - handles groups and memberships in DirX Identity.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_ValAccount_ODBCExport</strong> - exports accounts from the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_ValAccount_metaCP</strong> - handles accounts in DirX Identity.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dirx_identity_groupsmemberships_handling"><a class="anchor" href="#_dirx_identity_groupsmemberships_handling"></a>DirX Identity-Groups/Memberships Handling</h5>
<div class="paragraph">
<p>The following select statement exports groups and their members:</p>
</div>
<div class="paragraph">
<p>Keys=GroupDxrName,MembershipGroupID,MembershipAccountID</p>
</div>
<div class="paragraph">
<p>Select=AccountDxrName,GroupDxrName,MembershipAccountID,MembershipGroupID,GroupID</p>
</div>
<div class="paragraph">
<p>From=(Groups LEFT JOIN Memberships ON Memberships.GroupID=Groups.ID) LEFT JOIN Accounts ON Accounts.ID=Memberships.AccountID</p>
</div>
<div class="paragraph">
<p>Where=1=1 ORDER BY Groups.dxrGroupname</p>
</div>
<div class="paragraph">
<p>The statement generates one record into the export file for each membership. Groups without members are also exported (LEFT JOIN, one record for each empty group).</p>
</div>
<div class="paragraph">
<p>As described in the section "Identity Multi-Valued Attribute to ODBC Multi Record Transformation", all records for a specific group are accumulated to one record, where dxrAccountName contains all members as a multi-valued attribute. The ORDER BY clause is necessary for accumulation.</p>
</div>
<div class="paragraph">
<p>Every group is mapped to a group in the DirX Identity ODBC target system.</p>
</div>
<div class="paragraph">
<p>dxrGroupName &#8594; Name (cn) of Group<br>
GroupID &#8594; dxrPrimaryKey of group</p>
</div>
<div class="paragraph">
<p>Every dxrAccountName is seen as group member.</p>
</div>
<div class="paragraph">
<p><strong>DirX Identity Account Handling</strong></p>
</div>
<div class="paragraph">
<p>Accounts are selected from the ODBC database with the statement:</p>
</div>
<div class="paragraph">
<p>Select= AccountDesc,AccountDxrName,AccountID,AccountOdbcName</p>
</div>
<div class="paragraph">
<p>From=Accounts</p>
</div>
<div class="paragraph">
<p>One record is exported for each account.</p>
</div>
<div class="paragraph">
<p>The <strong>dxrAccountName</strong> attribute is used as the <strong>cn</strong> for the DirX Identity account. The database key maps to the <strong>dxrPrimaryKeyAttribute</strong>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_odbc_synchronization_workflow"><a class="anchor" href="#_odbc_synchronization_workflow"></a>ODBC Synchronization Workflow</h4>
<div class="paragraph">
<p>First we&#8217;ll look at some ODBC-specific issues. Synchronization enforces changes of groups/accounts and memberships in the ODBC database and synchronizes back these changes to DirX Identity (set the appropriate status attributes, group membership states). Because we don&#8217;t want to violate the referential integrity in the ODBC database, the membership should be deleted first, and then the referenced object can be deleted. On the other hand, we need the DB keys to add a new membership. So for newly created accounts/groups, we need to synchronize back the DB key before inserting memberships.</p>
</div>
<div class="sect4">
<h5 id="_workflow_activities_2"><a class="anchor" href="#_workflow_activities_2"></a>Workflow Activities</h5>
<div class="paragraph">
<p>The ODBC synchronization workflow uses the following activities and workflows:</p>
</div>
<div class="paragraph">
<p><strong>Ident2ODBC_SyncAccount_MetaCP</strong> - an activity that exports Identity accounts with dxrTSState=NONE from the Identity Store. These are accounts that are to be inserted into the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>Ident2ODBC_ SyncAccount_ODBCImport</strong> - an activity that imports new accounts into the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_SyncNewAccWF</strong> - a workflow that exports the delta accounts back to the Identity Store. In addition to the accounts created in the previous step, the workflow handles deleted or modified accounts (initiated by a previous workflow run or by changing the database).</p>
</div>
<div class="paragraph">
<p><strong>Ident2ODBC_SyncGroup_MetaCP</strong> - an activity that exports new DirX Identity groups (dxrTSState=NONE) from the Identity Store.</p>
</div>
<div class="paragraph">
<p><strong>IdentODBC_SyncGroup_ODBCImport</strong> - an activity that imports these new groups into the ODBC database</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_SyncNewGroupWF</strong> - a workflow that exports the delta groups back to the Identity Store. In addition to the groups created in the previous step, the workflow handles deleted or modified accounts (initiated by a previous workflow run or by changing the database). For example, a group in the Identity Store deleted by the last run of the synchronization workflow is produced as delta information and is then "deleted" in the Identity Store.</p>
</div>
<div class="paragraph">
<p><strong>Ident2ODBC_SyncGroupMembers_MetaCP</strong> - an activity that exports all GroupMembers that are either in status Add or Delete. For each member, one record with a changetype add or delete is exported.</p>
</div>
<div class="paragraph">
<p><strong>Ident2ODBC_SyncGroupMembers_ODBCImport</strong> - an activity that adds or deletes memberships in the Memberships table in the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>Ident2ODBC_SyncAccountDel</strong> - a workflow that exports accounts to be deleted from the Identity Store and deletes them in the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>Ident2ODBC_SyncGroupDel</strong> - a workflow that exports groups to be deleted from the Identity Store and deletes them in the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_SyncGroup_ODBCExport</strong> - an activity that exports changed groups with their memberships from the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_SyncGroup_MetaCP</strong> - an activity that imports the changed groups and the related membership changes. Only memberships are updated. Groups are not deleted here. The next synchronization or validation workflow will delete these groups if necessary.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_SyncAcc_ODBCExport</strong> - an activity that exports changed accounts from the ODBC database.</p>
</div>
<div class="paragraph">
<p><strong>ODBC2Ident_SyncAcc_MetaCP</strong> - an activity that imports the changed account to the Identity Store.</p>
</div>
</div>
<div class="sect4">
<h5 id="_workflow_tasks_without_stored_procedures"><a class="anchor" href="#_workflow_tasks_without_stored_procedures"></a>Workflow Tasks without Stored Procedures</h5>
<div class="paragraph">
<p>The workflow consists of the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handling new accounts in DirX Identity - create in ODBC and synchronize back the dbKey to dxrPrimary key</p>
</li>
<li>
<p>Handling new groups in DirX Identity - create in ODBC and synchronize back the dbKey to dxrPrimary key</p>
</li>
<li>
<p>Handling new/deleted memberships in DirX Identity - the membership table in ODBC is updated</p>
</li>
<li>
<p>Handling accounts in state deleted in the Identity Store - accounts are deleted in ODBC</p>
</li>
<li>
<p>Handling groups deleted in identity store - groups are deleted in ODBC</p>
</li>
<li>
<p>Synchronizing back groups/memberships - only memberships are handled at the moment. Groups are not deleted in Role (use the validation workflow for this task)</p>
</li>
<li>
<p>Synchronize back accounts</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_workflow_tasks_with_stored_procedures"><a class="anchor" href="#_workflow_tasks_with_stored_procedures"></a>Workflow Tasks with Stored Procedures</h5>
<div class="paragraph">
<p>The ODBC workflow implementation delivered with DirX Identity assumes that all ODBC import tasks do not use stored procedures. Using stored procedures may simplify these tasks. Stored procedures can handle referential integrity - For adds to the membership table, only account/group name is necessary, because stored procedures may get the database keys through selects. So, we don&#8217;t need to synchronize back new objects before handling memberships. Instead, the stored procedure handles these issues.</p>
</div>
<div class="paragraph">
<p>Using a stored procedure, the remaining tasks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handling all changed accounts in the Identity Store - performs add or delete operations in the Accounts table (implicitly also some memberships might be deleted if a referenced account is deleted).</p>
</li>
<li>
<p>Handling all changed groups in the Identity Store - performs add or delete operations in the Accounts table (implicitly also some memberships might be deleted if a referenced group is deleted).</p>
</li>
<li>
<p>Handling all changed group memberships - performs add or delete operations in the Membership table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: One stored procedure can handle these tasks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronize back accounts.</p>
</li>
<li>
<p>Synchronize back groups/memberships.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_odbc_workflows"><a class="anchor" href="#_customizing_the_odbc_workflows"></a>Customizing the ODBC Workflows</h4>
<div class="paragraph">
<p>This section describes how to change the workflows when other database structures exist.</p>
</div>
<div class="sect4">
<h5 id="_using_additional_attributes"><a class="anchor" href="#_using_additional_attributes"></a>Using Additional Attributes</h5>
<div class="paragraph">
<p>To change the ODBC synchronization workflow to use additional ODBC attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify your attributes in the attribute configuration</p>
</li>
<li>
<p>Add the mapping of your attributes as a user hook</p>
</li>
<li>
<p>Extend the selected attributes/mapping with your attributes.</p>
</li>
<li>
<p>Add the correct values to the ODBC export/import properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next sections provide details.</p>
</div>
<div class="paragraph">
<p><strong>Attribute Configuration</strong></p>
</div>
<div class="paragraph">
<p>Specify the attributes of your database tables that are not included yet.</p>
</div>
<div class="paragraph">
<p>The following attributes should not be changed:</p>
</div>
<div class="paragraph">
<p>changetype<br>
DDN<br>
addMember<br>
delMember</p>
</div>
<div class="paragraph">
<p>The abbreviations of the following attributes (abbreviations) should not be changed. You can change the Name (table.column) and optionally the prefix:</p>
</div>
<div class="paragraph">
<p>AccountDxrName<br>
AccountID<br>
GroupDxrName<br>
GroupID<br>
MembershipAccountID<br>
MembershipGroupID<br>
MembershipID</p>
</div>
<div class="paragraph">
<p><strong>User Hook in Job Ident2ODBC_SyncGroupMembers_MetaCP</strong></p>
</div>
<div class="paragraph">
<p>In this job, the mapping is performed in the LoopExtraFunction user hook. See the corresponding section in the existing workflow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl"># mapping
set rh_file_tgt(changetype) "add"
set rh_file_tgt(AccountDxrName) $memb
set rh_file_tgt(MembershipGroupID) $src(dxrPrimaryKey)
set rh_file_tgt(GroupDxrName) $src(cn)</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a similar section with changetype delete.</p>
</div>
<div class="paragraph">
<p>You can add the mapping of your additional attributes here.</p>
</div>
<div class="paragraph">
<p><strong>Selected Attributes / Mapping</strong></p>
</div>
<div class="paragraph">
<p>The existing workflow already contains the minimum set of attributes needed. So in most cases, you just need to extend it with your additional attributes.</p>
</div>
<div class="paragraph">
<p><strong>ODBC Export / Import Properties</strong></p>
</div>
<div class="paragraph">
<p>You will find these properties in the channels under the ODBC connected directory. You do not need to change fields where abbreviations are used. Enter the correct values for your database in the other fields.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_structurally_different_odbc_databases"><a class="anchor" href="#_using_structurally_different_odbc_databases"></a>Using Structurally Different ODBC Databases</h5>
<div class="paragraph">
<p>If your database schema differs from the expected three table structure, no general statements can be made. You can try to change the ODBC Selects so that they produce a similar result as with the given schema. On the other hand, if you have fewer tables, you may simplify the whole workflow by packing some activities into one..</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_racf_workflows_2"><a class="anchor" href="#_racf_workflows_2"></a>RACF Workflows</h3>
<div class="paragraph">
<p>The DirX Identity RACF workflows provision a RACF target system. Two workflows are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>RACF2Ident_Validation</strong> - performs initial load or validation from a RACF target system</p>
</li>
<li>
<p><strong>Ident_RACF_Sync</strong> - synchronizes between the Identity Store and a RACF target system</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The RACF workflows are based on the DirX Identity meta controller (<strong>metacp</strong>). They use the RACF LDAP interface via IBM’s SecureWay LDAP server. The workflows can support all object types and attribute types that are accessible via the RACF interface.</p>
</div>
<div class="paragraph">
<p>Before you can use the RACF workflows, you must extend the DirX Identity Store schema with RACF target system-specific attributes and object classes so that the workflows can store RACF-specific information in the Identity Store. For instructions, see the section "Extending the Schema for the Target System Workflows".</p>
</div>
<div class="paragraph">
<p>RACF contains a lot of subsystems that are not used at every customer site. DirX Identity only supports a basic set of subsystems. Others must be configured for a specific customer. The following subsystems are configured in the default applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TSO (Time Sharing Option) - basic configuration of users, groups, and so on</p>
</li>
<li>
<p>WORKATTR (Work Attributes) - additional attributes</p>
</li>
<li>
<p>OMVS (Open Edition MVS) - UNIX system for MVS, only used for FTP transfer (for all users, not specific for each user)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following subsystems are not configured in the default applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CICS (Customer Information Control System) - tele-processing monitor for online transaction systems</p>
</li>
<li>
<p>DCE (Distributed Computing Environment) - distributed application handling</p>
</li>
<li>
<p>NETVIEW (Network Automation) - network monitoring and automation</p>
</li>
<li>
<p>OVM (Open Edition VM) - UNIX system for VM</p>
</li>
<li>
<p>OPAPAM - MCS console</p>
</li>
<li>
<p>LANGUAGE - nationalization</p>
</li>
<li>
<p>DFP (SMS Routine = System Managed Storage) - file management, pool sharing, disk management, profile management, disk space management.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: Due to capabilities that are missing from the RACF LDAP server, it is not possible to read or update the schema via LDAP with DirX Identity automatic schema retrieval.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sipass_workflows"><a class="anchor" href="#_sipass_workflows"></a>SiPass Workflows</h3>
<div class="paragraph">
<p>The DirX Identity SiPass workflows provision a SiPass target system. Two workflows are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SiPass2Ident_Validation</strong> - performs initial load or validation from a SiPass target system</p>
</li>
<li>
<p><strong>Ident_SiPass_Sync</strong> - synchronizes the DirX Identity target system and the SiPass target system</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following restrictions and hints apply to the SiPass standard workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The workflows' SiPass agent step runs only on Windows systems.</p>
</li>
<li>
<p>The SiPass agent must run on the machine where the SiPass server is installed. To achieve this you can setup a C++-based secondary server on this machine. We recommend to run the metacp jobs also on this machine to avoid file transfers.</p>
</li>
<li>
<p>The SiPass standard workflow only handles work group objects. It does not handle access groups.</p>
</li>
<li>
<p>Scrambled and encrypted bind passwords and data attributes are not supported. As a result, the "disable encryption" flag in the bind profile must be set.</p>
</li>
<li>
<p>SiPass workflows are pre-configured with <strong>Regional and Language Option</strong>s set in <strong>Regional</strong> <strong>Options</strong> to standard <strong>English</strong> <strong>(United States)</strong>. If SiPass is installed on a machine with other regional settings, you must adapt the format strings in SiPass agent jobs (see the <strong>Date</strong> <strong>Formats</strong> tab).</p>
</li>
<li>
<p>The SiPass attribute CardNumber is mandatory for each SiPass cardholder. The synchronization workflow is pre-configured to get this attribute from the attribute dxrName that stores the reference number. For a real provisioning application, the CardNumber attribute should be mapped to the dxrCardNumber attribute, which is empty by default. It is necessary to supply this attribute (for example, as a copy from the corresponding user).</p>
</li>
<li>
<p>The dxrName attribute is used as identifier at the SiPass side (CardNumber). Therefore it must be of type integer and it must be unique.</p>
</li>
<li>
<p>Groups must exist in the SiPass system. The agent cannot create groups due to a restriction of the SiPass interface.</p>
</li>
<li>
<p>During initial load a group is loaded that indicates accounts that are not members of another group. The group name is either &lt;none&gt; or &lt;keine&gt; depending on the language used.</p>
</li>
<li>
<p>Trying to load accounts with no group membership into SiPass causes an error. The dxrState attribute at the Identity Store stays in state 'None'.</p>
</li>
<li>
<p>SiPass can only assign exactly one group to an account. Build your role structure so that only one group is assigned to an account. DirX Identity does not check this restriction. If an account is assigned to more than one group, the import into SiPass fails.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>DirX is a registered trademark © Copyright 2024, Eviden SAS – All rights reserved.</p>
  <p>The UI for this site is derived from the Antora default UI and is licensed under the MPL-2.0 license.
    Several icons used are provided by Google and are licensed under the
    <a href="http://www.apache.org/licenses/LICENSE-2.0.txt">Apache License Version 2.0</a>.
  </p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
